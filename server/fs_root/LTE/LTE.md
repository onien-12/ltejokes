$$
\frac{1}{\sqrt{2}}
$$

# LTE ะธ 5g NR ะธ ะฒััะบะธะต ะดััะณะธะต ัััะบะธ ัะฒัะทะฐะฝะฝัะต ั ะฑะตัะฟัะพะฒะพะดะฝัะผะธ ัะธััะตะผะฐะผะธ ัะฒัะทะธ

ะัะตะถะดะต ัะตะผ ะณะพะฒะพัะธัั ะพ LTE ะธ 5g NR ััะพะธั ะฒะพะพะฑัะต ะฟะพะฝััั ะบะฐะบะธะต ะฟัะพะฑะปะตะผั ััะธ ัะธััะตะผั ะฟััะฐัััั ัะตัะธัั. ะััะณะธะผะธ ัะปะพะฒะฐะผะธ, ะดะปั ัะตะณะพ ะพะฝะธ ะฒะพะพะฑัะต ะฑัะปะธ ัะพะทะดะฐะฝั? ะะพะถะฝะพ ะบะพะฝะตัะฝะพ ัะฐะบ ััะพะดั ะพัะฒะตัะธัั: โะฝั ะปะพะณะธัะฝะพ ะถะต, ััะพะฑั ะผะพะถะฝะพ ะฑัะปะพ ะทะฒะพะฝะธัั, ะฒัะต ะดะตะปะฐโ, ะฝะพ ั ััั ะธะผะตั ะฒะฒะธะดั ัะบะพัะตะต ะฟัะธัะธะฝั ัะฐะบะพะน ัะปะพะถะฝะพััะธ ััะธั ัะตัะฝะพะปะพะณะธะน, ะฟะพัะตะผั ะฝะตะปัะทั ัะดะตะปะฐัั ะฒัั ะฟัะพัะต?

ะขะฐะบ ะฒะพั, ะดะฐะฒะฐะนัะต ะฟะพะดัะผะฐะตะผ, ะบะฐะบะธะผ ะฒัะต ัะฐะบะธ ััะตะฑะพะฒะฐะฝะธัะผ ะดะพะปะถะฝั ัะพะพัะฒะตัััะฒะพะฒะฐัั ัะพัะพะฒัะต ัะธััะตะผั ัะฒัะทะธ. ะะปั ะฝะฐัะฐะปะฐ ะฝะตะผะฝะพะณะพ ะธััะพัะธัะตัะบะพะน ัะฟัะฐะฒะบะธ.

ะก 2000 ะฟะพ 2010 ะณะพะด ะบะพะปะธัะตััะฒะพ ะฟะพะปัะทะพะฒะฐัะตะปะตะน ะธะฝัะตัะฝะตัะฐ, ะธ, ัะพะพัะฒะตัััะฒะตะฝะฝะพ, ัะพัะพะฒะพะน ัะฒัะทะธ ะฒััะพัะปะพ ะดะพ 5 ะผะปัะด. ัะตะปะพะฒะตะบ. ะฃะถะต ะบ 2010 ะณะพะดั ะพะฑัะธะน ะพะฑัะตะผ ะฟะฐะบะตัะฝัั ะดะฐะฝะฝัั ะฟัะตะฒััะธะป ะพะฑัะธะน ะพะฑััะผ ะณะพะปะพัะพะฒัั ะดะฐะฝะฝัั ะฒ 10 ัะฐะท. ะญัะพะผั ัะฟะพัะพะฑััะฒะพะฒะฐะปะพ ะฒ ัะพะผ ัะธัะปะต ัะฐะทะฒะธัะธะต ัะธััะตะผ ะผะพะฑะธะปัะฝัั ัะตะปะตะบะพะผะผัะฝะธะบะฐัะธะน: WCDMA (2001), HSDPA (2007), HSUPA (2008) ะธ HSPA+ (2010). ะ 2015 ะณะพะดั ะพะถะธะดะฐะปะพัั, ััะพ ะพะฑัะตะต ะบะพะปะธัะตััะฒะพ ะฟะพะปัะทะพะฒะฐัะตะปะตะน ะธะฝัะตัะฝะตัะฐ ัะพััะฐะฒะธะปะพ ะฑั ะฑะพะปะตะต 5 ะผะปัะด ัะตะปะพะฒะตะบ. ะ 2010 ะฒัะตะผะตะฝะธ ัะถะต ะพะบะพะปะพ 3 ะผะปัะด. ัะตะปะพะฒะตะบ ะฟะพะปัะทะพะฒะฐะปะธัั ัะพัะพะฒัะผะธ ัะธััะตะผะฐะผะธ ะดะปั ะทะฐะณััะทะบะธ ะบะพะฝัะตะฝัะฐ ะธะท ะธะฝัะตัะฝะตัะฐ.

ะก ัะพััะพะผ ัะธัะปะฐ ะฟะพะปัะทะพะฒะฐัะตะปะตะน ะธ ัะพััะพะผ ัะปะพะถะฝะพััะธ ะธะฝัะตัะฝะตั-ะฟัะธะปะพะถะตะฝะธะน ะฒะพะทัะพัะปะพ ะธ ะพะถะธะดะฐะฝะธะต ะบะพะฝะตัะฝัั ะบะปะธะตะฝัะพะฒ ะพั ัะบะพัะพััะธ ัะพะตะดะธะฝะตะฝะธั. ะะพะปัะทะพะฒะฐัะตะปะธ ะพะถะธะดะฐะปะธ ัะพัั ัะบะพัะพััะธ ะพะฑะผะตะฝะฐ ะดะฐะฝะฝัะผะธ ะฟะพ ัะฐะดะธะพ ัะฐะบ ะถะต, ะบะฐะบ ะพะฝะฐ ัะพัะปะฐ ะฟัะธ ะฟัะพะฒะพะดะฝะพะผ ะฟะพะดะบะปััะตะฝะธะธ. ะกัะฐะปะพ ะพัะตะฒะธะดะฝะพ, ััะพ ะฝะตะพะฑัะพะดะธะผะพ ัะฐะทัะฐะฑะพัะฐัั ัะธััะตะผั ัะฒัะทะธ, ะบะพัะพัะฐั ะฑั ะพะฑะตัะฟะตัะธะปะฐ ะบะพะฝะตัะฝัั ะฟะพะปัะทะพะฒะฐัะตะปะตะน ะฑััััะพะน ัะบะพัะพัััั ะพะฑะผะตะฝะฐ ะดะฐะฝะฝัะผะธ ะฒ ะดะฒัั ะฝะฐะฟัะฐะฒะปะตะฝะธัั (uplink ะธ downlink).

ะะพ ััั ะฒัััะฟะฐัั ะฒ ัะธะปั ะฟัะฐะบัะธัะตัะบะธะต ะพะณัะฐะฝะธัะตะฝะธั. ะะพ ะฟะตัะฒัั ัะธััะตะผั ัะพัะพะฒะพะน ัะฒัะทะธ ะดะพะปะถะฝั ะพะฑะตัะฟะตัะธะฒะฐัั ะฒััะพะบัั ะผะพะฑะธะปัะฝะพััั, ัะพ ะตััั ะพะฑะตัะฟะตัะธะฒะฐัั ะฝัะปะตะฒัะต ะฟะพัะตัะธ ะดะฐะฝะฝัั ะฟัะธ ะฟะตัะตัะพะดะต ะธะท ะทะพะฝั ะดะตะนััะฒะธั ะพะดะฝะพะน ะฒััะบะธ ะฒ ะดััะณัั. ะขัั ะฝะฐะดะพ ััะธััะฒะฐัั ะพะณัะพะผะฝะพะต ะบะพะปะธัะตััะฒะพ ัะฐะทะฝัั ััะปะพะฒะธะน. ะะฐะฟัะธะผะตั Cell Interference, ะบะพะณะดะฐ ะดะฒะต ะฒััะบะธ, ัะฐะฑะพัะฐั ะฝะฐ ะพะดะธะฝะฐะบะพะฒัั ัะฐััะพัะฐั  ัะพะทะดะฐะฒะฐัั ะธะฝัะตััะตัะตะฝัะธั (ะฐ ััะพ ัะปััะฐะตััั ะพัะตะฝั ัะฐััะพ). ะขะฐะบะถะต ะฝะฐะดะพ ััะธััะฒะฐัั ัะฐะผะพ ัะธะทะธัะตัะบะพะต ะพะณัะฐะฝะธัะตะฝะธะต ัะฐะดะธะพัะฒัะทะธ, ะฟัะธ ะบะพัะพัะพะผ ะฟะพัะตัะธ ัะธะณะฝะฐะปะฐ ะผะพะณัั ะฑััั ัะฐะบะธะต, ััะพ ะฝะต ะฟะพะปััะธััั ะดะตะบะพะดะธัะพะฒะฐัั ัะธะณะฝะฐะป ะฝะฐ ะฑะฐะทะพะฒะพะน ััะฐะฝัะธะธ ะฟัะธ ะฟะตัะตัะพะดะต ะธะท ะพะดะฝะพะน ะทะพะฝั ะฒ ะดััะณัั. ะกัะดะฐ ะถะต ะดะพะฑะฐะฒะปััััั ัะปะพะถะฝะพััะธ ั ะพัะณะฐะฝะธะทะฐัะธะตะน Antenna Array ะธ Beamforming, CoMP ะธ Carrier Aggregation, ัะปะพะถะฝะพััะธ ั ะฑัััััะผ ะธะทะผะตะฝะตะฝะธะต ัะตะถะธะผะพะฒ MIMO ะธ Diversity, ะธะทะผะตะฝะตะฝะธะตะผ ะผะตัะพะดะฐ ะผะพะดัะปััะธะธ ะธ ะผัะปััะธะฟะปะตะบัะธัะพะฒะฐะฝะธั.
ะขะฐะบะถะต ะฑะฐะทะพะฒัะต ััะฐะฝัะธะธ ะดะพะปะถะฝั ะพะฑัะปัะถะธะฒะฐัั ะพะณัะพะผะฝะพะต ะบะพะปะธัะตััะฒะพ ะฟะพะปัะทะพะฒะฐัะตะปะตะน ะทะฐ ัะฐะท, ัะพ ะตััั ัะฟัะฐะฒะปััั ะธะฝัะตััะตัะตะฝัะธะตะน, ะฒัะดะตะปะตะฝะธะตะผ ัะตััััะพะฒ, MIMO ะธ ะพะณัะฐะฝะธัะธะฒะฐัั ะฟัะพะฟััะบะฝัั ัะฟะพัะพะฑะฝะพััั ะบะฐะฝะฐะปะฐ RACH (ะบะพัะพััะน ะธัะฟะพะปัะทัะตััั ะฟัะธ ะฟะพะดะบะปััะตะฝะธะธ).
ะัะพะผะต ัะพะณะพ, ะพะฝะธ ะดะพะปะถะฝั ัะฐะฑะพัะฐัั ะฑััััะพ ะธ ััะฐะฑะธะปัะฝะพ, ะฝะต ัะฐะทััะถะฐัั ะฑะฐัะฐัะตั ััััะพะนััะฒ, ัะตะฐะปะธะทะพะฒัะฒะฐัั ัะธััะพะฒะฐะฝะธะต ะธ ัะถะฐัะธะต ะดะฐะฝะฝัั, ะฟะพะฒัะพัะฝัั ะพัะฟัะฐะฒะบั ะฟะฐะบะตัะพะฒ ะธ ะผะฝะพะณะพ ัะตะณะพ ะตัั.

ะะผะตะฝะฝะพ ะฟะพััะพะผั ัะธัะฐั ัััััะธ ัััะฐะฝะธั ะดะพะบัะผะตะฝัะฐัะธะธ ะผะพะถะฝะพ ะฝะฐัะฐะปะบะธะฒะฐัััั ะฝะฐ, ะบะฐะทะฐะปะพัั ะฑั, ัะพะฒะตััะตะฝะฝะพ ะฝะตะปะพะณะธัะฝัะต ะฒะตัะธ (ะฝะฐะฟัะธะผะตั PCFICH ะธะปะธ ะดะฒะฐ ัะตะถะธะผะฐ RACH, Contention Based ะธ Non Contention Based), ะฝะพ ัะณะปัะฑะปัััั ะธ ะทะฐะดัะผัะฒะฐััั, ะพ ัะพะผ, ะดะปั ัะตะณะพ ะฑัะปะฐ ะฒะฝะตะดัะตะฝะฐ ัะฐะบะฐั ัะปะพะถะฝะพััั, ััะฐะฝะพะฒะธััั ะฟะพะฝััะฝะพ, ััะพ ััะพ ะฝะต ะทัั.

ะะฐะฒะฐะนัะต ะฒัั ัะฐะบะธ ัะถะต ะฟะตัะตะนะดะตะผ ะบ ัะตัะฝะธัะตัะบะพะน ัะฐััะธ, ะฐ ัะพ ะฒะพั ััะพ ะฒัะต ะฝะต ัะฐะบ ะธะฝัะตัะตัะฝะพ.

## ะะฑัะฐั ะฐััะธัะตะบัััะฐ
```

        non-3gpp nets   โโโโโโ  LTE-Uu                       
        โโโโโโโโโโโโโโโโโค UE โโโโโโโโโโโ                     
        โผ               โโโโโโ         โ          E-UTRAN    
   โโโโโโโโโโโ                     โโโโโผโโโโโโโโโโโโโโโโโ    
   โ WIFI AP โ                     โ  eNBโโโโX2โโโโeNB  โ    
   โโโโโโฌโโโโโ                     โโโโโโโโโโโโโโโโโโฌโฌโโโ    
โโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโผโผโโโโโโโ
โ       โผ                                         S1โโ      โ
โ    โโโโโโ              โโโโโ     S6a    โโโโโโโ   โโ      โ
โ    โePDGโโโโโโโโ       โHSSโโโโโโโโโโโโโโค MME โโโโโโ      โ
โ    โโโโฌโโ      โ       โโโโโ            โโโโฌโโโ    โ      โ
โ       โS2b     โSWm      โฒ                 โ       โS1-U  โ
โ       โผ        โ         โSWx              โ       โ      โ
โ    โโโโโโ      โผ       โโโดโโ               โผ       โ      โ
โ    โP-GWโโโโโโโโโโโโโโโบโAAAโ            โโโโโโโโ   โ      โ
โ    โโโโโโ      S6b     โโโโโ            โ S-GW โโโโโ      โ
โ                                         โโโโฌโโโโ          โ
โ                                            โ              โ
โ                                            โS5/S8         โ
โ                                            โผ              โ
โ                               SGi       โโโโโโโโ          โ
โ                      โโโโโโโโโโโโโโโโโโโโคPDN GWโ          โ
โ                      โ                  โโโโฌโโโโ          โ
โ                      โผ                     โGx            โ
โ                โโโโโโโโโโโโโ               โ              โ
โ                โ           โ               โผ              โ
โ                โ  Service  โ             โโโโโโ           โ
โ                โ    PDN    โ             โPCEFโ           โ
โ                โ           โ             โโโฌโโโ           โ
โ                โโโโโโโโโโโโโ               โGx            โ
โ                     โฒ                      โผ              โ
โ                     โ          SGi       โโโโโโ           โ
โ                     โโโโโโโโโโโโโโโโโโโโโโคPCRFโ           โ
โEPC                                       โโโโโโ           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

ะะตัะตะด ะฒะฐะผะธ ะพะฑัะฐั ะฐััะธัะตะบัััะฐ ะฒัะตะน ัะตัะธ. ะะฐ ะฝะตะน ัะบะฐะทะฐะฝั ะธะฝัะตััะตะนัั ะธ ัะทะปั ัะธััะตะผั, ะฐ ัะฐะบะถะต ะฟััะธ ะฟะตัะตะดะฐัะธ ะดะฐะฝะฝัั. ะะฐััะผะพััะธะผ ะฝะตะบะพัะพััะต ัะทะปั ะฟะพะดัะพะฑะฝะตะต (ะฟะพัะพะผ ะฒัะต ัะฐะฒะฝะพ ะบ ะฝะธะผ ะฒะตัะฝะตะผัั ะบะพะณะดะฐ ะฑัะดะตะผ ะณะพะฒะพัะธัั ะพ EPS Bearer)
1. UE โ User Equipment โ ััััะพะนััะฒะพ, ะฟะพะดะบะปััะฐััะตะตัั ะบ ะฒััะบะฐะผ ัะพัะพะฒะพะน ัะฒัะทะธ (eNB) ะดะปั ะบะพะผะผัะฝะธะบะฐัะธะธ ั PDN. ะัะฟะพะปะฝัะตั ััะฝะบัะธะธ:
:::margin{ml=28}
 a) **Mobility Management** โ ะพัััะตััะฒะปัะตั ะฟะตัะตัะพะด ั ะพะดะฝะพะน ะพะฑัะปัะถะธะฒะฐััะตะน eNB ะบ ะดััะณะพะน (Handover)

 b) **Call Control** โ ะพัััะตััะฒะปัะตั ะทะฐะฟัะพั ะฝัะถะฝัั ัะตััััะพะฒ ะดะปั ะฟะพัััะพะตะฝะธั ะบะพะผะผัะฝะธะบะฐัะธะธ ั PDN

 c) **Identity Management** โ ััััะพะนััะฒะพ ััะฐะฝะธั ะดะฐะฝะฝัะต ะดะปั ะฐะฒัะพัะธะทะฐัะธะธ ะฒ ัะตัะธ: ะธะดะตะฝัะธัะธะบะฐัะพัั ะฟะพะปัะทะพะฒะฐัะตะปั, ะบะปััะธ ัะธััะพะฒะฐะฝะธั, ะธ ั.ะด.

 ะ ัะตะปะพะผ, UE ะพะฑะตัะฟะตัะธะฒะฐะตั ัะฒัะทั ั ัะตััั, ะฒัะฟะพะปะฝัั ะทะฐะดะฐัะธ ะดะปั ะฟะพะดะดะตัะถะฐะฝะธั ัะพะตะดะตะฝะตะฝะธั. UE ะฟะพััะพัะฝะฝะพ ัะพะพะฑัะฐะตั ัะตัะธ ะดะฐะฝะฝัะต ะพ ะบะฐัะตััะฒะต ะบะฐะฝะฐะปะฐ, ััะตะฑัะตะผัั ะดะตะนััะฒะธะน ะธ ั.ะด. ะ ะพะฑัะตะผ ะธะผะตะฝะฝะพ ัะตัั ะพัััะตััะฒะปัะตั ัะฟัะฐะฒะปะตะฝะธะต UE, ัะบะฐะทัะฒะฐั ะผะพะดัะปััะธั, ะบะพะดะธัะพะฒะบั ะธ ะดััะณะธะต ะฟะฐัะฐะผะตััั, ะบะพัะพััะต UE ะดะพะปะถะตะฝ ะธัะฟะพะปัะทะพะฒะฐัั ะฟัะธ ะฟัะธะฝััะธะธ ะธะปะธ ะพัะฟัะฐะฒะบะต ะดะฐะฝะฝัั.
:::
2. eNB โ evolved NodeB โ ัะฐะผะฐ ัะพะฑััะฒะตะฝะฝะพ ะฒััะบะฐ ัะพัะพะฒะพะน ัะฒัะทะธ. ะะฑะตัะฟะตัะธะฒะฐะตั ัะฟัะฐะฒะปะตะฝะธะต ัะตััััะฐะผะธ, ัะฐะทะดะตะปะตะฝะธะต ะบะฐะฝะฐะปะพะฒ ะฟะพะปัะทะพะฒะฐัะตะปะตะน, ะพัะฟัะฐะฒะบะพะน ะดะฐะฝะฝัั ะฒ EPC, HARQ, RACH, Mobility Management, ะธ ั.ะด. ะััะธัะตะบัััะฝะพ, eNB ะฒัะฟะพะปะฝัะตั ััะฝะบัะธั ัะฐะดะธะพะผะพััะฐ ะผะตะถะดั ะฟะพะปัะทะพะฒะฐัะตะปะตะผ ะธ EPC. ะะฐะฑะพัะฐ eNB ะฟะพะดัะพะฑะฝะพ ัะฐััะผะฐััะธะฒะฐะตััั ะดะฐะปะตะต. ะัะต ะฒััะบะธ ะพะฑัะตะดะตะฝะตะฝั ะฒ ัะตัั (E-UTRAN (Evolved UMTS Radio Access Network)), ะผะตะถะดั ะฝะธะผะธ ะธัะฟะพะปัะทัะตััั ะฟัะพัะพะบะพะป X2.

3. EPC โ evolved Packet Core โ ัะตัั ะพะฟะตัะฐัะพัะฐ, ะพะฑัะฐะฑะฐััะฒะฐััะฐั ะทะฐะฟัะพัั ั ะฒััะบะธ, ะพัะฟัะฐะฒะปัััะฐั ะธั ะดะฐะปะตะต ะฒ ะธะฝัะตัะฝะตั, ะปะธะฑะพ ะฒ ะดััะณะธะต ะฟะพะดะบะปััะตะฝะฝัะต ัะตัะธ. ะัะฟะพะปะฝัะตั ััะฝะบัะธะธ ะบะพะฝััะพะปั (Control Plane Functions), Mobility Management, ััะฐะฝะตะฝะธั ะดะฐะฝะฝัั ะพ ะฟะพะปัะทะพะฒะฐัะตะปัั, ัััะฐะฝะพะฒะปะตะฝะธั EPS Bearer, ะธ ั.ะด. EPC ัะพััะพะธั ะธะท ัะปะตะดัััะธั ัะทะปะพะฒ:
 a) MME โ Mobility Management Entity โ ะพัะฝะพะฒะฝะพะน ะบะพะฝััะพะปะปะธััััะธะน ัะทะตะป ัะตัะธ, ัะฐะฑะพัะฐััะธะน ัะพะปัะบะพ ะฒ Control Plane, ั.ะต ะฝะธะบะฐะบ ะฝะต ััะฐััะฒัััะธะน ะฒ ะฟะตัะตะดะฐัะต ะฟะพะปัะทะพะฒะฐัะตะปััะบะธั ะดะฐะฝะฝัั. ะ ะตะณะพ ััะฝะบัะธะธ ะฒัะพะดัั: ัะฟัะฐะฒะปะตะฝะธะต ะฐะฒัะพัะธะทะฐัะธะตะน, Mobility Management, ัะฟัะฐะฒะปะตะฝะธะต ััะปัะณะฐะผะธ ะพะฟะตัะฐัะพัะฐ ะธ ะฟะปะฐะฝะฐะผะธ ัะฐัะธัะฐ, ัััะฐะฝะพะฒะปะตะฝะธะต ัะพะตะดะตะฝะตะฝะธั, ะธ ั.ะด. eNB ะฟะตัะตะดะฐัั ะดะฐะฝะฝัะต ะฝะฐ MME ั ะฟะพะผะพััั S1AP. ะัะต ััะฝะบัะธะธ ััะพะณะพ ัะทะปะฐ ะฑัะดัั ะฟะพะดัะพะฑะฝะตะต ะพะฟะธัะฐะฝั ะดะฐะปะตะต.
 b) S-GW โ Serving Gateway โ ะพัะฝะพะฒะฝะพะน ัะทะตะป, ะพัะฒะตัะฐััะธะน ะทะฐ ะพัะฟัะฐะฒะบั ะบะฐะบ ะฟะพะปัะทะพะฒะฐัะตะปััะบะธั ะดะฐะฝะฝัั, ัะฐะบ ะธ ะดะฐะฝะฝัั eNB ะฒ E-UTRAN. ะ ััะฝะบัะธะธ ััะพะณะพ ัะทะปะฐ ะฒัะพะดัั: Mobility Management (ะตัะปะธ ะธะฝัะตััะตะนั X2 ะฝะตะดะพัััะฟะตะฝ, ัะพ ะดะฐะฝะฝัะต ะผะตะถะดั eNB ะฑัะดัั ะธะดัะธ ัะตัะตะท S-GW), Local Mobility Management (S-GW ัะพััะฐะฝัะตั S5/S8 Bearer ะฟัะธ ะฟัะพัะตะดััะต Handover), Roaming Management (S-GW ัััะฐะฝะฐะฒะปะธะฒะฐะตั S8 Bearer ั ะฝัะถะฝะพะน PLMN ะตัะปะธ UE ะฝะฐัะพะดะธััั ะฒ ัะพัะผะธะฝะณะต), ะธ ั.ะด. (ะฟัะพ ะฒัั ััะพ ะฟะพะทะถะตะตะต)
 c) PDN GW โ Packet Data Network Gateway โ ะพัะฝะพะฒะฝะพะน ัะทะตะป, ะพัะฒะตัะฐััะธะน ะทะฐ ะพัะฟัะฐะฒะบั ะฟะพะปัะทะพะฒะฐัะตะปััะบะธั ะดะฐะฝะฝัั. P-GW ะฒัะดะตะปัะตั IP ะฐะดัะตั ััััะพะนััะฒั, ะพัะฟัะฐะฒะปัะตั ะฟะพะปัะทะพะฒะฐัะตะปััะบะธะต ะฟะฐะบะตัั ะฒ ะฝัะถะฝัั ัะตัั, ัะฟัะฐะฒะปัะตั ะฒัะฟะพะปะฝะตะฝะธะตะผ ััะปะพะฒะธะน ัะฐัะธัะฐ (ะผะฐะบัะธะผะฐะปัะฝะฐั ัะบะพัะพััั, ะพะฑัะตะผ ะฟะฐะบะตัะฐ), ะธ ั.ะด.
 d) PCRF ะธ PCEF โ Policy and Charging Resource/Enforcement Function โ ะพัััะตััะฒะปัะตั ะบะพะฝััะพะปะปะธัััััั ััะฝะบัะธั ะฒัะฟะพะปะฝะตะฝะธั ัะฐัะธัะฝัั ะฟะปะฐะฝะพะฒ ะธ ััะปะพะฒะธะน ะดะพะณะพะฒะพัะฐ, ะพัะฟัะฐะฒะปัั ะฟัะฐะฒะธะปะฐ PCC (Policy and Charging Control) ะฝะฐ PDN GW.
 e) HSS โ Home Subscription Server โ ะฑะฐะทะฐ ะดะฐะฝะฝัั ะฟะพะปัะทะพะฒะฐัะตะปะตะน ะพะฟะตัะฐัะพัะฐ. ะฅัะฐะฝะธั ะฟะพััะพัะฝะฝัะต ะดะฐะฝะฝัะต ัะฐะบะธะต ะบะฐะบ: ัะฐะทัะตััะฝะฝัะต ัะตัะฒะธัั ะดะปั ะธัะฟะพะปัะทะพะฒะฐะฝะธั ะฟะพะปัะทะพะฒะฐัะตะปะตะผ, ัะฐะทัะตััะฝะฝัะต ัะตัะธ ะดะปั ะฟะพะดะบะปััะตะฝะธั, ะบะปััะธ ะดะปั ัะธััะพะฒะฐะฝะธั, ะธะดะตะฝัะธัะธะบะฐัะพัั ะฟะพะปัะทะพะฒะฐัะตะปั ะธ ั.ะด.
 f) Service PDNs โ ัะตัะฒะธัั ะพะฟะตัะฐัะพัะฐ, ัะฐะบะธะต ะบะฐะบ IMS, ะปะธะฑะพ ะธะฝัะตัะฝะตั.
 g) ePDG โ evolved Packet Data Gateway โ ะพัะฒะตัะฐะตั ะทะฐ ะฟะพะดะบะปััะตะฝะธะต ััะพัะพะฝะฝะตะน ัะตัะธ, ะฝะต ะพัะฝะพัััะตะนัั ะบ 3GPP. ะัะฟะพะปะฝัะตั ััะฝะบัะธะธ ัะพะตะดะธะฝะตะฝะธั ั PGW ะธ AAA, ัะธััะพะฒะฐะฝะธั ะดะฐะฝะฝัั ัะตัะตะท IPSec, ะฐ ัะฐะบะถะต Handoverโะฐ ะธะท ััะพัะพะฝะฝะตะน ัะตัะธ ะฒ LTE.
 h) AAA โ Authentication and Authorizing โ ะฒัะฟะพะปะฝัะตั ััะฝะบัะธะธ ะฟัะพะฒะตัะบะธ ะฟะพะปัะทะพะฒะฐัะตะปั. AAA ะฟะพะปััะฐะตั ะดะฐะฝะฝัะต ะพ ะฟะพะปัะทะพะฒะฐัะตะปะต ะธะท HSS ะธ ะฟัะพะฒะตััะตั, ะธะผะตะตั ะปะธ ะฟะพะปัะทะพะฒะฐัะตะปั ะดะพัััะฟ ะบ ัะธััะตะผะต.


## 1. LTE-Uu

LTE-Uu โ ัะฐะดะธะพะธะฝัะตััะตะนั ะดะปั ะพะฑะผะตะฝะฐ ะดะฐะฝะฝัะผะธ ะผะตะถะดั UE ะธ eNB. ะัะฟัะฐะฒะบะฐ ะดะฐะฝะฝัั ะผะตะถะดั UE ะธ eNB ะพัะณะฐะฝะธะทะพะฒะฐะฝะฐ ะบะฐะฝะฐะปะฐะผะธ: ัะธะทะธัะตัะบะธะผะธ, ััะฐะฝัะฟะพััะฝัะผะธ ะธ ะปะพะณะธัะตัะบะธะผะธ. ะะพะบะฐ ััะพ ะฟัะธะฒะตะดั ะบัะฐัะบะพะต ะพะฟะธัะฐะฝะธะต ะบะฐะถะดะพะณะพ ะธะท ะบะฐะฝะฐะปะพะฒ, ะฟะพัะพะผ ะฟัะพะนะดะตะผัั ะฟะพ ะบะฐะถะดะพะผั ะฟะพะดัะพะฑะฝะตะต.

ะคะธะทะธัะตัะบะธะต ะบะฐะฝะฐะปั:
1. PDCCH โ Physical Downlink Control Channel โ ะพัะฝะพะฒะฝะพะน ะบะฐะฝะฐะป, ะธัะฟะพะปัะทัััะธะนัั ะดะปั ะพัะฟัะฐะฒะบะธ DCI (Downlink Control Information). ะคัะฝะบัะธัะผะธ DCI ัะฒะปัะตััั ะฒัะดะตะปะตะฝะธะต ัะตััััะพะฒ ะดะปั UE, ะฐ ัะฐะบะถะต ะพัะฟัะฐะฒะบะฐ TPC (Transmit Power Control) ะดะปั ัะฟัะฐะฒะปะตะฝะธั ะผะพัะฝะพัััั ะฐะฝัะตะฝะฝั UE.
2. PMCH โ Physical Multicast Channel โ ะบะฐะฝะฐะป, ะธัะฟะพะปัะทัััะธะนัั ะดะปั ะพัะฟัะฐะฒะบะธ MCH (Multicast Channel), ะบะพัะพััะน ะธัะฟะพะปัะทัะตััั ะฒ MBMS (Multimedia Broadcast and Multicast Services)
3. PHICH โ Physical HARQ Indicator Channel โ ะบะฐะฝะฐะป, ะธัะฟะพะปัะทัััะธะนัั ะดะปั ะพัะฟัะฐะฒะบะธ HARQ ัะพะพะฑัะตะฝะธะน (ACK/NACK).
4. PDSCH โ Physical Downlink Shared Channel โ ะพัะฝะพะฒะฝะพะน ะบะฐะฝะฐะป ะดะปั ะฟะพะปัะทะพะฒะฐัะตะปััะบะธั ะธ ัะฟัะฐะฒะปัััะธั ะดะฐะฝะฝัั, ะบะพัะพััะน ะฟะพะดะดะตัะถะธะฒะฐะตั ัะฐะทะดะตะปะตะฝะธะต ัะตััััะพะฒ ะผะตะถะดั ะฟะพะปัะทะพะฒะฐัะตะปัะผะธ.
5. PCFICH โ Physical Control Frame Indicator Channel โ ะบะฐะฝะฐะป, ะธัะฟะพะปัะทัััะธะนัั ะดะปั ะพัะฟัะฐะฒะบะธ CFI (Control Format Indicator). CFI ัะบะฐะทัะฒะฐะตั ัะธัะปะพ OFDM ัะธะผะฒะพะปะพะฒ ะฒ ัะฟัะฐะฒะปัััะธั ะบะฐะฝะฐะปะฐั (PDCCH ะธ PHICH).
6. PBCH โ Physical Broadcast Channel โ ะบะฐะฝะฐะป, ะธัะฟะพะปัะทัััะธะนัั ัะพะปัะบะพ ะดะปั ะพัะฟัะฐะฒะบะธ MIB (Master Information Block). MIB ัะพะดะตัะถะธั ะพัะฝะพะฒะฝัะต ะฟะฐัะฐะผะตััั, ะฝัะถะฝัะต UE ะดะปั ะบะพะผะผัะฝะธะบะฐัะธะธ ั ัะตััั.
7. PUCCH โ Physical Uplink Control Channel โ ะบะฐะฝะฐะป, ะธัะฟะพะปัะทัััะธะนัั ะดะปั ะพัะฟัะฐะฒะบะธ CSI (Channel Status Information), UCI (Uplink Control Information), RS (Reference Signal) ะธ HARQ ACK/NACK. ะฏะฒะปัะตััั ะพัะฝะพะฒะฝัะผ ัะฟัะฐะฒะปัััะธะผ ะบะฐะฝะฐะปะพะผ ะฒ ะฝะฐะฟัะฐะฒะปะตะฝะธะธ uplink. ะะต ััะตะฑัะตั ะฟะพััะพัะฝะฝะพะณะพ ะฒัะดะตะปะตะฝะธั ัะตััััะพะฒ, ัััะตััะฒัะตั ััะฐัะธัะตัะบะธ ะธ ะพะฟัะตะดะตะปัะตััั ะฟัะธ ะฟะพะดะบะปััะตะฝะธะธ ะบ ัะตัะธ.
8. PUSCH โ Physical Uplink Shared Channel โ ะพัะฝะพะฒะฝะพะน ะบะฐะฝะฐะป ะฒ ะฝะฐะฟัะฐะฒะปะตะฝะธะธ uplink ะดะปั ะพัะฟัะฐะฒะบะธ ะฟะพะปัะทะพะฒะฐัะตะปััะบะธั ะธ ัะฟัะฐะฒะปัััะธั ะดะฐะฝะฝัั.
9. PRACH โ Physical Random Access Channel โ ะบะฐะฝะฐะป, ะธัะฟะพะปัะทัััะธะนัั ะดะปั ะฟัะพัะตะดััั RACH. RACH ะธัะฟะพะปัะทัะตััั ะฟัะธ ะฟะตัะฒะพะฝะฐัะฐะปัะฝะพะน ะฟะพะดะณะพัะพะฒะบะต ัะพะตะดะตะฝะตะฝะธั, ะปะธะฑะพ ะฟัะธ ัะพะฒะตััะตะฝะธะธ Handoverโะฐ, ะปะธะฑะพ ะฟัะธ ะฟะตัะตัะพะดะต ัะพััะพัะฝะธั UE ะธะท ECM IDLE ะธ RRC IDLE ะฒ ัะพััะพัะฝะธะต ACTIVE. (ะฟัะพ ะฟัะพัะพะบะพะป RRC ะธ ECM ะฟะพะทะถะต)

ะคะธะทะธัะตัะบะธะต ะบะฐะฝะฐะปั ะพะฟัะตะดะตะปััั ะผะตัะพะด ะผะพะดัะปััะธะธ ะธ ัะฐัะฟัะตะดะตะปะตะฝะธั ัะธะผะฒะพะปะพะฒ ะธ ะบะฐะดัะพะฒ. ะะดะฝะฐะบะพ LTE ะธะผะตะตั ะฒะพะทะผะพะถะฝะพััั ะบ ะธะทะผะตะฝะตะฝะธั ะผะตัะพะดะฐ ะบะพะดะธัะพะฒะบะธ, ะปะธะฑะพ ะดััะณะธั ัะฐัะฐะบัะตัะธััะธะบ ะบะฐะฝะฐะปะฐ ะดะธะฝะฐะผะธัะตัะบะธ. ะะปั ััะพะณะพ ัััะตััะฒัะตั ัะฐะทะดะตะปะตะฝะธะต ะฝะฐ ัะธะทะธัะตัะบะธะต ะธ ััะฐะฝัะฟะพััะฝัะต ะบะฐะฝะฐะปั. ะขัะฐะฝัะฟะพััะฝัะต ะบะฐะฝะฐะปั ะพะฟัะตะดะตะปััั ะผะตัะพะด ะบะพะดะธัะพะฒะบะธ, ัะฐะทะดะตะปะตะฝะธะต ะฝะฐ ะฟะพะปัะทะพะฒะฐัะตะปะธ, ัะฐะทะฑะธะตะฝะธะต ะฝะฐ ััะฐะฝัะฟะพััะฝัะต ะฑะปะพะบะธ ะธ ั.ะด. ะะธะถะต ะฟัะธะฒะตะดะตะฝะพ ะพะฟะธัะฐะฝะธะต ะบะฐะถะดะพะณะพ ะธะท ััะฐะฝัะฟะพััะฝัั ะบะฐะฝะฐะปะพะฒ:
1. DL-SCH โ ะพัะฝะพะฒะฝะพะน ะบะฐะฝะฐะป ะดะปั ะพัะฟัะฐะฒะบะธ ะบะฐะบ ะฟะพะปัะทะพะฒะฐัะตะปััะบะธั, ัะฐะบ ะธ ัะฟัะฐะฒะปัััะธั ัะตััั ะดะฐะฝะฝัั.
2. BCH โ Broadcast Channel โ ะบะฐะฝะฐะป, ะธัะฟะพะปัะทัััะธะนัั ะดะปั ะพะฟัะตะดะตะปะตะฝะธั ะบะพะดะธัะพะฒะบะธ MIB ะธ ะตะณะพ ะพัะฟัะฐะฒะบะธ ะฝะฐ PBCH.
3. PCH โ Paging Channel โ ะบะฐะฝะฐะป, ะธัะฟะพะปัะทัััะธะนัั ะดะปั ะพัะฟัะฐะฒะบะธ ัะพะพะฑัะตะฝะธะน Paging Procedure. Paging ะธัะฟะพะปัะทัะตััั ะดะปั ัะฒะตะดะพะผะปะตะฝะธะน UE ะพ ะฝะพะฒัั ะดะฐะฝะฝัั, ะปะธะฑะพ ะดััะณะธั ัะพะฑััะธะน ะฒ ัะตัะธ.
4. UL-SCH โ Uplink Shared Channel โ ะพัะฝะพะฒะฝะพะน ะบะฐะฝะฐะป ะดะปั ะพัะฟัะฐะฒะบะธ ะฟะพะปัะทะพะฒะฐัะตะปััะบะธั ะดะฐะฝะฝัั ะธ ัะพะพะฑัะตะฝะธะน ัะฟัะฐะฒะปะตะฝะธั ัะตััั.
5. RACH โ ะบะฐะฝะฐะป, ะธัะฟะพะปัะทัััะธะนัั ะดะปั ะพัััะตััะฒะตะฝะธั ะฟัะพัะตะดััั RACH.

ะขะฐะบ ะบะฐะบ, ะฝะฐะฟัะธะผะตั, ะฟะพ ะบะฐะฝะฐะปั DL-SCH ะผะพะณัั ะพัะฟัะฐะฒะปััััั ะดะฐะฝะฝัะต ะบะฐะบ ะดะปั ะฒัะตั ะฟะพะปัะทะพะฒะฐัะตะปะตะน ัะตัะธ, ัะฐะบ ะธ ะดะฐะฝะฝัะต, ะฟัะตะดะฝะฐะทะฝะฐัะตะฝะฝัะต ะดะปั ะพะดะฝะพะณะพ ะฟะพะปัะทะพะฒะฐัะตะปั, ัะพ ะฝะตะพะฑัะพะดะผะพ ะดะฐะปะตะต ัะฐะทะดะตะปะธัั ะบะฐะฝะฐะปั ะฟะพ ะฟะฐัะฐะผะตััะฐะผ ะพัะฟัะฐะฒะบะธ. ะะปั ััะพะณะพ ะธัะฟะพะปัะทััััั ะปะพะณะธัะตัะบะธะต ะบะฐะฝะฐะปั.
ะะฝะธ ะพะฟัะตะดะตะปััั ัะธะฟ ะพัะฟัะฐะฒะปัะตะผัั ะดะฐะฝะฝัั, ะฐ ัะฐะบะถะต ัะปัะถะฐั ะดะปั ะพัะณะฐะฝะธะทะฐัะธะธ DRB (Data Radio Bearer). ะะธะถะต ะฟัะธะฒะตะดะตะฝะพ ะพะฟะธัะฐะฝะธะต ะบะฐะถะดะพะณะพ ะธั ะปะพะณะธัะตัะบะธั ะบะฐะฝะฐะปะพะฒ:
1. MCCH/MTCH โ Multicast Control/Traffic Channel โ ะบะฐะฝะฐะปั ะดะปั ะพัะฟัะฐะฒะบะธ ัะฟัะฐะฒะปัััะธั ะดะฐะฝะฝัั ะธ ัะตะฐะปัะฝัั ะดะฐะฝะฝัั ัะพะพัะฒะตัััะฒะตะฝะฝะพ. (Logical Multicast Traffic Channel, ะดะฐ, ะพัััะดะฐ).
2. DCCH/DTCH โ Dedicated Control/Traffic Channel โ ะฒัะดะตะปะตะฝะฝัะน ะบะฐะฝะฐะป ะดะปั ะพัะฟัะฐะฒะบะธ ัะพะพะฑัะตะฝะธะน ัะฟัะฐะฒะปะตะฝะธั, ะปะธะฑะพ ะดะปั ะพัะฟัะฐะฒะบะธ ะฟะพะปัะทะพะฒะฐัะตะปััะบะธั ะดะฐะฝะฝัั ัะพะพัะฒะตััะฒะตะฝะฝะพ.
3. CCCH โ Common Control Channel โ ะพะฑัะธะน ะบะฐะฝะฐะป ัะฟัะฐะฒะปะตะฝะธั, ะฟัะตะดะฝะฐะทะฝะฐัะตะฝะฝัะน ะดะปั ะพัะฟัะฐะฒะบะธ ัะพะพะฑัะตะฝะธะน ะฒัะตะผ UE.
4. BCCH โ Broadcast Control Channel โ ะบะฐะฝะฐะป ะดะปั ะฟะตัะตะดะฐัะธ ะพัะฝะพะฒะฝัั ัะฟัะฐะฒะปัััะธั ัะพะพะฑัะตะฝะธะน ะฒัะตะผ UE.
5. PCCH โ Paging Control Channel โ ะบะฐะฝะฐะป ะดะปั ะฟะตัะตะดะฐัะธ Paging ัะพะพะฑัะตะฝะธะน.

ะะปั ัะธะฝััะพะฝะธะทะฐัะธะธ, ะพัะตะฝะบะธ ะบะฐัะตััะฒะฐ ะบะฐะฝะฐะปะฐ, ะดะตะผะพะดัะปััะธะธ ัะธะณะฝะฐะปะฐ, ะธ ั.ะด, ะฟะพะผะธะผะพ ะบะฐะฝะฐะปะพะฒ ะดะฐะฝะฝัั ัััะตััะฒััั ัะธะณะฝะฐะปั:
1. CRS โ Cell specific Reference Signal โ ัะธะณะฝะฐะป, ะธัะฟะพะปัะทัััะธะนัั ะดะปั ะธะทะผะตัะตะฝะธั ะฟะฐัะตะผััะพะฒ RSRP ะธ RSRQ, ะฐ ัะฐะบะถะต ะดะปั MIMO (TM4).
2. DMRS โ Demodulation Reference Signal โ ัะธะณะฝะฐะป, ัะฝะธะบะฐะปัะฝัะน ะดะปั ะบะฐะถะดะพะณะพ UE, ะธัะฟะพะปัะทัััะธะนัั ะดะปั ะดะตะผะพะดัะปััะธะธ ัะธะณะฝะฐะปะฐ (TM9).
3. CSIRS โ Channel State Information Reference Signal โ ัะธะณะฝะฐะป, ะธัะฟะพะปัะทัััะธะนัั ะดะปั ะพัะตะฝะบะธ ัะพััะพัะฝะธั ะบะฐะฝะฐะปะฐ (TM9).
4. PRS โ Positioning Reference Signal โ ัะธะณะฝะฐะป, ะธัะฟะพะปัะทัััะธะนัั eNB ะดะปั ะพะฟัะตะดะตะปะตะฝะธั ะฟะพะปะพะถะตะฝะธั UE.
5. SRS โ Sounding Reference Signal โ ัะธะณะฝะฐะป, ะธัะฟะพะปัะทัััะธะนัั eNB ะดะปั ะพะฟัะตะดะตะปะตะฝะธั ะบะฐัะตััะฒะฐ Uplink ะบะฐะฝะฐะปะฐ ะดะปั ะบะฐะถะดะพะณะพ ััััะพะนััะฒะฐ.
6. PSS โ Primary Synchronization Signal โ ะพะดะธะฝ ะธะท ัะธะณะฝะฐะปะพะฒ, ะธัะฟะพะปัะทัััะธะนัั ะดะปั ะฟะตัะฒะธัะฝะพะน ัะธะฝััะพะฝะธะทะฐัะธะธ ะผะตะถะดั eNB ะธ UE ะฟัะธ ะฟะพะดะบะปััะตะฝะธะธ.
7. SSS โ Secondary Synchronization Signal โ ะฒัะพัะพะน ัะธะณะฝะฐะป, ะธัะฟะพะปัะทัััะธะนัั ะดะปั ะฟะตัะฒะธัะฝะพะน ัะธะฝััะพะฝะธะทะฐัะธะธ.


PSS ะธ SSS ะธัะฟะพะปัะทััััั ะดะปั ะฟะพะปััะตะฝะธั Physical Cell ID. PSS ะธัะฟะพะปัะทัะตััั ะดะปั ะฟะพะปััะตะฝะธั SSS, ะฟะพััะพะผั ะดะปั ัะธะฝััะพะฝะธะทะฐัะธะธ ะธ ะฟะพะดะบะปััะตะฝะธั ะบ eNB ััะตะฑัะตััั ะฟะพะปััะธัั ัะฝะฐัะฐะปะฐ PSS, ะทะฐัะตะผ SSS. ะะตัะฐะปะธ ะณะตะฝะตัะฐัะธะธ ัะธะณะฝะฐะปะพะฒ ะฑัะดัั ัะฐะทะพะฑัะฐะฝั ะดะฐะปะตะต.

### 1.1. Physical Channels

ะะฐะถะดัะน ัะธะทะธัะตัะบะธะน ะบะฐะฝะฐะป ะธะผะตะตั ัะฒะพะธ ัะฝะธะบะฐะปัะฝัะต ัะฐัะฐะบัะตัะธััะธะบะธ:
1. ะะตัะพะด ะผะพะดัะปััะธะธ โ ะบะฐะถะดัะน ะบะฐะฝะฐะป ะพะฟัะตะดะตะปัะตััั ะผะตัะพะดะพะผ ะผะพะดัะปััะธะธ: QAM, QPSK, BPSK
2. ะะฐะทะผะตัะตะฝะธะต ะฒ Resource Grid โ ะบะฐะถะดัะน ะบะฐะฝะฐะป ะธะผะตะตั ัะฒะพั ะผะตััะพ, ะบะพัะพัะพะต ะพะฟัะตะดะตะปัะตััั ะฟะฐัะฐะผะตััะฐะผะธ ัะฐััะพัั ะธ ะฒัะตะผะตะฝะตะผ ะฟะตัะตะดะฐัะธ.
3. ะะพัะฝะพััั โ eNB ะพัะฟัะฐะฒะปัะตั ะบะฐะถะดัะน ะบะฐะฝะฐะป ั ะพะฟัะตะดะตะปัะฝะฝะพะน ะทะฐะดะฐะฝะฝะพะน ะผะพัะฝะพัััั, ะบะพัะพัะฐั, ะพะดะฝะฐะบะพ ะผะพะถะตั ะผะตะฝััััั ะฒ ัะฐะผะบะฐั ะพะดะฝะพะณะพ ะบะฐะฝะฐะปะฐ.
4. Precoding/Layer Mapping/Scrambling โ ะฟัะพ ััะธ ะฟะพะทะถะต

#### 1.1.1. Resource Grid ะธ Frame Structure

ะะปั ะฝะฐัะฐะปะฐ ะพะฟัะตะดะตะปะธะผัั ั ะฟะพะปะพะถะตะฝะธะตะผ ะบะฐะฝะฐะปะฐ ะฟะพ ะฒัะตะผะตะฝะธ ะธ ัะฐััะพัะต, ะฐ ัะฐะบะถะต ั ัะฐะนะผะธะฝะณะฐะผะธ ะพัะฟัะฐะฒะบะธ ะดะฐะฝะฝัั.

ะัะฟัะฐะฒะบะฐ ะดะฐะฝะฝัั ะฒ LTE ะพัััะตััะฒะปัะตััั ะฟะพ ะบะฐะดัะฐะผ. ะข.ะต ะพะดะธะฝ LTE Frame ัะพะดะตัะถะธั ะฒ ัะตะฑะต ะฒัะต ะดะฐะฝะฝัะต ัะพ ะฒัะตั ะบะฐะฝะฐะปะพะฒ. ะกััะตััะฒัะตั ะดะฒะฐ ะฒะธะดะฐ frame'ะพะฒ: FDD ะธ TDD. FDD โ Frequency Division Duplexing, ัะฐะทะดะตะปัะตั ัะฐััะพัั ะฟะพะปัะทะพะฒะฐัะตะปะตะน ะธ ะฒััะบะธ, ะฟะพะทะฒะพะปัั ััััะพะนััะฒะฐะผ ะฟัะธะฝะธะผะฐัั ะธ ะพัะฟัะฐะฒะปััั ะดะฐะฝะฝัะต ะพะดะฝะพะฒัะตะผะตะฝะฝะพ. TDD โ Time Division Duplexing, ะฝะต ัะฐะทะดะตะปัะตั ัะฐััะพัั ะฟะพะปัะทะพะฒะฐัะตะปะตะน ะธ ะฒััะบะธ, ั.ะต ะฒัะดะตะปัะตั ะพัะดะตะปัะฝัะต ะฟัะพะผะตะถััะบะธ ะฒัะตะผะตะฝะธ ะดะปั ะบะฐะถะดะพะณะพ ะฟะพะปัะทะพะฒะฐัะตะปั ะฝะฐ ะพัะฟัะฐะฒะบั ะธ ะฟัะธะตะผ ะดะฐะฝะฝัั. ะะฐััะผะฐััะธะฒะฐัั ะฑัะดะตะผ ัะพะปัะบะพ FDD, ัะฐะบ ะบะฐะบ ะพะฝ ะธัะฟะพะปัะทัะตััั ัะฐัะต ะฒัะตะณะพ.

ะะฐััะผะพััะธะผ ััััะบัััั frame ะฒะพ ะฒัะตะผะตะฝะธ. ะกะปะตะดัััะฐั ะธะปะปััััะฐัะธั ะฝะต ะฟะพะบะฐะทัะฒะฐะตั ัะฐัะฟัะตะดะตะปะตะฝะธั ัะธะผะฒะพะปะพะฒ ะฟะพ ัะฐััะพัะต:
```
 slot, Ts=0.5ms                               
โโโโโโโฌโโโโโโฌโโโโโโฌโโโโโโโโโโโโโฌโโโโโโโฌโโโโโโโ
โ  0  โ  1  โ  2  โ     ...    โ  18  โ  19  โ
โ     โ     โ     โ            โ      โ      โ
โโโโโโโดโโโโโโดโโโโโโดโโโโโโโโโโโโโดโโโโโโโดโโโโโโโ
 โโโโโโโโโโโบ                                  
  subframe                                    
                                              
 โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโบ 
                  frame, Tf=10ms              
```

ะกะพะพัะฒะตััะฒะตะฝะฝะพ ะพัััะดะฐ ะฒะธะดะฝะพ:
 1. ะะปะธัะตะปัะฝะพััั ะพะดะฝะพะณะพ frame'ะฐ โ 10 ะผัะตะบ
 2. ะ ะบะฐะถะดะพะผ frame 10 subframe
 3. ะ ะบะฐะถะดะพะผ subframe 2 ัะปะพัะฐ

ะะพะถะฝะพ ัะพะณะดะฐ ะทะฐะดะฐัั ะฒะพะฟัะพั: โัะฒะปัะตััั ะปะธ slot ัะฐะผัะผ ัะปะตะผะตะฝัะฐัะฝัะผ ัะปะตะผะตะฝัะพะผ ะพัะฟัะฐะฒะบะธ?โ. ะะตั, ะตัะปะธ ะฟัะธะฑะปะธะทะธัั ััััะบัััั ะตัั, ัะพ ะผะพะถะฝะพ ะฑัะดะตั ัะฐะทะฑะธัั ัะปะพั ะฝะฐ 7 ะผะตะฝััะธั ะฑะปะพะบะพะฒ, ัะธะผะฒะพะปะพะฒ (OFDM symbol):
```
               7 OFDM Symbols            
    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโบ
     โโฌโโโโฌโฌโโโโฌโฌโโโโฌโฌโโโโฌโฌโโโโฌโฌโโโโฌโฌโโโโ
     โโ 0 โโ 1 โโ 2 โโ 3 โโ 4 โโ 5 โโ 6 โ
     โโ   โโ   โโ   โโ   โโ   โโ   โโ   โ
     โโดโโโโดโดโโโโดโดโโโโดโดโโโโดโดโโโโดโดโโโโดโดโโโโ
          โฒ  โฒ                           
          โ  โ                           
          โ  โ                           
          โsymbol                        
      โโโโโ                              
      โ                                  
cyclic prefix                            
```

ะัััะดะฐ ะฒะธะดะฝะพ, ััะพ ะบะฐะถะดัะน ัะปะพั ัะฐะทะฑะธั ะฝะฐ 7 OFDM ัะธะผะฒะพะปะพะฒ, ะฟะตัะตะด ะบะฐะถะดัะผ ะธะท ะบะพัะพััั ะธะดัั Cyclic Prefix. Cyclic Prefix ะฟะพะฒัะพััะตั ะบะพะฝะตั ัะตะบััะตะณะพ ัะธะผะฒะพะปะฐ (ั.ะต ะดะปั ัะธะผะฒะพะปะฐ 0, Cyclic Prefix ะฟะตัะตะด ะฝะธะผ ะฑัะดะตั ัะพะดะตัะถะฐัั ะฝะตะบัะพัะพะต ะบะพะปะธัะตััะฒะพ sample'ะพะฒ ะธะท ะบะพะฝัะฐ ััะพะณะพ ัะธะผะฒะพะปะฐ). ะญัะพ ะฝัะถะฝะพ ะดะปั ัะพะทะดะฐะฝะธั ะธะฝัะตัะฒะฐะปะฐ ะผะตะถะดั ัะธะผะฒะพะปะฐะผะธ ะดะปั ะธะทะฑะตะถะฐะฝะธั ISI (Intersymbol Interference).

ะะฐ ะธะทะพะฑัะฐะถะตะฝะธะธ ะฝะต ะฑัะปะธ ัะบะฐะทะฐะฝั ะบะพะฝะบัะตัะฝัะต ะทะฝะฐัะตะฝะธั ะดะปะธัะตะปัะฝะพััะตะน ัะปะตะผะตะฝัะพะฒ:
 1. ะะฐะถะดัะน ะฟะตัะฒัะน CP ัะปะพัะฐ ะธะผะตะตั ะดะปะธะฝั ะฒ 160 sample'ะพะฒ (ั.ะต 5.2 us)
 2. ะะฐะถะดัะน ัะธะผะฒะพะป ะธะผะตะตั ะดะปะธะฝั ะฒ 2048 sample'ะพะฒ (ั.ะต 66.7 us)
 3. ะััะฐะปัะฝัะต CP ะธะผะตัั ะดะปะธะฝั ะฒ 144 sample'ะฐ (ั.ะต 4.7 us)

ะัะต ะบะพะฝะตัะฝะพ ะฝะตะผะฝะพะณะพ ัะปะพะถะฝะตะต, ัะฐะบ ะบะฐะบ ะดะปะธัะตะปัะฝะพััะธ ะฒ ัะตะบัะฝะดะฐั ะฑัะดัั ะพัะปะธัะฐัััั ะฒ ะทะฐะฒะธัะธะผะพััะธ ะพั Sample Rate ะฒััะบะธ. ะะฑััะฝะพ ััะพ 30.72 M samples/sec.

ะขะตะฟะตัั, ะบะฐะบ ัะพะปัะบะพ ะผั ะฟะพะฝะธะผะฐะตะผ ะบะฐะบ ัะธะผะฒะพะปั ะพัะณะฐะฝะธะทะพะฒะฐะฝั ะฒะพ ะฒัะตะผะตะฝะธ, ะฝะฐะดะพ ัะฐะทะพะฑัะฐัััั ั ะพัะณะฐะฝะธะทะฐัะธะตะน ัะธะผะฒะพะปะพะฒ ะฟะพ ัะฐััะพัะต.

ะกะธะณะฝะฐะป LTE ะผะพะถะฝะพ ะฟัะตะดััะฐะฒะธัั ะฒ ะฒะธะดะต ะดะฒัะผะตัะฝะพะน ะบะฐััั, ะณะดะต ะฟะพ ะฒะตััะธะบะฐะปะธ ะฑัะดะตั ัะฐััะพัะฐ, ะฐ ะฟะพ ะณะพัะธะทะพะฝัะฐะปะธ โ ะฒัะตะผั. ะฏ ัะดะตะปะฐะป ัะฐะบัั ะธะปะปััััะฐัะธั, ะณะดะต ะบะฐะถะดะฐั ะบะปะตัะบะฐ โ ััะพ ะพะดะธะฝ ัะธะผะฒะพะป. ะะปั ัะดะพะฑััะฒะฐ ัะฐะบะถะต ะฟะพะดะฟะธัะฐะฝั ัะปะพัั ะธ subframe'ั, ะฐ ัะฐะบะถะต ัะฒะตัะฐะผะธ ะพะฑะพะทะฝะฐัะตะฝั ะพัะดะตะปัะฝัะต ัะธะทะธัะตัะบะธะต ะบะฐะฝะฐะปั: (Resource Grid) https://imgur.com/a/4FquDey.

ะะฐััะผะพััะธะผ ััั ะธะปะปััััะฐัะธั ะฟะพะดัะพะฑะฝะตะต:
 1. ะะตัั ัะธะณะฝะฐะป LTE ะฟะพ ัะฐััะพัะต ัะฐะทะฑะธั ะฝะฐ ะพัะดะตะปัะฝัะต ะฟะพะดะฝะตัััะธะต, ะบะพัะพััะต ะฝะฐะทัะฒะฐัััั Subcarrier. ะะพะดะฝะตัััะธะต ัะฒะปััััั ะพัะฝะพะฒะฝะพะน ะธะดะตะตะน OFDM ะธ DFT-S-OFDM, ะฝะพ ะพะฑ ััะพะผ ะฟะพะทะถะต.
 2. ะะตะถะดั ะฟะพะดะฝะตัััะธะผะธ ะตััั ะฝะตะบะพัะพัะพะต ัะฐัััะพัะฝะธะต, delta phi, ะบะพัะพัะพะต ะผะพะถะตั ัะพััะฐะฒะปััั 15 KHz ะธะปะธ 7.5 KHz (ะฒ ะฝะพะฒัั ัะฟะตัะธัะธะบะฐัะธัั)
 3. ะะพะปะธัะตััะฒะพ ะฟะพะดะฝะตัััะธั ัะฐะทะปะธัะฐะตััั ะฒ ะทะฐะฒะธัะธะผะพััะธ ะพั Bandwith ะฒััะบะธ. ะะฐะฟัะธะผะตั, ะดะปั BW=20MHz, ะบะพะป-ะฒะพ ะฟะพะดะฝะตัััะธั Nsc=1200, ะฐ ะดะปั BW=5, Nsc=300.

ะั ัะพะปัะบะพ ััะพ ัะฐััะผะพััะตะปะธ ะบะฐะบ ะฟะตัะตะดะฐัะฐ ะพัะณะฐะฝะธะทะพะฒะฐะฝะฐ ะฒะพ ะฒัะตะผะตะฝะธ ะธ ะฟะพ ัะฐััะพัะต, ัะตะฟะตัั ัะฐััะผะพััะธะผ ะบะฐะบะธะต ัััะตััะฒััั ัะพััะฐะฒะฝัะต ัะปะตะผะตะฝัั. ะะฟััั, ััั ั ัะดะตะปะฐะป ะธะปะปััััะฐัะธั (Resource Grid Grouping) https://imgur.com/a/4FquDey.

ะะดะตัั ะฟัะตะดััะฐะฒะปะตะฝะฐ cัะตะผะฐ ะพะฑัะตะดะธะฝะตะฝะธั OFDM ัะธะผะฒะพะปะพะฒ. ะัะฐัะฝัะผ ะฒัะดะตะปะตะฝั Reference Signal, ะบะพะปะธัะตััะฒะพ Subcarrier ััะปะพะฒะฝะพะต. ะกะฐะผัะน ะผะฐะปะตะฝัะบะธะน ัะปะตะผะตะฝั RG โ Resource Element (RE), ัะพััะพะธั ะธะท 1 subcarrier x 1 symbol. 4 RE ะพะฑัะตะดะตะฝะตะฝั ะฒ Resource Element Group ะฟะพ subcarrier, Reference Signal ะฝะต ะฒะบะปััะฐะตััั ะฒ REG. ะัะฟัะฐะฒะบะฐ PDCCH ะพัะณะฐะฝะธะทะพะฒะฐะฝะฐ ะฟะพ Control Channel Element, ะบะพัะพััะน ัะพััะพะธั ะธะท 9 REG ะธะดััะธั ะพั ะพะดะฝะพะณะพ ะบัะฐั N^DL_RB PRB ะดะพ ะดััะณะพะณะพ, ะฟัะธ ััะพะผ ะผะตะฝัั ะฝะฐะฟัะฐะฒะปะตะฝะธะต. CCE ัะฐะบะถะต ะพะฑัะตะดะตะฝััััั ะฟะพ ะบะพะปะธะตััะฒั ะฒ Aggregation level.

ะัะฝะพะฒะฝะฐั ะตะดะธะฝะธัะฐ ะฒัะดะตะปะตะฝะธั ัะตััััะพะฒ โ Physical Resource Block. PRB ัะพััะพะธั ะธะท 84 RE: 12 subcarrier x 7 symbols (ะปะธะฑะพ 72 RE ะฟัะธ ะธัะฟะพะปัะทะพะฒะฐะฝะธะธ Extended Cyclic Prefix). PRB ะพะฑัะตะดะตะฝััััั ะฒ Resource Block Group. ะะพะปะธัะตััะฒะพ PRB ะฒ ะพะดะฝะพะผ RBG ะทะฐะฒะธัะธั ะพั System Bandwidth.

#### 1.1.2. Multiple Access

ะ ััะพะผ ัะฐะทะดะตะปะต ะฑัะดัั ัะฐััะผะพััะตะฝั ะดะตัะฐะปะธ ะณะตะฝะตัะฐัะธะธ ััะตะผ Multiple Access, ะบะพัะพััะต
ะธัะฟะพะปัะทััััั ะฒ LTE. ะัะพะฑะตะฝะฝะพััะธ ะบะฐะฝะฐะปะพะฒ ััะธััะฒะฐัััั ะฝะต ะฑัะดัั.

Multiple Access โ ััะพ ััะตะผะฐ ะพัะณะฐะฝะธะทะฐัะธะธ ัะธะณะฝะฐะปะฐ, ะฟัะธ ะบะพัะพัะพะผ ัะตััััั ัะฐะทะดะตะปััััั ะผะตะถะดั ะฟะพะปัะทะพะฒะฐัะตะปัะผะธ, ะบะฐะบ ะฑั ัะพะทะดะฐะฒะฐั ะฝะตัะบะพะปัะบะพ ะพัะดะตะปัะฝัั ะบะฐะฝะฐะปะพะฒ ะดะปั ะฟะตัะตะดะฐัะธ ะดะฐะฝะฝัั. ะ LTE ะธัะฟะพะปัะทััััั ะดะฒะฐ ะฒะธะดะฐ Multiple Access: OFDMA ะธ DFT-S-OFDMA (ะธะปะธ SC-OFDMA).

##### 1.1.2.1. Orthogonal Frequency Division Multiple Access (OFDMA)

ะงัะพะฑั ะฟะพะฝััั, ะบะฐะบ ัะฐะฑะพัะฐะตั OFDMA, ะฝะฐะดะพ ัะฝะฐัะฐะปะฐ ะฒัะฟะพะผะฝะธัั ะตะณะพ, ะบะฐะบ ะฑั, โะฟัะตะดัะตััะฒะตะฝะฝะธะบะฐโ, FDM, Frequency Division Multiplexing. ะ FDM ะบะฐะถะดะพะผั ะฟะพะปัะทะพะฒะฐัะตะปั ะฝะฐะทะฝะฐัะฐะตััั ัะฒะพั ะบะพะฝะบัะตัะฝะฐั ัะฐััะพัะฐ, ะฟัะธ ััะพะผ ัะฐััะพัั ัะฐัะฟะพะปะฐะณะฐัััั ัะฐะบ, ััะพ ะผะตะถะดั ะฝะธะผะธ ะตัั ะพััะฐัััั ะฟัะพัััะฐะฝััะฒะพ, ะฝะฐะทัะฒะฐะตะผะพะต Guard Band. ะะตะท ะฝะตะณะพ ัะฐััะพัั ัะพะทะดะฐะฒะฐะปะธ ะฑั ะธะฝัะตััะตัะตะฝัะธั ะธ ััะฐะฑะธะปัะฝะพััั ะบะฐะฝะฐะปะฐ ะฑัะปะฐ ะฑั ะฝะธะทะบะพะน. ะขะฐะบ ะบะฐะบ ะบะพะปะธัะตััะฒะพ ัะฐััะพั ะพะณัะฐะฝะธัะตะฝะพ Bandwith, ัะพ ะธ ะบะพะปะธัะตััะฒะพ ะพัะดะตะปัะฝัั ะบะฐะฝะฐะปะพะฒ ัะพะถะต ะพะณัะฐะฝะธัะตะฝะพ Bandwith. ะ ะฝะฐ ัะฐะผะพะผ ะดะตะปะต ะฒ ัะฐะบะพะน ะบะพะฝัะธะณััะฐัะธะธ ะบะพะปะธัะตััะฒะพ ะบะฐะฝะฐะปะพะฒ ะฑัะดะตั ัะฐะบ ะผะฐะปะพ, ััะพ ัััะตะบัะธะฒะฝะพััั ััะพะณะพ ะผะตัะพะดะฐ ัะพะถะต ะพัะตะฝั ะผะฐะปะฐ.

ะัะฟัะฐะฒะธัั ััั ะฟัะพะฑะปะตะผั ะฟะพะผะพะณะฐะตั ะพััะพะณะพะฝะฐะปัะฝะพััั. ะัะต ะฝะตัััะธะต ะฒ OFDMA ัะฐัะฟะพะปะฐะณะฐัััั ะพััะพะณะพะฝะฐะปัะฝะพ, ั.ะต ะฒ ะบะฐะถะดัะน ะพัะดะตะปัะฝัะน ะผะพะผะตะฝั ะปะธัั ะพะดะฝะฐ ะฝะตัััะฐั ะฝะฐัะพะดะธััั ะฒ ะฟะธะบะต, ะพััะฐะปัะฝัะต ะฒ ะฝัะปะต. ะญัะพ ะฟะพะทะฒะพะปัะตั ัะฑัะฐัั GB ะธ ัะผะตััะธัั ะฑะพะปััะต ะบะฐะฝะฐะปะพะฒ ะฒ Bandwith. ะขัั ัะพะถะต ั ะผะตะฝั ะทะฐะณะพัะพะฒะปะตะฝะฐ ะธะปะปััััะฐัะธั: (OFDM and FDM Comparison) https://imgur.com/a/4FquDey. ะกะฒะตััั โ ัะฐัะฟัะตะดะตะปะตะฝะธะต ะบะฐะฝะฐะปะพะฒ ะฟะพ ัะฐััะพัะต ะฟัะธ ะธัะฟะพะปัะทะพะฒะฐะฝะธะธ OFDM, ัะฝะธะทั โ ะฟัะธ ะธัะฟะพะปัะทะพะฒะฐะฝะธะธ FDM.

ะัั ะพะดะฝะธะผ ะฟัะตะธะผััะตััะฒะพะผ OFDM ัะฒะปัะตััั ะฝะธะทะบะธะน ISI. ะัะธ ะพัะฟัะฐะฒะบะต ะฟะพัะพะบะฐ ะฝะฐ ะพะดะฝะพะน ัะฐััะพัะต ั ะดะพััะฐัะพัะฝะพะน ะฒััะพะบะพะน ัะบะพัะพัััั, ะบะพะณะดะฐ ะฒัะตะผั ัะธะผะฒะพะปะฐ Ts ััะฐะฝะพะฒะธััั ะผะตะฝััะต ัะตะผ ะฒัะตะผั ะทะฐะดะตัะถะบะธ (ะฝะฐะฟัะธะผะตั ะธะท-ะทะฐ ะณะตะพะณัะฐัะธัะตัะบะธั ััะปะพะฒะธะน ะฟัะธ ะพััะฐะถะตะฝะธะธ ะฒะพะปะฝั), ะผะตะถะดั ัะธะผะฒะพะปะฐะผะธ ะฒะพะทะฝะธะบะฐะตั Interference. OFDM ะดะตะปะธั ะฒััะพะบะพัะบะพัะพััะฝะพะน ะฟะพัะพะบ ะดะฐะฝะฝัั ะฝะฐ ะฑะพะปััะพะต ะบะพะปะธัะตััะฒะพ ะฟะพัะพะบะพะฒ ะดะฐะฝะฝัั ั ะฝะธะทะบะพะน ัะบะพัะพัััั, ัะตะผ ัะฐะผัะผ ะธะทะฑะฐะฒะปัััั ะพั ISI, ะฝะพ ัะพััะฐะฝัั ัะบะพัะพััั ะฟะตัะตะดะฐัะธ.
```
        โโโโโโโโโโโโโ           โโโโโโโโโโโโโ                  
โโโโโโโโบโ    S/P    โ           โ    P/S    โโโโโโโโโโบ         
        โ           โ           โ           โ                  
        โโโฌโโโโฌโโโโฌโโ           โโโโโโโโโโโโโ                  
          โ   โ   โ               โฒ   โฒ   โฒ                    
          โผ   โผ   โผ               โ   โ   โ                    
        โโโโโโโโโโโโโ           โโโดโโโโดโโโโดโโ                  
        โModulation โ           โ   demod   โโโโโโโโโโโโโ      
        โMapping    โ           โ           โ           โ      
        โโโฌโโโโฌโโโโฌโโ           โโโโโโโโโโโโโ           โ      
          โ   โ   โ               โฒ   โฒ   โฒ             โ      
          โผ   โผ   โผ               โ   โ   โ             โ      
        โโโโโโโโโโโโโ           โโโดโโโโดโโโโดโโ      โโโโโโดโโโโโโ
        โ   IFFT    โ           โ    FFT    โโโโโโโบโChannel   โ
        โ           โ           โ           โ      โEstimationโ
        โโโฌโโโโฌโโโโฌโโ           โโโโโโโโโโโโโ      โโโโโโโโโโโโ
          โ   โ   โ               โฒ   โฒ   โฒ                    
          โผ   โผ   โผ               โ   โ   โ                    
        โโโโโโโโโโโโโ           โโโดโโโโดโโโโดโโ                  
        โ    P/S    โ           โ    S/P    โ                  
        โ           โ           โ           โ                  
        โโโฌโโโโฌโโโโฌโโ           โโโโโโโโโโโโโ                  
          โ   โ   โ                   โฒ                        
          โผ   โผ   โผ                   โ                        
        โโโโโโโโโโโโโ           โโโโโโโดโโโโโโ                  
        โ  Add CP   โ           โ  Remove   โ                  
        โ           โ           โ    CP     โ                  
        โโโฌโโโโฌโโโโฌโโ           โโโโโโโโโโโโโ                  
          โ   โ   โ                   โฒ                        
          โผ   โผ   โผ                   โ                        
        โโโโโโโโโโโโโ           โโโโโโโดโโโโโโ                  
        โ Passband  โxxxxxxxxxxxโ Passband  โ                  
        โ Generationโxxxxxxxxxxxโ   demod   โ                  
        โโโโโโโโโโโโโ    โฒ      โโโโโโโโโโโโโ                  
                         โ                                     
                         โ                                     
                 radio transmission                            
```

ะะฐ ัะธััะฝะบะต ะฟัะตะดััะฒะฐะปะตะฝะฐ ััะตะผะฐ ะณะตะฝะฐัะฐัะธะธ OFDM ัะธะณะฝะฐะปะฐ. ะ ะพัะฝะพะฒะต ะณะตะฝะตัะฐัะธะธ ะปะตะถะธั ัะฐัะฟัะตะดะตะปะตะฝะธะต ะดะฐะฝะฝัั ะฝะฐ ะฝะตะบะพัะพัะพะต ะบะพะปะธัะตััะฒะพ ะฟะพะดะฝะตัััะธั (Subcarriers). ะะตะบะพัะพััะต ะธะท ะฝะธั ะฟัะตะดะฝะฐะทะฝะฐัะตะฝั ะดะปั ะฟะตัะตะดะฐัะธ ะดะฐะฝะฝัั (Data Subcarriers), ะฐ ะฝะตะบะพัะพััะต ะดะปั ะฟะตัะตะดะฐัะธ ะบะพะฝััะฐะฝัะฝะพะณะพ ะทะฝะฐัะตะฝะธั, ะบะพัะพัะพะต ะธัะฟะพะปัะทัะตััั ะดะปั Channel Estimation (Pilot Subcarriers). ะะฐััะผะพััะธะผ ะฟัะพัะตะดััั ะณะตะฝะตัะฐัะธะธ OFDM ัะธะณะฝะฐะปะฐ ะดะปั 16QAM (ยต = 4).

1. S/P โ Serial To Parallel โ ััะฐะฟ ัะฐะทะดะตะปะตะฝะธั ะฟะพัะพะบะฐ ะฝะฐ ะพัะดะตะปัะฝัะต ัะธะผะฒะพะปั ะดะปั ะฟะพัะปะตะดัััะตะน ะผะพะดัะปััะธะธ. ะะผะตั ะฝะฐะฑะพั ะฑะธั $$ x = [x_0, x_1, \dots, x_{n-1}] $$ ะฝะตะพะฑัะพะดะธะผะพ ะฟะพะปััะธัั ะผะฐััะธัั
$$
X = \begin{pmatrix}
    x_0     & x_1         & \dots  & x_{\mu - 1}  \\ 
    x_{\mu} & x_{\mu + 1} & \dots  & x_{2\mu - 1} \\
    \vdots  & \vdots      & \ddots & \vdots       \\
    x_{(N^D_{subc} - 1)\mu} & x_{(N^D_{subc} - 1)\mu + 1} & \dots & x_{N^D_{subc}\mu - 1}
\end{pmatrix}
$$
:::margin{ml=28}
 ะะดะต ะบะฐะถะดะฐั ัััะพะบะฐ โ ะพัะดะตะปัะฝัะน ะฝะฐะฑะพั ะฑะธั, ะบะพัะพััะน ะผะพะถะฝะพ ะฟัะตะดััะฐะฒะธัั ะฒ ะฒะธะดะต QAM ัะธะผะฒะพะปะฐ. ะกะพะพัะฒะตัััะฒะตะฝะฝะพ, ะบะพะปะธัะตััะฒะพ ัััะพะบ ะฑัะดะตั ัะพะฒะฟะฐะดะฐัั ั ะบะพะปะธัะตััะฒะพะผ Data Subcarriers $$ N^D_{subc} $$.
:::

2. Modulation Mapping โ ััะฐะฟ ะผะพะดัะปััะธะธ ะฟะพะปััะตะฝะฝัั ะฑะธั. ะะผะตั ะฝะฐะฑะพั ะฑะธั $$ X $$ ะดะปั ะบะฐะถะดะพะน ะฟะพะดะฝะตัััะตะน, ะฟัะพะธะทะฒะพะดะธััั ัะพะพัะฝะพัะตะฝะธะต ะฝะฐะฑะพัะฐ ะฑะธั ั ัะฐะฑะปะธัะตะน ะผะพะดัะปััะธะธ. ะกะพะพัะฒะตัััะฒะตะฝะฝะพ, ะบะฐะถะดัะน ัะธะผะฒะพะป ะฟัะตะฒัะฐัะฐะตััั ะฒ ะฝะฐะฑะพั ะบะพะผะปะตะบัะฝัั ัะธัะตะป $$ m = [m_0, m_1, \dots, m_{i - 1}] $$, ะณะดะต $$ i $$ โ ะบะพะปะธัะตััะฒะพ ะผะพะดัะปะธััะตะผัั ัะธะผะฒะพะปะพะฒ ($$ N^D_{subc} $$)

3. Subcarrier and Pilot Carrier Allocation โ ะฝะฐ ััะพะผ ััะฐะฟะต ะฝะฐ ะบะฐะถะดัั ะฟะพะดะฝะตััััั ัะฐะทะผะตัะฐะตััั ะพะดะธะฝ QAM ัะธะผะฒะพะป, ะธะปะธ ะบะพะฝััะฐะฝัะฝะพะต ะทะฝะฐัะตะฝะธะต $$ P_v $$ (ะฝะฐ Pilot Subcarrier).
$$
S[k] = \begin{cases}
 m[k] & \text{ะตัะปะธ } k \in \text{ data subcarriers} \\
 P_v & \text{ะตัะปะธ } k \in \text{ pilot subcarriers} \\
\end{cases}
$$

4. IFFT โ Inverse Fast Fourier Transform โ ะบ ะฟะพะปััะตะฝะฝะพะผั ะผะฐััะธะฒั ะฟัะธะผะตะฝัะตััั IFFT ะดะปั ะณะตะฝะตัะฐัะธะธ ะพััะพะณะพะฝะฐะปัะฝะพะณะพ ัะธะณะฝะฐะปะฐ. 
$$
F[l] = \frac{1}{N_{subc}}\sum^{N_{subc} - 1}_{k = 0}{S[k]e^{j2\pi kl N^{-1}_{subc} }}
$$

5. Add Cyclic Prefix โ ะดะปั ัะพะณะพ, ััะพะฑั ะธะทะฑะฐะฒะธัััั ะพั ISI, ะฝะตะพะฑัะพะดะธะผะพ ะดะพะฑะฐะฒะธัั Cyclic Prefix. CP โ ััะพ ะบะพะฟะธั ะบะพะฝัะฐ ัะธะผะฒะพะปะฐ, ะบะพัะพััั ะดะพะฑะฐะฒะปััั ะฒ ะฝะฐัะฐะปะพ. $$ C[n] = [F[N_{subc} - N_{cp},\dots,F[N_{subc} - 1],F[0], F[1], \dots, F[N_{subc} - 1]]] $$ ะณะดะต $$ N_{cp} $$ โ ะบะพะปะธัะตััะฒะพ ัะธะผะฒะพะปะพะฒ ะดะปั ะบะพะฟะธัะพะฒะฐะฝะธั.

6. Passband generation โ ั.ะบ ะฟะพะปััะตะฝะฝัะน ัะตะทัะปััะฐั ัะฒะปัะตััั ะผะฐััะธะฒะพะผ ะบะพะผะปะตะบัะฝัั
ัะธัะตะป, ัะพ ะฝะตะพะฑัะพะดะธะผะพ ะฟะพะปััะธัั ัะธะณะฝะฐะป, ะบะพัะพััะน ะฑัะดะตั ัะพััะพััั ัะพะปัะบะพ ะธะท ัะธัะตะป, ะฑะตะท
ะบะพะผะฟะปะตะบัะฝะพะน ัะฐััะธ: $$ P[t] = Re{(C[t])} \cos{(2\pi f_c t)} - Im{(C[t])} \sin{(2\pi f_c t)} $$


ะ ัะฟะตัะธัะธะบะฐัะธะธ LTE ะพะฟัะตะดะตะปะตะฝั ะดะฒะฐ ัะธะฟะฐ CP: Normal CP ะธ Extended CP. ะ ัะฐะฑะปะธัะต ะฟัะธะฒะตะดะตะฝั ะทะฝะฐัะตะฝะธั ๐๐๐ ะดะปั ะบะฐะถะดะพะณะพ ัะธะฟะฐ CP ะธ โf:
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฆโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ            Configuration               โ        N_cp(k)             โ
โโโโโโโโโโโโโโโโโโโโฆโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฃ
โ Normal CP        โ ฮf = 15 kHz         โ 160 (k = 0)                โ
โ                  โ                     โ 144 (k โ {1,โฆ,6})          โ
โโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฃ
โ Extended CP      โ ฮf = 15 kHz         โ 512                        โ
โ                  โ ฮf = 7.5 kHz        โ 1024                       โ
โ                  โ ฮf = 1.25 kHz       โ 6144                       โ
โโโโโโโโโโโโโโโโโโโโฉโโโโโโโโโโโโโโโโโโโโโโฉโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

ะะฐะผ ะผะพะถะตั ะฑััั ะฟัะพัะต ะฟะพะฝััั ะณะตะฝะตัะฐัะธั ัะผะพััั ะฝะฐ ะบะพะด, ะฐ ะฝะต ะฝะฐ ะผะฐัะตะผะฐัะธะบั. ะะพััะพะผั:
```python
import numpy as np
import matplotlib.pyplot as plt
import math
import modulation

n_subc = 64
cp = int(n_subc * 0.25)
n_pilot = 8
pilot_value = 1
carrier_freq = 10000000
sampling_rate = 20000000
t_samp = 1 / sampling_rate

data_carriers_len = n_subc - n_pilot
bits_per_carrier = modulation.mu * data_carriers_len

# generates indices of all subcarriers from 0 to n_subc - 1
carriers = np.arange(n_subc)

# only the pilot carriers
# so we take each n_subc//n_pilot subcarrier
pilot_carriers = carriers[::n_subc//n_pilot]

# deleting all pilot carriers to get
# only the data carriers
data_carriers = np.delete(carriers, pilot_carriers)

bits = np.random.binomial(n=1, p=0.5, size=(bits_per_carrier))

# reshaping an array of bytes to send a QAM symbol on 
# each subcarrier
sp = bits.reshape((data_carriers_len, modulation.mu))
mapped = np.array([modulation.qam_table[tuple(b)] for b in sp])

symbol = np.zeros(n_subc, dtype=complex)
symbol[pilot_carriers] = pilot_value
symbol[data_carriers] = mapped

symbol_time = np.fft.ifft(symbol)
cp_sym = symbol_time[-cp:]
symbol_cp = np.hstack([cp_sym, symbol_time])

# Upconversion taken from 36.211 15.2.0 6.13 (p. 180) (figure 6.13-1)
real_symbol = [np.real(symbol_cp[idx]) * math.cos(2 * math.pi * carrier_freq * idx * t_samp) -
               np.imag(symbol_cp[idx]) * math.sin(2 * math.pi * carrier_freq * idx * t_samp)
               for idx in range(len(symbol_cp))]
```

ะ ะผะพะดัะปััะธะธ ะฟะพะณะพะฒะพัะธะผ ัััั ะฟะพะทะถะต, ัะพัั ะฒ ะบะพะดะต ะพะฝะฐ ััั ัะถะต ะตััั.

##### 1.1.2.2. Single Carrier Frequency Division Multiple Access (SC-FDMA)

SC-FDMA ะธัะฟะพะปัะทัะตั ะฟะพัะพะถัั ััะตะผั ะณะตะฝะตัะฐัะธะธ ัะธะณะฝะฐะปะฐ ะบะฐะบ ะธ ะฒ OFDM, ะพะดะฝะฐะบะพ ะฒ
ะฟัะพัะตะดััั ะดะพะฑะฐะฒะปัะตััั ะดะพะฟะพะปะฝะธัะตะปัะฝัะน ััะฐะฟ ะฒัะฟะพะปะฝะตะฝะธั DFT. ะขะฐะบะพะน ะฟัะพัะตัั ะฝะฐะทัะฒะฐะตััั DFT-S-OFDM (Discrete Fourier Transform Spread OFDM). ะะตัะฒัะผ ัะฐะณะพะผ ัะฒะปัะตััั ะผะพะดัะปััะธั, ะทะฐัะตะผ ะฝะฐะด ะผะฐััะธะฒะพะผ QAM ัะธะผะฒะพะปะพะฒ ะฒัะฟะพะปะฝัะตััั ะพะฟะตัะฐัะธั DFT, ัะฐัััะณะธะฒะฐั ะบะฐะถะดัะน ัะธะผะฒะพะป ะฟะพ ะฒัะตะผ Subcarrierโะฐะผ. ะขะฐะบะพะน ะฐะปะณะพัะธัะผ ะฒัะฟะพะปะฝัะตััั ะดะปั ะฒัะตั Uplink ะบะฐะฝะฐะปะพะฒ, ะทะฐ ะธัะบะปััะตะฝะธะตะผ PRACH (ะธ PUSCH ะฟัะธ ะธัะฟะพะปัะทะพะฒะฐะฝะธะธ sub-PRB ะผะตัะพะดะฐ ะฒัะดะตะปะตะฝะธั ัะตััััะพะฒ).

ะะฐะบ ะธ ะดะปั OFDMA, ะทะฝะฐัะตะฝะธั Ncp ัะฐะบะถะต ะทะฐะฒะธััั ะพั ัะธะฟะฐ CP:
```
โโโโโโโโโโโโโโโโโโโโโฆโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Configuration    โ             N_cp(k)                    โ
โโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฃ
โ Normal CP         โ 160 (k = 0)                            โ
โ                   โ 144 (k โ {1,โฆ,6})                      โ
โโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฃ
โ Extended CP       โ 512                                    โ
โโโโโโโโโโโโโโโโโโโโโฉโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

#### 1.1.3. Modulation

ะ ััะพะผ ัะฐะทะดะตะปะต ะฑัะดัั ัะฐััะผะพััะตะฝั ะผะตัะพะดั ะผะพะดัะปััะธะธ, ะบะพัะพััะต ะธัะฟะพะปัะทััััั ะฒ LTE.

ะะพะดัะปััะธั โ ััะพ ะณััะฑะพ ะณะพะฒะพัั ะฟัะพัะตัั ะฟัะตะพะฑัะฐะทะพะฒะฐะฝะธั ะฝะฐะฑะพัะพะฒ ััััั ะดะฐะฝะฝัั ะฒ ะดะฐะฝะฝัะต ะฝะฐ ะพัะฟัะฐะฒะบั ะฟะพ ัะฐะดะธะพ. ะะฐะฟัะธะผะตั, ะดะพะฟัััะธะผ ะผั ะธะผะตะตะผ ะฝะฐะฑะพั ะฑะธั $$ b = [0, 1, 1, 0, 0, 1, 1, 0] $$ โ ั.ะต ะพะดะธะฝ ะฑะฐะนั. ะะฐะบะธะผ ะพะฑัะฐะทะพะผ ะผั ะผะพะถะตะผ ะฟะตัะตะดะฐัั ััะพั ะฝะฐะฑะพั ะฑะธั?

 1. ะะพะถะฝะพ ะฝะฐะฟัะธะผะตั ะฝะฐะทะฝะฐัะธัั ะตะดะธะฝะธัะต ัะฐััะพัั F1, ะฐ ะฝัะปั ัะฐััะพัั F0. ะะฐะปะตะต ะพะฟัะตะดะตะปะธัั ัะฐะนะผะธะฝะณ ะพัะฟัะฐะฒะบะธ, ะฝะฐะฟัะธะผะตั ะบะฐะถะดัะน ัะธะผะฒะพะป ะฑัะดะตั ะพัะฟัะฐะฒะปััััั 1 ะผัะตะบ. ะ ะดะฐะปะตะต ะผั ะฑัะดะตะผ ะพัะฟัะฐะฒะปััั ััะพั ะฑะฐะนั ัะฐะบะธะผ ะพะฑัะฐะทะพะผ: ัะฝะฐัะฐะปะฐ ะฝะฐ ัะฐััะพัะต F0 ัะพะฒะฝะพ 1 ะผัะตะบ ะฑัะดะตั ัะธะณะฝะฐะป, ะฟะพัะพะผ ะฝะฐ ัะฐััะพัะต F1, ะฟะพัะพะผ ัะฝะพะฒะฐ ะฝะฐ F1, ะฟะพัะพะผ ะฝะฐ F0 ะธ ัะฐะบ ะดะฐะปะตะต. ะขะฐะบะธะผ ะพะฑัะฐะทะพะผ, ะผั ะพัะฟัะฐะฒะปัะตะผ ะพะดะธะฝ ะธ ัะพั ะถะต ัะธะณะฝะฐะป, ะฟัะพััะพ ะฝะฐ ัะฐะทะฝัั ัะฐััะพัะฐั ะธ ะฟะตัะตะดะฐัะผ ะดะฐะฝะฝัะต. ะขะฐะบะพะน ะผะตัะพะด ะฝะฐะทัะฒะฐะตััั FSK, Frequency-Shift Keying. ะั ัะฐััะผะพััะตะปะธ ะตะณะพ ัะฐะผัะน ะฟัะพััะพะน ะฒะฐัะธะฐะฝั: BFSK, Binary FSK, ะฟะพัะพะผั ััะพ ั ะฝะฐั ะตััั ะฒัะตะณะพ ะดะฒะต ัะฐััะพัั.
 ะั ะถะต ะผะพะถะตะผ ะฝะฐะทะฝะฐัะธัั ัะฒะพั ัะฐััะพัั ะบะฐะบะพะผั-ะฝะธะฑัะดั ะฝะฐะฑะพัั ะฑะธั, ะฝะฐะฟัะธะผะตั 00 โ F0, 01 โ F1, 10 โ F2, 11 โ F3. ะ ัะฐะบะพะผ ัะปััะฐะต ะผั ัะถะต ะฑัะดะตะผ ะพัะฟัะฐะฒะปััั ะดะฐะฝะฝัะต ะฑััััะตะต ะฒ ะดะฒะฐ ัะฐะทะฐ, ัะฐะบ ะบะฐะบ ะทะฐ ัะฐะท ะพัะฟัะฐะฒะปัะตะผ ะฝะต ะพะดะธะฝ ะฑะธั, ะฐ ะดะฒะฐ. ะขะฐะบะพะน ะผะตัะพะด ะฝะฐะทัะฒะฐะตััั 4-FSK.


ะะฐะบะธะต ะตัั ะฟะฐัะฐะผะตััั ัะธะณะฝะฐะปะฐ ะผั ะผะพะถะตะผ ะผะตะฝััั ััะพะฑั ะพัะฟัะฐะฒะปััั ะดะฐะฝะฝัะต? ะขัะฐัะธัั ัะฐะบ ะผะฝะพะณะพ ัะฐััะพัั ะฝะต ัะพัะตััั, ัะพัะตััั ะบะฐะบ-ัะพ ะฟะพ-ะดััะณะพะผั ะทะฐะบะพะดะธัะพะฒะฐัั ะฝะฐะฑะพั ะฑะธั.

 2. ะขะพะณะดะฐ ัะพัะพัะพ, ะดะฐะฒะฐะนัะต ะฟะพะฟัะพะฑัะตะผ ัะฟัะฐะฒะปััั ะฐะผะฟะปะธััะดะพะน. ะะพะฟัััะธะผ ะดะปั 0 ะฝะฐะทะฝะฐัะธะผ ัะฒะพั ะฐะผะฟะปะธััะดั A0, ะฐ ะดะปั ะตะดะธะฝะธัั โ A1. ะขะตะฟะตัั, ะผั ะฑัะดะตะผ ะฝะฐ ะพะดะฝะพะน ะธ ัะพะน ะถะต ัะฐััะพัะต ะฟัะพััะพ ะผะตะฝััั ะฐะผะฟะปะธััะดั ัะธะณะฝะฐะปะฐ ะบะพะณะดะฐ ัะพัะธะผ ะพัะฟัะฐะฒะธัั ะบะฐะบะธะต-ะฝะธะฑัะดั ะดะฐะฝะฝัะต. ะ ะตัั ะฒะตะดั ะผะพะถะฝะพ ะดะปั ะฝะฐะฑะพัะฐ ะฑะธั ะพะฑะพะทะฝะฐัะธัั ะฐะผะฟะปะธััะดั, ะฒะพะพะฑัะต ะฟะพะปััะฐะตััั ัะพะฟ ะผะตัะพะด. ะะพ ะฝะตั. ะ ัะธะปั ัะถะต ะฒัััะฟะฐัั ะฟัะฐะบัะธัะตัะบะธะต ะพะณัะฐะฝะธัะตะฝะธั. ะะฐะบ ะธ ะฒ ัะปััะฐะต ั AM (Amplitude Modulation), ะผะตัะพะด ASK (Amplitude Shift Keying), ะพัะตะฝั ัะธะปัะฝะพ ะฟะพะดะฒะตัะถะตะฝ ะฐัะผะพััะตัะฝะพะผั ััะผั, ัะฐะทะปะธัะฝัะผ ะธัะบะฐะถะตะฝะธัะผ ัะธะณะฝะฐะปะฐ, ะธ ัะฐะบ ะดะฐะปะตะต. ะขะฐะบะพะน ะผะตัะพะด ะดะพััะฐัะพัะฝะพ ัะพัะพั ะตัะปะธ ั ะฝะฐั ะฝะตั ััะพัะพะฝะฝะตะณะพ ััะผะฐ, ะฝะฐะฟัะธะผะตั ะบะฐะบ ะฒ ะะะขะะะะะะะะ, ะฝะพ ะผั ัะฐะฑะพัะฐะตะผ ั ัะฐะดะธะพ ะธ ะฟะพะทะฒะพะปะธัั ัะฐะบะพะต ะฝะต ะผะพะถะตะผ.


ะฅะพัะพัะพ, ัะพะณะดะฐ ะฟะพะฟัะพะฑัะตะผ ะตัั ััะพ-ะฝะธะฑัะดั

 3. ะะพัะตะผั ะฑั ะฝะต ะผะตะฝััั ัะฐะทั? ะัะปะธัะฝะฐั ะธะดะตั, ะดะฐะฒะฐะนัะต ะฑัะดะตะผ ะผะตะฝััั ัะผะตัะตะฝะธะต ัะธะณะฝะฐะปะฐ ะฒ ะทะฐะฒะธัะธะผะพััะธ ะพั ะฑะธัะฐ, ะบะพัะพัะพะณะพ ะผั ะพัะฟัะฐะฒะปัะตะผ. ะะพั ััั ัะพัะพัะพ ะธะทะพะฑัะฐะถะตะฝะพ ะบะฐะบ ััะพ ัะฐะฑะพัะฐะตั: (Phase Shift Keying) https://imgur.com/a/4FquDey. ะญัะพ ัะถะต ะดะตะนััะฒะธัะตะปัะฝะพ ัะพัะพัะธะน ะผะตัะพะด. ะะฐ ะฟัะฐะบัะธะบะต ะพะฝ ะดะพะฒะพะปัะฝะพ ััะฐะฑะธะปัะฝัะน ะธ ะดะฐะถะต ะธัะฟะพะปัะทัะตััั ะฒ RFID ะธ Bluetooth. ะะฐัะบะพะปัะบะพ ะฒั ะทะฝะฐะตัะต, ะพะดะฝะฐะบะพ, Bluetooth ะฝะต ะพัะตะฝั ะฑัััััะน... ะะฐ, ัะฐะบะพะน ะผะตัะพะด ะผะพะดัะปััะธะธ ะฑัะดะตั ัะพัะพัะพ ัะฐะฑะพัะฐัั ะตัะปะธ ะผั ะธัะฟะพะปัะทัะตะผ ะฒัะตะณะพ ะดะฒะฐ, ะฝั ะผะฐะบัะธะผัะผ 4 ะฑะธัะฐ ะดะปั ะพะดะฝะพะณะพ ัะธะผะฒะพะปะฐ, ะฟะพััะพะผั ัะบะพัะพััั ะฟะตัะตะดะฐัะธ ะฑัะดะตั ะฝะต ะพัะตะฝั ะฑะพะปััะพะน.


ะขะพะณะดะฐ... ะฟะพัะตะผั ะฑั ะฝะต ัะพะฒะผะตััะธัั ะบะฐะบะธะต ะฝะธะฑัะดั ะผะตัะพะดั ะธ ะฟะพะปััะธัั ะฑะพะปะตะต ัะพัะพัะธะน ะผะตัะพะด ะผะพะดัะปััะธะธ?

 4. QAM โ Quadrature Amplitude Modulation โ ัะพั ัะฐะผัะน ะผะตัะพะด, ะบะพัะพััะน ะธัะฟะพะปัะทัะตััั ะธ ะฒ LTE, ะธ ะฒ 5G NR ะธ ะตัั ะผะฝะพะณะพ ะณะดะต. ะะดะตั ะฒ ัะตะผ: ะฒะผะตััะพ ัะพะณะพ, ััะพะฑั ัะฐะฑะพัะฐัั ั ัะธะณะฝะฐะปะพะผ ะฝะฐะฟััะผัั, ะปัััะต ัะดะตะปะฐัั ะฝะตะบัั ะฐะฑัััะฐะบัะธั ั ะดะฒัะผั ะฟะฐัะฐะผะตััะฐะผะธ, ะบะพัะพััะต ะผั ะผะพะถะตะผ ะผะตะฝััั ััะพะฑั ัะพะทะดะฐะฒะฐัั ะฝะพะฒัะน ัะธะณะฝะฐะป, ะบะพัะพััะน ะฑัะดะตั ะธ ัะผะพะดัะปะธัะพะฒะฐะฝ ะธ ะดะพััะฐัะพัะฝะพ ัััะพะนัะธะฒ. ะขะฐะบะฐั ะฐะฑัััะฐะบัะธั ะฝะฐะทัะฒะฐะตััั I/Q: In-Phase and Quadrature Data. IQ ัะธะณะฝะฐะป ัะพะทะดะฐัััั ั ะฟะพะผะพััั ัะปะพะถะตะฝะธั ะดะฒัั ะพััะพะณะพะฝะฐะปัะฝัั ะฒะพะปะฝะพะฒัั ััะฝะบัะธะน: ัะฐะผัะต ะฟัะพัััะต โ ัะธะฝัั ะธ ะบะพัะธะฝัั. ะัะปะธ ะฒั ะฒะฝะธะผะฐัะตะปัะฝะพ ัะธัะฐะปะธ ัะฐะทะดะตะป ะฟัะพ OFDM, ัะพ ะผะพะถะตัะต ะฒัะฟะพะผะฝะธัั ััะฐะฟ Passband Generation. ะขะฐะผ ะบะฐะบ ัะฐะท ะฟัะพะธััะพะดะธั ะณะตะฝะตัะฐัะธั IQ ัะธะณะฝะฐะปะฐ, ั.ะต Upconversion: $$ Icos(2*pi*fc*t) - Qsin(2*pi*fc*t) $$.
ะงัะพ ััะพ ะดะฐัั? ะขะตะฟะตัั ะผั ัะฐะฑะพัะฐะตะผ ะฝะต ั ัะธะณะฝะฐะปะพะผ ะฝะฐะฟััะผัั, ัะพ ะตััั ะฝะต ั ัะฐััะพัะพะน, ัะผะตัะตะฝะธะตะผ ะธ ะฐะผะฟะปะธััะดะพะน, ะฐ ั ะดะฒัะผั ะฐะฑัััะฐะบัะฝัะผะธ ะฟะฐัะฐะผะตััะฐะผะธ I ะธ Q. ะะฐะทะปะธัะฝัะผ ะบะพะผะฑะธะฝะฐัะธัะผ ััะธั ะฟะฐัะฐะผะตััะพะฒ ะผะพะถะฝะพ ะฝะฐะทะฝะฐัะธัั ัะฒะพั ะทะฝะฐัะตะฝะธะต ะบะพะผะฑะธะฝะฐัะธะธ ะฑะธัะพะฒ. ะ LTE ัะฐะบ ะธ ะฟัะพััะพะดะธั. ะะฑัะฐัะธะผัั ะบ ัะฟะตัะธัะธะบะฐัะธะธ 3GPP TS 36.211 15.2.0, ัะฐะฑะปะธัะฐ 7.1.3-1: 16 QAM modulation mapping:

```
โโโโโโโโโโฆโโโโโโโโโโโโโโโโโฆโโโโโโโโโโโโโโโโโ
โ Bits   โ       I        โ       Q        โ
โโโโโโโโโโฌโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโฃ
โ 0000   โ   +1/โ10       โ   +1/โ10       โ
โ 0001   โ   +1/โ10       โ   +3/โ10       โ
โ 0010   โ   +3/โ10       โ   +1/โ10       โ
โ 0011   โ   +3/โ10       โ   +3/โ10       โ
โ 0100   โ   +1/โ10       โ   โ1/โ10       โ
โ 0101   โ   +1/โ10       โ   โ3/โ10       โ
โ 0110   โ   +3/โ10       โ   โ1/โ10       โ
โ 0111   โ   +3/โ10       โ   โ3/โ10       โ
โ 1000   โ   โ1/โ10       โ   +1/โ10       โ
โ 1001   โ   โ1/โ10       โ   +3/โ10       โ
โ 1010   โ   โ3/โ10       โ   +1/โ10       โ
โ 1011   โ   โ3/โ10       โ   +3/โ10       โ
โ 1100   โ   โ1/โ10       โ   โ1/โ10       โ
โ 1101   โ   โ1/โ10       โ   โ3/โ10       โ
โ 1110   โ   โ3/โ10       โ   โ1/โ10       โ
โ 1111   โ   โ3/โ10       โ   โ3/โ10       โ
โโโโโโโโโโฉโโโโโโโโโโโโโโโโโฉโโโโโโโโโโโโโโโโโ
```

 ะขะฐะบะพะน ะผะตัะพะด ะผะพะดัะปััะธะธ ัะถะต ะฟะพะทะฒะพะปัะตั ะพัะฟัะฐะฒะปััั ะฐะถ 4 ะฑะธัะฐ ะทะฐ ัะฐะท. ะะพะถะฝะพ ะฒะตะดั ะทะดะตัั ะฝะต ะพััะฐะฝะฐะฒะปะธะฒะฐัััั ะธ ะพัะฟัะฐะฒะปััั ะฑะพะปััะต. LTE ะฟะพะดะดะตัะถะธะฒะฐะตั 1024QAM, ะฒ ะบะพัะพัะพะผ ะผะพะถะฝะพ ะพัะฟัะฐะฒะธัั ัะตะปัั 10 ะฑะธั ะทะฐ ัะฐะท (ัะฐะทะดะตะป 7.1.6).

ะะพะผั ะฟัะพัะต ัะผะพััะตัั ะฝะฐ ะบะพะด:
```python
import math
import matplotlib.pyplot as plt
import numpy as np

mu = 4

# taken from 36.211, table 7.1.3-1 (16 QAM modulation mapping)
# https://www.etsi.org/deliver/etsi_ts/136200_136299/136211/15.02.00_60/ts_136211v150200p.pdf
qam_table = {
    (0, 0, 0, 0): complex(1/math.sqrt(10), 1/math.sqrt(10)),
    (0, 0, 0, 1): complex(1/math.sqrt(10), 3/math.sqrt(10)),
    (0, 0, 1, 0): complex(3/math.sqrt(10), 1/math.sqrt(10)),
    (0, 0, 1, 1): complex(3/math.sqrt(10), 3/math.sqrt(10))
}

# from the same table, when the first bit is 1, the real 
# part of the complex number is negated
# when the second bit is 1, the imaginary part is negated
# here, we just generate the table
for i in range(4, 16):
    bits = tuple([int(n) for n in list(np.binary_repr(i).rjust(4, "0"))])
    iq_mapped = qam_table[(0, 0, bits[2], bits[3])]
    i = iq_mapped.real
    q = iq_mapped.imag

    if bits[0] == 1:
        i = -i
    if bits[1] == 1:
        q = -q
    
    qam_table[bits] = complex(i, q)
```

ะญัะพั ะบะพะด ัะณะตะฝะตัะธััะตั ัะฐัะฟัะตะดะตะปะตะฝะธะต ะฟะฐัะฐะผะตััะพะฒ IQ. ะะธะทัะฐะปัะฝะพ ััะฐะฝะตั ััะฝะพ ะฟะพัะตะผั ะฑัะปะธ ะฒัะฑัะฐะฝั ะธะผะตะฝะฝะพ ัะฐะบะธะต ะทะฝะฐัะตะฝะธั, ั ะฒะธะดั ัะฐะฝะดะพะผะฝัะต: (16QAM Modulation) https://imgur.com/a/4FquDey. ะะฐ, ะพะฝะธ ัะฐัะฟะพะปะพะถะตะฝั ะฒ ัะฐะบะพะผ ะฟััะผะพัะณะพะปัะฝะพะผ ะฟะฐััะตัะฝะต. ะญัะพ ัะฟัะฐะฒะตะดะปะธะฒะพ ะดะปั ะบะฐะถะดะพะณะพ ะธะท ะฒะธะดะพะฒ QAM (16, 256, 1024 QAM).

ะขัั ะผะพะถะฝะพ ะทะฐะดะฐัั ะฒะพะฟัะพั: โะฐ ะฟะพัะตะผั ัะพัะบะธ ัะฐัะฟะพะปะพะณะฐัััั ะธะผะตะฝะฝะพ ะฒ ัะฐะบะพะผ ะบะฒะฐะดัะฐัะฝะพะผ ะฒะธะดะต? ะฝะต ะปัััะต ะฑัะปะพ ะฑั ะฟะพะดะพะฑัะฐัั ัะฐะบัั ัะธะณััั, ะฟัะธ ะบะพัะพัะพะผ ัะฐัััะพัะฝะธะต ะฑัะปะพ ะฑั ะผะฐะบัะธะผะฐะปัะฝัะผ, ัะพะพัะฒะตััะฒะตะฝะฝะพ ัะฒะตะปะธัะธะฒะฐะปะฐัั ะฑั ััะฐะฑะธะปัะฝะพััั ะฟะตัะตะดะฐัะธ?โ. ะญัะพ ัะฟัะฐะฒะตะดะปะธะฒัะน ะฒะพะฟัะพั. ะ ะดะฐ, ะดััะณะธะต ะฟะฐััะตัะฝั ัะพะถะต ะตััั, ะฝะฐะฟัะธะผะตั Cross-QAM. Cross-QAM ะผะพะถะตั ะฟะพะผะพัั ะดะพััะธัั ะฑะพะปััะตะน ัััะตะบัะธะฒะฝะพััะธ, ะฝะพ ะธัะฟะพะปัะทัะตััั ัะตะดะบะพ ะธะท-ะทะฐ ัะปะพะถะฝะพััะตะน ะฒ ัะตะฐะปะธะทะฐัะธะธ ะพะฑะพััะดะพะฒะฐะฝะธั ะดะปั ะดะตะผะพะดัะปััะธะธ ัะฐะบะพะณะพ ัะธะณะฝะฐะปะฐ.

#### 1.1.4. MIMO

ะั ัะฐะทะพะฑัะฐะปะธัั ะตัั ั ะพะดะฝะธะผ ะฟะพะฝััะธะตะผ ะธะท ัะธะทะธัะตัะบะพะณะพ ััะพะฒะฝั LTE, ัะตะฟะตัั ะฟะตัะตะนะดัะผ ะบ ัะปะตะดัััะตะผั: MIMO, Mulitple In, Multiple Out.

ะัะตะฝั ะณััะฑะพ ะณะพะฒะพัั ะธ ัะธะปัะฝะพ ัะฟัะพัะฐั, MIMO โ ัะตัะฝะธะบะฐ, ะบะพัะพัะฐั ะฟะพะทะฒะพะปัะตั ะพัะฟัะฐะฒะธัั ะฑะพะปััะต ะดะฐะฝะฝัั ะฑะตะท ะธัะฟะพะปัะทะพะฒะฐะฝะธะต ะดะพะฟะพะปะฝะธัะตะปัะฝัั ัะฐะดะธะพ ัะตััััะพะฒ. ะข.ะต ะดะปั ะพัะฟัะฐะฒะบะธ ะฑะพะปััะตะณะพ ะบะพะปะธัะตััะฒะฐ ะดะฐะฝะฝัั ะฝะฐะผ ะฝะต ะฟะพะฝะฐะดะพะฑะธััั ะฒัะดะตะปััั ะตัั ัะฐััะพัั ะธะปะธ ััะฐัะธัั ะฑะพะปััะต ะฒัะตะผะตะฝะธ. ะัะถะฝะพ ัะพะปัะบะพ ะฑะพะปััะต ะฐะฝัะตะฝะฝ.

ะกััะตััะฒัะตั ะดะฒะฐ ะฟะพะดัะพะดะฐ ะบ ัะตะฐะปะธะทะฐัะธะธ MIMO: SU-MIMO (Single User MIMO) ะธ MU-MIMO (Multi-User MIMO). SU-MIMO ัะพะบััะธััะตััั ะฝะฐ ะพะฑัะปัะถะธะฒะฐะฝะธะธ ะพะดะฝะพะณะพ ะฟะพะปัะทะพะฒะฐัะตะปั,
ัะพะณะดะฐ ะบะฐะบ MU-MIMO ะพะฑัะปัะถะธะฒะฐะตั ััะฐะทั ะฝะตัะบะพะปัะบะพ ะฟะพะปัะทะพะฒะฐัะตะปะตะน, ะฟะพะดัััะฐะธะฒะฐััั ะฟะพะด ะธะทะผะตะฝัััะธะตัั ััะปะพะฒะธั ะฒัะดะตะปะตะฝะฝัั ัะตััััะพะฒ.

ะฏ ัะดะตะปะฐะป ะพัะตะฝั ัะฟัะพััะฝะฝัั ะธะปะปััััะฐัะธั ัะฐะฑะพัั MIMO: (MIMO Model) https://imgur.com/a/4FquDey.

ะะท ะฝะตั ะฒะธะดะฝะพ:
 1. ะะฐ ะฟะตัะตะดะฐััะธะบะต ะตััั ะดะฒะต ะฐะฝัะตะฝะฝั, ะบะพัะพััะต ะฟะตัะตะดะฐัั ะดะฒะฐ ัะฐะทะฝัั ะฟะพัะพะบะฐ, x1 ะธ x2.
 2. ะกะธะณะฝะฐะป ั ะบะฐะถะดะพะน ะธะท ะฟะตัะตะดะฐััะธั ะฐะฝัะตะฝะฝ ะฟัะธะฝะธะผะฐะตััั ะฝะฐ ะบะฐะถะดะพะน ะฐะฝัะตะฝะฝะต ะฟัะธะฝะธะผะฐััะตะน ััะพัะพะฝั. ะะฐะฟัะธะผะตั, ัะธะณะฝะฐะป ั ะฟะตัะฒะพะน ะฐะฝัะตะฝะฝั ะฟะตัะตะดะฐััะธะบะฐ ะฟัะธะฝะธะผะฐะตััั ะฝะฐ ะฟะตัะฒะพะน ะธ ะฝะฐ ะฒัะพัะพะน ะฐะฝัะตะฝะฝะต ะฟัะธัะผะฝะธะบะฐ.
 3. ะัะธะฝะธะผะฐััะฐั ััะพัะพะฝะฐ ะดะตะบะพะดะธััะตั ะดะฒะฐ ะฟะพัะพะบะฐ ะธ ะฟะพะปััะฐะตั ะดะฐะฝะฝัะต ะฒ ะพัะธะณะธะฝะฐะปัะฝะพะผ ะฒะธะดะต.

h11, h12, h21 ะธ h22 โ ััะพ ะบะพัััะธัะธะตะฝัั, ะฟะพะบะฐะทัะฒะฐััะธะต ะบะฐะบะพะต ะบะพะปะธัะตััะฒะพ ะดะฐะฝะฝัั ะธะดัั ะฟะพ ะบะพะฝะบัะตัะฝะพะผั ะฟััะธ. ะงะตะผ ะฑะพะปััะต ัะธัะปะพ, ัะตะผ ะฑะพะปััะต ะดะฐะฝะฝัั ะฟัะพัะพะดะธั ะฟะพ ะฟััะธ. ะะท ััะธั ะบะพัััะธัะธะตะฝัะพะฒ ะผะพะถะฝะพ ัะดะตะปะฐัั ะผะฐััะธัั, ะพะฝะฐ ะฝะฐะทัะฒะฐะตััั Channel Information Matrix. ะกะพะพัะฒะตััะฒะตะฝะฝะพ ะผะฐัะตะผะฐัะธัะตัะบะธ ะผั ะผะพะถะตะผ ัะผะพะดะตะปะธัะพะฒะฐัั ะบะฐะฝะฐะป ัะฐะบ: $$ y = Hx $$: (MIMO Channel Information Matrix) https://imgur.com/a/ptgfM4Z

ะขะตะฟะตัั, ะบะฐะบ ะผั ะผะพะถะตะผ ะธะท ััะพะณะพ ะฒะพัััะฐะฝะพะฒะธัั ะพัะธะณะธะฝะฐะปัะฝัะน ัะธะณะฝะฐะป? ะขัั ะดัะผะฐั ะปะพะณะธัะฝะพ: $$ x = H^{-1} * y $$. ะัะถะฝะพ ะฒะทััั ะพะฑัะฐัะฝะพะต ะพั ะผะฐััะธัั ะบะฐะฝะฐะปะฐ ะธ ัะผะฝะพะถะธัั ะฝะฐ ะฟะพะปััะตะฝะฝัะน ัะธะณะฝะฐะป $$ y $$. ะะพ ั ัะฐะบะธะผ ะฟะพะดัะพะดะพะผ ะตััั ะฟัะพะฑะปะตะผั: ะฒะพ ะฟะตัะฒัั ะพะฝ ะฟะพะดัะฐะทัะผะตะฒะฐะตั, ััะพ ะฝะฐ ะฟัะธะฝะธะผะฐััะตะน ััะพัะพะฝะต ะฟะพะปะฝะพัััั ะธะทะฒะตััะฝะฐ ะผะฐััะธัะฐ ะบะฐะฝะฐะปะฐ, ะฐ ััะพ ัะฐัะต ะฒัะตะณะพ ะฝะต ัะฐะบ (ะพะฝะฐ ะธะทะผะตะฝัะตััั ัะฐััะพ ะธ ะตั ะฟะพะปััะตะฝะธะต - ะทะฐััะฐัะฝัะน ะฟัะพัะตัั). ะะฐะถะต ะตัะปะธ ะผะฐััะธัะฐ ะบะฐะฝะฐะปะฐ ะฑัะปะฐ ะฑั ะธะทะฒะตััะฝะฐ, ัะฐะบะพะน ะผะตัะพะด ัะฐะฑะพัะฐะป ะฑั ะฒัะต ัะฐะฒะฝะพ ะฟะปะพัะพ, ัะฐะบ ะบะฐะบ ะฝะฐ ะฟัะฐะบัะธะบะต ะพะฝ ะดะฐัั ะฟะปะพัะธะต ัะตะทัะปััะฐัั ะฟัะธ ะฝะฐะปะธัะธะธ ัะฐะฝะดะพะผะฝะพะณะพ ััะผะฐ, ะบะพัะพััะน ะฒ ะบะพะผะผัะฝะธะบะฐัะธะพะฝะฝัั ัะธััะตะผะฐั ะฒัะตะณะดะฐ ะตััั.

ะกััะตััะฒัะตั ะตัั ะฝะตัะบะพะปัะบะพ ะฒะฐัะธะฐะฝัะพะฒ ะบะฐะบ ะผะพะถะฝะพ ะฟะพะปััะธัั ะพัะธะณะธะฝะฐะปัะฝัะน ัะธะณะฝะฐะป:

 1. ZF - Zero Forcing - $$ x = ((H^H*H)^{-1} * H^H) * y $$ (ััั ะพะฟะตัะฐัะธั ^H - ะญัะผะธัะพะฒะพ ัะพะฟััะถะตะฝะธะต (Hermitian Transpose)). ะัะปะธ ะฒั ะฝะตะผะฝะพะณะพ ะทะฝะฐะบะพะผั ั ะปะธะฝะฐะปะณะพะผ, ัะพ ะผะพะณะปะธ ัะถะต ะทะฐะผะตัะธัั, ััะพ ะฝะฐ ัะฐะผะพะผ ะดะตะปะต ัะพัะผัะปะฐ - ััะพ Moore-Penrose pseudoinverse (ะฟัะตะฒะดะพะพะฑัะฐัะฝะฐั ะผะฐััะธัะฐ ะััะฐ-ะะตะฝัะพัะทะฐ). ะขะฐะบะพะน ะผะตัะพะด ะฟะพะทะฒะพะปัะตั ะปัััะต ะพะฑัะฐะฑะฐััะฒะฐัั ะฝะฐะปะธัะธะต ISI, ะพะดะฝะฐะบะพ ะฟัะธ ะฝะฐะปะธัะธะธ ััะผะฐ ะฟัะธ ะบะพะผะผัะฝะธะบะฐัะธะธ ะพะฝ ะผะพะถะตั ะตะณะพ ััะธะปะธะฒะฐัั, ัััะดัะฐั ะบะฐัะตััะฒะพ ะบะฐะฝะฐะปะฐ. ะ ะดะฐ, ััะพั ะผะตัะพะด ัะฐะบะถะต ะฟัะตะดะฟะพะปะฐะณะฐะตั, ััะพ ะฝะฐะผ ะฟะพะปะฝะพัััั ะธะทะฒะตััะฝะฐ ะผะฐััะธัะฐ ะบะฐะฝะฐะปะฐ.

ะ ะพะฑัะตะผ ััั ัะถะต ะดะพะปะถะฝะพ ะฑััั ััะฝะพ, ััะพ ััะพะธั ะธัะบะฐัั ะผะตัะพะด, ะบะพัะพััะน ะฑั ะบะฐะบ-ะฝะธะฑัะดั ะฝะต ะธัะฟะพะปัะทะพะฒะฐะป Channel Information Matrix ($$ H $$). ะ ัะฐะบะพะน ะผะตัะพะด ะตััั:

 2. SVD - Signle Value Decomposition - ะดะฐะฒะฐะนัะต ัะฝะฐัะฐะปะฐ ัะฐััะผะพััะธะผ ะพะฑััะฝัั ะฟัะพัะตะดััั SVD, ะฟะพัะพะผั ัะถะต ะฟะตัะตะนะดัะผ ะบ ัะพะผั, ะบะฐะบ ััะพ ัะตะฐะปะธะทะพะฒะฐะฝะพ ะฒ LTE. 
 ะ ะพะฑัะตะผ, ั ะฝะต ะฑัะดั ะฒะดะฐะฒะฐัััั ะฒ ะพะฑัััะฝะตะฝะธะต ัะฐะผะพะณะพ SVD ั ัะพัะบะธ ะทัะตะฝะธั ะผะฐัะตะผะฐัะธะบะธ, ะบะฐะบ ะฝะธะฑัะดั ะฟะพัะพะผ ัะถะต ะพัะดะตะปัะฝะพ ะพะฑ ััะพะผ ะฝะฐะฟะธัั, ัะฐะผ ะพัะตะฝั ะธะฝัะตัะตัะฝะพ. ะกะตะนัะฐั ััะพ ะฒะฐะถะฝะพ ะฟะพะฝััั: SVD ัะฐะทะฑะธะฒะฐะตั ะผะฐััะธัั "H" ะฝะฐ ััะธ ะผะฐััะธัั: $$ U $$, $$ S $$ ะธ $$ V^H $$. ะะดะตั ะฒ ัะพะผ, ััะพะฑั ะฟัะตะดััะฐะฒะธัั ะผะฐััะธัั ะบะฐะฝะฐะปะฐ ะฒ ะฒะธะดะต ะบะฐะบะพะน-ะฝะธะฑัะดั ะฟัะพััะพะน ะดะธะฐะณะพะฝะฐะปัะฝะพะน ะผะฐััะธัั, ะฒ ะบะพัะพัะพะน ะฟะพะปััะธัั ะบะพััะธัะธะตะฝัั ะฑัะดะตั ะปะตะณะบะพ. ะะฟััั ะถะต, ะดะฐะฒะฐะนัะต ะฒะทะณะปัะฝะตะผ ะฝะฐ ะผะฐััะธัั ะบะฐะฝะฐะปะฐ: $$ H = U*S*V^H $$. ะะผะตะฝะฝะพ $$ S $$ ะธ ัะฒะปัะตััั ัะฐะบะพะน ะผะฐััะธัะตะน, ะฝะพ ะบะฐะบ ัะฑัะฐัั ะพััะฐะปัะฝัะต ะผะฝะพะถะธัะตะปะธ? ะขัั ะผั ะผะพะถะตะผ ัะดะตะปะฐัั ัะฐะบัั ััะตะผั: (MIMO SVD Procedure) https://imgur.com/a/ptgfM4Z. ะัะฟัะฐะฒะธัะตะปั ะธะผะตะตั ัะฒะพั ะผะฐััะธัั, Precoding Matrix. ะะฝะฐ ะฟะพะปััะฐะตััั ะฟััะตะผ ะฟัะธะผะตะฝะตะฝะธั Hermitian Transpose ะบ ะฟะพะปััะตะฝะฝะพะน ั ะฟะพะผะพััั SVD ะผะฐััะธัะต $$ V^H $$. ะฃ ะฟัะธะฝะธะผะฐััะตะน ััะพัะพะฝั ัะพะถะต ะตััั ัะฒะพั ะผะฐััะธัะฐ, Receiver Matrix, ะพะฝะฐ ัะพะถะต ะฟะพะปััะฐะตััั ะธะท SVD. ะ ะธัะพะณะต ะฟะพัะปะต ะฟัะธะผะตะฝะตะฝะธั ะพะฑะพะธั ะผะฐััะธั, ะบะฐะฝะฐะปัะฝะพะน ะผะฐััะธัะตะน ััะฐะฝะพะฒะธััั $$ S $$, ะบะพัะพัะฐั ะฟะพ ัะฒะพะนััะฒั SVD ัะฒะปัะตััั ะดะธะฐะณะพะฝะฐะปัะฝะพะน. ะขะฐะบะธะผ ะพะฑัะฐะทะพะผ ะผั ะฟะพะปััะฐะตะผ ัะพะฒะฝะพ ะดะฒะฐ ะบะพััะธัะธะตะฝัะฐ, ั.ะต ัะพะปัะบะพ ะดะฒะฐ ะฟะพัะพะบะฐ. ะะพะปััะธัั ะธ ัะดะฐะปะธัั ััะธ ะบะพััะธัะธะตะฝัั ะพัะตะฝั ะปะตะณะบะพ, ะดะปั ััะพะณะพ ัััะตััะฒััั LTE Signals. ะะฑัะฐั ััะตะผะฐ ะฟัะธะผะตะฝะตะฝะธั ะผะฐััะธั ะฟะตัะตะด ะฒะฐะผะธ.

```
         โโโโโโโ    ฯ1    โโโโโโโโ        
   xโ    โ     โโโโโโโโโโโบโ      โ   yโ   
โโโโโโโโโบโ     โ          โ      โโโโโโโโโบ
         โ  V  โ          โ  Uแดด  โ        
   xโ    โ     โ          โ      โ   yโ   
โโโโโโโโโบโ     โ    ฯ2    โ      โโโโโโโโโบ
         โ     โโโโโโโโโโโบโ      โ        
         โโโโโโโ          โโโโโโโโ        
```

ะะฟััั ะถะต, ะบะพะผั ะฟัะพัะต ัะผะพััะตัั ะฝะฐ ะบะพะด:
```python
import numpy as np

n_stream = 4
tx_ant = 4
rx_ant = 2

s = (np.random.rand(n_stream) + 1j * np.random.rand(n_stream)).reshape(n_stream, 1)
H = (np.random.randn(rx_ant, tx_ant) + 1j*np.random.randn(rx_ant, tx_ant)) / np.sqrt(2)

print(s)

U, Sigma, Vh = np.linalg.svd(H)
V = np.matrix(Vh).H
Uh = np.matrix(U).H

Sigma_diag = np.diag(Sigma)

x = V @ s 
y = Uh @ (H @ x)
recovered = np.linalg.inv(Sigma_diag) @ y

print(recovered)
```

ะขัั s - ััะพ ัะธะณะฝะฐะป ะฝะฐ ะพัะฟัะฐะฒะบั (ะผะฐััะธัะฐ ััะฐะทั ั 4 ะฟะพัะพะบะฐะผะธ), ะฐ recovered - ัะธะณะฝะฐะป ะฟะพะปััะตะฝะฝัะน ะฟะพัะปะต ะฟะตัะตะดะฐัะธ ะธัะฟะพะปัะทัั MIMO. ะญัะธ ะดะฒะต ะฟะตัะตะผะตะฝะฝัะต ะฟะพะปะฝะพัััั ัะพะฒะฟะฐะดะฐัั.

ะขัั ะผะพะถะฝะพ ัะฟัะพัะธัั: "ัะฐะบ ะฝะฐะผ ะถะต ะฒัั ัะฐะฒะฝะพ ะฝะฐะดะพ ะทะฝะฐัั ะบะฐะฝะฐะปัะฝัั ะผะฐััะธัั ััะพะฑั ะฟะพะปััะธัั $$ V $$ ะธ $$ U^H $$, ัะฐะทะฒะต ะฝะตั?". ะะฐ, ััะพ ัะฐะบ. ะะพ ะณะปะฐะฒะฝัะน ะฟะปัั ะผะตัะพะดะฐ ั Precoding ะผะฐััะธัะตะน ะทะฐะบะปััะฐะตััั ะฒ ัะพะผ, ััะพ ะผั ะผะพะถะตะผ ะทะฐัะฐะฝะตะต ะฟัะพััะธัะฐัั ะพะฑะต ะผะฐััะธัั ะธ ะฟะพัะพะผ ะฟัะพััะพ ะฒัะฑะธัะฐัั ะธั ะฟัะธ ัะพะพัะฒะตััะฒัััะธั ััะปะพะฒะธัั ะบะฐะฝะฐะปะฐ. ะะผะตะฝะฝะพ ัะฐะบ ะฒ LTE ะธ ะฒ 5g NR ัะดะตะปะฐะปะธ. ะขะฐะบะธะต ัะฐะฑะปะธัั ะผะฐััะธั ะฝะฐะทัะฒะฐัััั Codebook. ะะฝะธ ัะฒะปััััั ะพัะฝะพะฒะฝัะผ ะฟัะตะธะผััะตััะฒะพะผ 5g NR ะฝะฐะด LTE, ัะฐะบ ะบะฐะบ ะธะผะตะฝะฝะพ ััั ัะฐััั ะฒ 5g NR ะธ ะฟะตัะตะดะตะปัะฒะฐะปะธ (ะธ ะดะฐ, ััะพ ัะฐะบะถะต ะธ ะพัะฝะพะฒะฝะพะต ัะฐะทะปะธัะธะต ะผะตะถะดั 5g NR ะธ LTE).

##### 1.1.4.1. Precoding

ะ ััะพะผ ัะฐะทะดะตะปะต ัะฐััะผะพััะธะผ ัะฐะฑะปะธัั ะผะฐััะธั ะบะพัะพััะต ะธัะฟะพะปัะทััััั ะดะปั ะพัััะตััะฒะปะตะฝะธั ััะฐะฟะฐ Precoding ะฒ MIMO.

ะะฑัะฐัะธะผัั ะบ ะดะพะบัะผะตะฝัะฐัะธะธ: 

(3GPP TS 36.213 15.2.0, ัะฐะฑะปะธัะฐ 7.1-5, PDCCH and PDSCH configured by C-RNTI)
```
โโโโโโโโโโโโฆโโโโโโโโโโโโโโโฆโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Mode     โ DCI Format   โPDSCH Transmission                             โ
โโโโโโโโโโโโฌโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฃ
โ Mode 1   โ 1A, 1, 7-1A  โSingle-antenna port, port 0 (see 7.1.1)        โ
โโโโโโโโโโโโฌโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฃ
โ Mode 2   โ 1A, 1, 7-1A  โTransmit diversity (see 7.1.2)                 โ
โโโโโโโโโโโโฌโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฃ
โ Mode 3   โ 1A, 2A, 7-1B โTransmit diversity (7.1.2) or                  โ
โ          โ              โLarge delay CDD (7.1.3)                        โ
โโโโโโโโโโโโฌโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฃ
โ Mode 4   โ 1A, 2, 7-1C  โTransmit diversity (7.1.2) or                  โ
โ          โ              โClosed-loop spatial multiplexing (7.1.4)       โ
โโโโโโโโโโโโฌโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฃ
โ Mode 5   โ 1A           โTransmit diversity (7.1.2)                     โ
โ          โโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฃ
โ          โ 1D           โMulti-user MIMO (7.1.5)                        โ
โโโโโโโโโโโโฌโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฃ
โ Mode 6   โ 1B, 1A       โCL spatial multiplexing (7.1.4),               โ
โ          โ              โsingle layer, or Transmit Diversity            โ
โ          โโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฃ
โ          โ 7-1D         โCL spatial multiplexing (7.1.4) or             โ
โ          โ              โTransmit diversity (7.1.2)                     โ
โโโโโโโโโโโโฌโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฃ
โ Mode 7   โ 1A, 1        โPort 0 (if 1 PBCH port), else                  โ
โ          โ              โTransmit diversity (7.1.2); Port 5 (see 7.1.1) โ
โโโโโโโโโโโโฌโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฃ
โ Mode 8   โ 2B, 7-1E, 1A โDual-layer (7,8), single port 7/8,             โ
โ          โ              โor Transmit diversity (7.1.2); MBSFN: port 7   โ
โโโโโโโโโโโโฌโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฃ
โ Mode 9   โ 2C, 1A       โDual-layer (7โ8), up to 8-layer (7โ14)         โ
โ          โ              โor port 7,8,11,13 (7.1.1)                      โ
โโโโโโโโโโโโฉโโโโโโโโโโโโโโโฉโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

ะขัั ัะฟะพะผะธะฝะฐะตััั RNTI ะธ DCI, ะฟัะธ ะฝะธั ะฟะพะณะพะฒะพัะธะผ ะฟะพะทะถะต. ะัะพััะพ ะฟะพะบะฐ ัะบะฐะถั: ั ะฟะพะผะพััั DCI ะฟัะพะธะทะฒะพะดะธััั ะฒัะดะตะปะตะฝะธะต ัะตััััะพะฒ, ะฒ ะฝะตะผ ะพัะฟัะฐะฒะปัะตััั ะธะฝัะพัะผะฐัะธั ะพ ะผะตัะพะดะต ะฟะตัะตะดะฐัะธ ะดะฐะฝะฝัั, Transmission Mode, ะธ ั.ะด. ะ RNTI - ััะพ ััะปะพะฒะฝะพ id ััััะพะนััะฒะฐ. ะั ะตััั ะฝะตัะบะพะปัะบะพ ัะธะฟะพะฒ ะธ ะบะฐะถะดัะน ัะฐะฑะพัะฐะตั ะฟะพ-ัะฒะพะตะผั, ะฝะพ ะฒ ััะพ ะผั ัะณะปัะฑะธะผัั ะฟะพะทะถะต, ะบะพะณะดะฐ ัะถะต ะฑัะดะตะผ ะฟัะพัะพะดะธัั MAC.

ะขะฐะบ ะฒะพั. ะญัะฐ ัะฐะฑะปะธัะฐ ัะบะฐะทัะฒะฐะตั ะบะฐะบะธะต ะผะตัะพะดั Precoding ะดะพะปะถะฝั ะธัะฟะพะปัะทะพะฒะฐัััั ะฒ ะทะฐะฒะธัะธะผะพััะธ ะพั ัะตะบััะตะณะพ Transmission Mode, TM. TM ั ัะถะต ัะฟะพะผะธะฝะฐะป ะฒะพ ะฒะฒะตะดะตะฝะธะธ.

 1. ะะฐััะผะพััะธะผ Precoding ะดะปั Transmit Diversity (TM2, TM3, TM5, TM6, TM7, TM8). ะกะฝะฐัะฐะปะฐ ัะฐััะผะพััะธะผ ะพะฑััั ะฟัะพัะตะดััั:

```
                  โโโโโโโโโโโโโport 0 โโโโโโโโโโโ
โโโโโโโโโโโ       โ           โโโโโโโโบโRE Mapperโ
โ         โx00,x0iโ           โy00,y0iโ         โ
โ  Layer  โโโโโโโโบโ Precoding โ       โโโโโโโโโโโ
โ  Mapper โ       โ           โport 1 โโโโโโโโโโโ
โ         โ       โ           โโโโโโโโบโRE Mapperโ
โโโโโโโโโโโ       โ           โy10,y1iโ         โ
                  โโโโโโโโโโโโโ       โโโโโโโโโโโ
```
 ะะท ะดะพะบัะผะตะฝัะฐัะธะธ 7.1.2: ะณะตะฝะตัะฐัะธั ัะธะณะฝะฐะปะฐ ะพัััะตััะฒะปัะตััั ะฒ ัะพะพัะฒะตััะฒะธะธ ั 36.211 6.3.4.3. ะ ัะปััะฐะต ั ะดะฒัะผั ะฐะฝัะตะฝะฝะฐะผะธ ัะฐัะฟัะตะดะตะปะตะฝะธะต ะฒัะพะดะฝัั ัะธะผะฒะพะปะพะฒ ะฑัะดะตั ะฟัะพะธะทะฒะพะดะธัััั ัะปะตะดัััะธะผ ะพะฑัะฐะทะพะผ:

$$
\begin{vmatrix}
 y^{(0)}(2i) \\
 y^{(1)}(2i) \\
 y^{(0)}(2i + 1) \\
 y^{(1)}(2i + 1) \\
\end{vmatrix} = \frac{1}{\sqrt{2}} \begin{vmatrix}
 1 & 0 & j & 0 \\
 0 & -1 & 0 & j \\
 0 & 1 & 0 & j \\
 1 & 0 & -j & 0
\end{vmatrix} \begin{vmatrix}
 \text{Re}(x^{(0)}(i)) \\
 \text{Re}(x^{(1)}(i)) \\
 \text{Im}(x^{(0)}(i)) \\
 \text{Im}(x^{(1)}(i)) \\
\end{vmatrix} 
$$

 ะะปะธ ะฒ ะบะพะดะต:

```python
import numpy as np

M_layer_symb = 8
x = (np.random.rand(M_layer_symb*2) + 1j * np.random.rand(M_layer_symb*2)).reshape(2, M_layer_symb)
precoding = (1 / np.sqrt(2)) * np.array([
    [1,  0,  1j,   0],
    [0, -1,  0,   1j],
    [0,  1,  0,   1j],
    [1,  0,  -1j,  0]
])
y = np.zeros((2, 2 * M_layer_symb), dtype=complex)

for i in range(M_layer_symb):
    precoded = precoding @ np.array([
        x[0][i].real,
        x[1][i].real,
        x[0][i].imag,
        x[1][i].imag
    ])
    y[0, 2*i]     = precoded[0]
    y[1, 2*i]     = precoded[1]
    y[0, 2*i + 1] = precoded[2]
    y[1, 2*i + 1] = precoded[3]

print(y)
```

 ะัะปะธ ะฝะฐัะธัะพะฒะฐัั Constellation ะดะธะฐะณัะฐะผะผั, ัะพ ัะฒะธะดะธะผ ัะปะตะดัััะตะต: (MIMO Precoding Transmit Diversity Constellation) https://imgur.com/a/ptgfM4Z. ะะธะดะฝะพ, ััะพ ัะธะผะฒะพะปั ัะฐัะฟัะตะดะตะปะธะปะธัั ัะฐะบะธะผ ะพะฑัะฐะทะพะผ, ััะพ ะฐะฝัะตะฝะฝะฐ 0 ะฒะตัะฐะตั ัะพะปัะบะพ ะฒ ะฟะตัะฒะพะน ัะตัะฒะตััะธ, ะฐ ะฐะฝัะตะฝะฝะฐ 1 ัะพะปัะบะพ ะฒะพ ะฒัะพัะพะน ะธ ัะตัะฒะตััะพะน. ะขะฐะบะถะต ะผะพะถะฝะพ ะทะฐะผะตัะธัั ะฝะตะบะพัะพััั ัะธะผะผะตััะธั ัะพัะตะบ. ะงะตะผ ะฑะปะธะถะต ะพะฝะธ ะฝะฐัะพะดัััั ะบ 0 ะบะพะพัะดะธะฝะฐั, ัะตะผ ะฑะพะปััะต ัะธะผะผะตััะธัะฝัั ัะพัะตะบ. ะญัะพ ะพะฑะตัะฟะตัะธะฒะฐะตั ะฑะะปัััั ะฒะตัะพััะฝะพััั ััะฟะตัะฝะพะณะพ ะดะตะบะพะดะธัะพะฒะฐะฝะธั ัะธะณะฝะฐะปะฐ, ัะฐะบ ะบะฐะบ ัะตะผ ะฑะปะธะถะต ะฝะฐัะพะดัััั ัะพัะบะธ, ัะตะผ ัะปะพะถะฝะตะต ะดะตะบะพะดะธัะพะฒะฐัั ัะธะผะฒะพะปั.

 2. Precoding with Large Delay CDD - ััะพะฑั ัะฐะทะพะฑัะฐัััั ั ััะธะผ ะผะตัะพะดะพะผ Precoding, ะฝะฐะดะพ ัะฝะฐัะฐะปะฐ ะฟะพะฝััั ััะพ ัะฐะบะพะต CDD. CDD - Cyclic Delay Diversity - ััะพ ัะฐะบะพะน ะฒะธะด ะฟะตัะตะดะฐัะธ ะดะฐะฝะฝัั, ะฟัะธ ะบะพัะพัะพะผ ะบ ะบะฐะถะพะผั OFDM Subcarrier'ั ะฟัะธะผะตะฝัะตััั Phase Delay, ัะพ ะตััั ัะผะตัะตะฝะธะต ะฟะพ ัะฐะทะต. ะญัะพ ะธัะฟะพะปัะทัะตััั ะดะปั ัะฒะตะปะธัะตะฝะธั ัะฐะทะฝะธัั ะฒ ัะฐัะฟัะพัััะพะฝะตะฝะธะธ ัะธะณะฝะฐะปะฐ ะผะตะถะดั ะดะฒัะผั ะฟัััะผะธ, ัะพ ะตััั ะดะปั ัะฟัะพัะตะฝะธั ะดะตะบะพะดะธัะพะฒะฐะฝะธั ัะธะณะฝะฐะปะฐ. ะััะฑะพ ะณะพะฒะพัั, ะฒ CDD ะพะดะฝะฐ ะฐะฝัะตะฝะฝะฐ ะฒะตัะฐะตั ะพัะธะณะธะฝะฐะปัะฝัะน ัะธะณะฝะฐะป, ะบะพะณะดะฐ ะบะฐะบ ะฒัะพัะฐั ะฒะตัะฐะตั ัะธะณะฝะฐะป ั ะฝะตะฑะพะปััะพะน ัะธะบะปะธัะตัะบะพะน ะทะฐะดะตัะถะบะพะน (ั.ะต ัะธะณะฝะฐะป ัะผะตัะฐะตััั ะฟะพ ัะฐะทะต ะธ ะบะพะฝะตั ัะธะผะฒะพะปะฐ ะบะพะฟะธััะตััั ะฒ ะฝะฐัะฐะปะพ ััะฐะทั ะฟะพัะปะต Cyclic Prefix). CDD ะฟัะธะผะตะฝัะตััั ัะพะปัะบะพ ะฒ TM3 ะธ ะดะปั ะฝะตะณะพ ัััะตััะฒัะตั ัะฒะพะน ะฒะธะด Precoding.
 ะะฟััั ะพะฑัะฐัะธะผัั ะบ ัะฟะตัะธัะธะบะฐัะธะธ. ะ ัะฐะทะดะตะปะต 7.1.3, 36.213, Large Delay CDD scheme ะพะฟะธัะฐะฝะพ, ััะพ Precoding ะดะพะปะถะตะฝ ะพัััะตััะฒะปััััั ะฒ ัะพะพัะฒะตััะฒะธะธ ั 36.211 6.3.4.2.2. ะะธะดะธะผ ะพะฑััั ัะพัะผัะปั Precoding'ะฐ: (MIMO Precoding Large CDD Schema) https://imgur.com/a/ptgfM4Z:

$$
\begin{vmatrix}
 y^{(0)}(i) \\
 \vdots \\
 y^{(P - 1)}(i) \\
\end{vmatrix} = W(i)D(i)U \begin{vmatrix}
 x^{(0)}(i) \\
 \vdots \\
 x^{(v - 1)}(i) \\
\end{vmatrix}
$$
 
 ะขัั: $$ W(i) $$ - ะผะฐััะธัะฐ ะธัะฟะพะปัะทัะตะผะฐั ะดะปั ัะฐัะฟัะตะดะตะปะตะฝะธั ัะธะณะฝะฐะปะฐ ะผะตะถะดั ะบะฐะถะดะพะน ัะธะทะธัะตัะบะพะน ะฐะฝัะตะฝะฝะพะน, $$ D(i) $$ - ะผะฐััะธัะฐ, ะธัะฟะพะปัะทัะตะผะฐั ะดะปั ะฟัะธะผะตะฝะตะฝะธั Phase Shift, $$ U $$ - ะผะฐััะธัะฐ, ัะฐัะฟัะตะดะตะปัััะฐั ะผะพัะฝะพััั ะผะตะถะดั ะบะฐะถะดะพะน ัะธะทะธัะตัะบะพะน ะฐะฝัะตะฝะฝะพะน.
 $$ D(i) $$ ะธ $$ U $$ ะพะฟะธัะฐะฝั ะฒ ัะฐะฑะปะธัะต 36.211 6.3.4.2.2-1: Large-delay cyclic delay diversity ะธ ะทะฐะฒะธััั ะพั ะบะพะปะธัะตััะฒะฐ ััะพะฒะฝะตะน (ั.ะต ะบะพะปะธัะตััะฒะฐ ะฟะพัะพะบะพะฒ ะฒ ัะตะทัะปััะฐัะต Layer Mapper): (MIMO Precoding Large CDD D(i) and U) https://imgur.com/a/ptgfM4Z.
 ะัะธ ััะพะผ $$ W(i) $$ ะฒัะฑะธัะฐะตััั ะธะท ะพะฑัะตะน ัะฐะฑะปะธัั 6.3.4.2.3-1, ะฟัะธ ััะพะผ ะฒ ัะปััะฐะต ั ะดะฒัะผั ะฐะฝัะตะฝะฝะฐะผะธ ะธัะฟะพะปัะทัะตััั ะผะฐััะธัะฐ ะฝะพะผะตั 0. ะะดะตัั ะฟะพะปะฝะฐั ะฟัะพัะตะดััะฐ, ะณะดะต ัะพะฑัะฐะฝะฐ ะฒัั ะธะฝัะพัะผะฐัะธั ะพ ะฒัะตั ะผะฐััะธัะฐั: (MIMO Precoding Large CDD Full Procedure) https://imgur.com/a/ptgfM4Z.

ะ ัะตะฟะตัั ะพะฟััั ะถะต, ัะตะฐะปะธะทะฐัะธั ะฒ ะบะพะดะต:

```python
import numpy as np
import matplotlib.pyplot as plt
from modulation import qam_table

U_matrices = {
    2: (1 / np.sqrt(2)) * np.array([
        [1,          1         ],
        [1, np.exp(-1j * np.pi)]
    ]),
    3: (1 / np.sqrt(3)) * np.array([
        [1, 1, 1],
        [1, np.exp(-1j * 2 * np.pi / 3), np.exp(-1j * 4 * np.pi / 3)],
        [1, np.exp(-1j * 4 * np.pi / 3), np.exp(-1j * 8 * np.pi / 3)],
    ]),
    4: (1 / 2) * np.array([
        [1, 1, 1, 1],
        [1, np.exp(-1j * 2 * np.pi / 4), np.exp(-1j * 4 * np.pi / 4), np.exp(-1j * 6 * np.pi / 4)],
        [1, np.exp(-1j * 4 * np.pi / 4), np.exp(-1j * 8 * np.pi / 4), np.exp(-1j * 12 * np.pi / 4)],
        [1, np.exp(-1j * 6 * np.pi / 4), np.exp(-1j * 12 * np.pi / 4), np.exp(-1j * 18 * np.pi / 4)],
    ])
}

D_matrices = {
    2: np.array([
        [1, 0],
        [0, np.exp(-1j * 2 * np.pi / 2)]
    ]),
    3: np.array([
        [1, 0, 0],
        [0, np.exp(-1j * 2 * np.pi / 3), 0],
        [0, 0, np.exp(-1j * 4 * np.pi / 3)],
    ]),
    4: np.array([
        [1, 0, 0, 0],
        [0, np.exp(-1j * 2 * np.pi / 4), 0, 0],
        [0, 0, np.exp(-1j * 4 * np.pi / 4), 0],
        [0, 0, 0, np.exp(-1j * 6 * np.pi / 4)],
    ])
}

codebook_1 = [
    {
        1: (1 / np.sqrt(2)) * np.array([[1], [1]]),
        2: (1 / np.sqrt(2)) * np.array([
            [1, 0],
            [0, 1]
        ])
    },
    {
        1: (1 / np.sqrt(2)) * np.array([[1], [-1]]),
        2: (1 / np.sqrt(2)) * np.array([
            [1, 1],
            [1, -1]
        ])
    },
    {
        1: (1 / np.sqrt(2)) * np.array([[1], [1j]]),
        2: (1 / np.sqrt(2)) * np.array([
            [1, 1],
            [1j, -1j]
        ])
    },
    {
        1: (1 / np.sqrt(2)) * np.array([[1], [-1j]]),
    }
]

M_layer_symb = 64
v = 2
P = 2

num_bits = v * M_layer_symb * 4  
bitstream = np.random.randint(0, 2, num_bits)
symbols = []
for i in range(0, len(bitstream), 4):
    bits = tuple(bitstream[i:i+4])
    symbols.append(qam_table[bits])

x = np.array(symbols).reshape(v, M_layer_symb)

W = codebook_1[0][v] 
D = D_matrices[v]
U = U_matrices[v]

y = W @ D @ U @ x

print(y)
```

 ะัะปะธ ะฝะฐัะธัะพะฒะฐัั ะณัะฐัะธะบ, ัะพ ะผะพะถะฝะพ ัะฒะธะดะตัั ัะปะตะดัััะตะต: (MIMO Precoding Large CDD Constellation) https://imgur.com/a/ptgfM4Z. ะะฐะถะดัะน ัะธะผะฒะพะป ัะฐัะฟัะตะดะตะปะธะปัั ะฟะพ ะดะฒัะผ ะฐะฝัะตะฝะฝะฐะผ. ะคะฐะทะพะฒัะน ัะณะพะป (phase difference) ะพะดะฝะพะณะพ ััะพะฒะฝั (ั Layer Mapper) ะผะตะถะดั ัะธะณะฝะฐะปะพะผ ะฝะฐ ะฐะฝัะตะฝะฝะฐั ัะฐะฒะตะฝ 180 ะธะปะธ 0 ะฒ ะทะฐะฒะธัะธะผะพััะธ ะพั i (ั.ะต ะฟะพะปะพะฒะธะฝะฐ ัะธะผะฒะพะปะพะฒ ะฑัะดะตั ะธะผะตัั ัะฐะทะฝะธัั 180 ะณัะฐะดััะพะฒ, ะดััะณะฐั ะฟะพะปะพะฒะธะฝะฐ - ะฒ 0).

 3. ะขะตะฟะตัั ัะฐะทะฑะตัะตะผัั ัะพ Spatial Multiplexing. ะะฐะทะพะฒะฐั ัะพัะผัะปะฐ ะฟัะพััะฐั ะธ ัะถะต ะฝะฐะผ ะทะฝะฐะบะพะผะฐั:

$$
\begin{vmatrix}
 y^{(0)}(i) \\
 \vdots \\
 y^{(P - 1)}(i) \\
\end{vmatrix} = W(i) \begin{vmatrix}
 x^{(0)}(i) \\
 \vdots \\
 x^{(v - 1)}(i) \\
\end{vmatrix}
$$

 ะัะธ ััะพะผ ะฒ ัะปััะฐะต ั ะดะฒัะผั ะฐะฝัะตะฝะฝะฐะผะธ ะธัะฟะพะปัะทัะตััั ัะฐ ะถะต ัะฐะฑะปะธัะฐ, ััะพ ะธ ะดะปั Large Delay CDD: 6.3.4.2.3-1. ะัะฑะพั ะธะฝะดะตะบัะฐ ะฒ ัะฐะฑะปะธัะต ะพัััะตััะฒะปัะตััั ะฝะฐ ะฑะฐะทะพะฒะพะน ััะฐะฝัะธะธ ะธ ะฟะตัะตะดะฐัััั ะฝะฐ UE ะฒ DCI format 2 ะฒ ะฟะพะปะต PrecodingInformation. 
 ะัั ะผะตะฝัะตััั ะฟัะธ ะธัะฟะพะปัะทะพะฒะฐะฝะธะธ 4 ะฐะฝัะตะฝะฝ. ะ ััะพะผ ัะปััะฐะต ะธัะฟะพะปัะทัะตััั ะดััะณะฐั ัะฐะฑะปะธัะฐ: 6.3.4.2.3-2. ะ ะฝะตะน ะฝะฐะฟััะผัั ะฝะต ัะบะฐะทะฐะฝั ะผะฐััะธัั ะดะปั ะธัะฟะพะปัะทะพะฒะฐะฝะธั, ะฝัะถะฝะพ ะฟัะพะนัะธ ัะตัะตะท ะฝะตัะบะพะปัะบะพ ััะฐะฟะพะฒ ะฟัะตะถะดะต ัะตะผ ะผะพะถะฝะพ ะฑัะดะตั ะธั ะฟะพะปััะธัั. ะะปั ะฝะฐัะฐะปะฐ ะฝัะถะฝะพ ะทะฝะฐัั ะบะฐะบ ะณะตะฝะตัะธััะตััั $$ W_n $$. ะญัะพ ะดะตะปะฐะตััั ะฟะพ ัะพัะผัะปะต, ะฟัะตะดััะฐะฒะปะตะฝะฝะพะน ะฒ 6.3.4.2.3. ะัะฑัะฐะฝะฝะพะต ะทะฝะฐัะตะฝะธะต u0 ะฟะพัะดะฐัะฒะปัะตััั ะฒ ัะพัะผัะปั $$ W_n $$ ะธ ะฒััะธัะปัะตััั $$ W_n $$. ะะฐัะตะผ ะฒ ะพะฟัะตะดะตะปัะฝะฝะพะผ ะฟะพััะดะบะต ะฒัะฑะธัะฐัััั ััะพะปะฑัั, ัะบะฐะทะฐะฝะฝัะต ะฒ ัะฐะฑะปะธัะต 6.3.4.2.3-2 ะธ ัะพะพัะฒะตััะฒะตะฝะฝะพ ะพะฟัะตะดะตะปัะตััั ัะฐะผะฐ ะผะฐััะธัะฐ W. ะฏ ัะดะตะปะฐะป ะฟะพะปะฝัั ะธะปะปััััะฐัะธั ะทะดะตัั: (MIMO Precoding 4 Antenna Case) https://imgur.com/a/ptgfM4Z. ะะฐ ะฝะตะน ัะบะฐะทะฐะฝั ะฒัะต ัะฐะณะธ ะณะตะฝะตัะฐัะธะธ 4ั ะผะฐััะธั ะดะปั codebook index 0.

---------------------------------------------------------------------------------
---------------------------------------------------------------------------------

#### 1.1.5. Physical Downlink Channels

(ะ ะฟัะพัะปัะน ัะฐะท ะผั ัะฐะทะพะฑัะฐะปะธัั ั ะฑะฐะทะพะฒัะผะธ ะบะพะฝัะตะฟัะธัะผะธ ะฒ ัะธะทะธัะตัะบะพะผ ััะพะฒะฝะต LTE. ะ ััะพะผ ะฟะพััะต ะผั ะฒะผะตััะต ัะฐะทะฑะตัะตะผ ัะถะต ะพัะพะฑะตะฝะฝะพััะธ ะบะฐะถะดะพะณะพ ัะธะทะธัะตัะบะพะณะพ ะบะฐะฝะฐะปะฐ ะฟะพ ะพัะดะตะปัะฝะพััะธ, ะฐ ัะฐะบะถะต ะพะฑัะตะดะตะฝะธะผ ะฒัะต ะธะทััะตะฝะฝัะต ะฟัะตะถะดะต ะบะพะฝัะตะฟัะธะธ ะฒะพะตะดะธะฝะพ.)

ะะดะตัั ัะตะนัะฐั ะฑัะดะตั ะผะฝะพะณะพ ะผะฐัะตะผะฐัะธะบะธ. ะะพ ะพัะพัะผะปะตะฝะธั ัะบะฐะถั: ะฑัะดั ะฒ ัะตะบััะต ะฟัะธะฒะพะดะธัั ัะพัะผัะปั ะฒ ะฒะธะดะต latex. ะ ะธะทะพะฑัะฐะถะตะฝะธัั ะพะฝะธ ะฑัะดัั ะฒ ััะตะฝะดะตัะตะฝะฝะพะผ ะฒะธะดะต ะธ ั ะผะพะธะผะธ ะพะฑะพะทะฝะฐัะตะฝะธัะผะธ, ัะฐะผ ัะผะพััะตัั ะณะพัะฐะทะดะพ ัะดะพะฑะฝะตะต ะธ ะฟะพะฝััะฝะตะต.

ะะปั ะฝะฐัะฐะปะฐ ะดะฐะฒะฐะนัะต ัะฐััะผะพััะธะผ ะพะฑััั ะฟัะพัะตะดััั ะณะตะฝะตัะฐัะธะธ ัะธะณะฝะฐะปะฐ, ะพะฝะฐ ะฑัะดะตั ะฟะตัะตะธัะฟะพะปัะทะพะฒะฐัััั ะดะปั ะฒัะตั ะพััะฐะปัะฝัั ะบะฐะฝะฐะปะพะฒ:

```
codewords                                               
    โ         User Data                                 
    โโโโโโโโโโโโโโบโb[q](0),b[q](1),...,b[q](M[q](bit)-1)
                  โผ                                     
      โโโโโโโโโโโโโโโโโโโโโโโโโโ                        
      โ       Scrambling       โ                        
      โ      36.211 6.3.1      โ                        
      โโโโโโโโโโโโโฌโโโโโโโโโโโโโ                        
                  โB[q](0),...,B[q](M[q](bit)-1)        
                  โผ                                     
      โโโโโโโโโโโโโโโโโโโโโโโโโโ                        
      โ    Modulation Mapper   โ                        
      โ      36.211 6.3.2      โ                        
      โโโโโโโโโโโโโฌโโโโโโโโโโโโโ                        
                  โd[q](0),...,d[q](M[q](symb)-1)       
                  โผ                                     
      โโโโโโโโโโโโโโโโโโโโโโโโโโ                        
      โ      Layer Mapper      โ                        
      โ      36.211 6.3.3      โ                        
      โโโโโโโโโโโโโฌโโโโโโโโโโโโโ                        
                  โ[x[0](i),...,x[v-1](i)]^T            
                  โผ                                     
      โโโโโโโโโโโโโโโโโโโโโโโโโโ                        
      โ        Precoding       โ                        
      โ      36.211 6.3.4      โ                        
      โโโโโโโโโโโโโฌโโโโโโโโโโโโโ                        
                  โ[y[0](i),...,y[P-1](i)]^T            
                  โ                                     
                  โผ                                     
      โโโโโโโโโโโโโโโโโโโโโโโโโโ                        
      โResource Element Mapper โ                        
      โ      36.211 6.3.5      โ                        
      โโโโโโโโโโโโโฌโโโโโโโโโโโโโ                        
                  โs[p](l)(t)                           
                  โผ                                     
      โโโโโโโโโโโโโโโโโโโโโโโโโโ                        
      โ OFDM Signal Generation โ                        
      โ      36.211 6.12       โ                        
      โโโโโโโโโโโโโโโโโโโโโโโโโโ                        
```

##### 1.1.5.1. Scrambling

Scrambling - ะฟัะพัะตัั ะดะพะฑะฐะฒะปะตะฝะธั ะบ ััััะผ ะฑะธัะฐะผ ะดะฐะฝะฝัั ะธะทะฒะตััะฝะพะณะพ UE ะทะฝะฐัะตะฝะธั. ะะฐััะผะพััะธะผ ะผะฐัะตะผะฐัะธะบั ััะพะณะพ ััะฐะฟะฐ: (PHY Scrambling) https://imgur.com/a/ptgfM4Z.

ะะปั ะฝะฐัะฐะปะฐ ะณะตะฝะตัะธััะตััั ะฝะฐัะฐะปัะฝัะน ะฟะฐัะฐะผะตัั "c": $$ c_{init} = n_{RNTI} \cdot 2^{14} + q \cdot 2^{13} + \lfloor \frac{n_s}{2} \rfloor \cdot 2^9 + N^{cell}_{ID} $$, ะณะดะต $$ n_{RNTI} $$ - RNTI, ะฟัะธัะฒะพะตะฝะฝัะน ัะตะบััะตะน PDSCH ะฟะตัะตะดะฐัะต, $$ N^{cell}_{ID} $$ - Cell Identity (ัะธะทะธัะตัะบะธะน ID ะฒััะบะธ), $$ n_s $$ - ะฝะพะผะตั ัะตะบััะตะณะพ ัะปะพัะฐ. ะ RNTI ะธ Cell ID ะฑัะดะตะผ ะณะพะฒะพัะธัั ะฟะพะทะถะต, ัะตะนัะฐั ะฟัะพััะพ ััะพะธั ะฟัะธะฝััั, ััะพ ะพะฝะธ ะทะดะตัั ะธัะฟะพะปัะทััััั.

ะญัะพั ะฝะฐัะฐะปัะฝัะน ะฟะฐัะฐะผะตัั ะธัะฟะพะปัะทัะตััั ะดะปั ะณะตะฝะตัะฐัะธะธ `c(n)`: 
$$
c(n) = (x_1(n + N_c) + x_2(n+N_c)) \mod 2 \\
x_1(n + 31) = (x_1(n+3) + x_1(n)) \mod 2 \\
x_2(n + 31) = (x_2(n+3) + x_2(n+2) + x_2(n+1) + x_2(n)) \mod 2
$$

ะัะธ ััะพะผ x_1 ะธะฝะธัะธะฐะปะธะทะธััะตััั ัะปะตะดัััะธะผ ะพะฑัะฐะทะพะผ: $$ x_1(0) = 1, \ x_1(n) = 0, \ n = 1,2,\dots,30 $$, ะฐ $$ x_2 $$ ะบะฐะบ ัะฐะท ะธ ะธัะฟะพะปัะทัะตั $$ c_{init} $$: $$ c_{init} = \sum_{i=0}^{30}{x_2(i) \cdot 2^i} $$. ะขะฐะบะฐั ะฝะพัะฐัะธั ะดะปั $$ x_2 $$ ะดะพะฒะพะปัะฝะพ ัะปะพะถะฝะฐั, ะฝะพ ะฟะพัััะธ ะพะฝะฐ ะณะพะฒะพัะธั ะพ ัะพะผ, ััะพ ะฑะตัะตััั ะบะฐะถะดัะน ะฑะธั ะทะฝะฐัะตะฝะธั $$ c_{init} $$ ะธ ะฝะฐะทะฝะฐัะฐะตััั ะบ ะฝะฐัะฐะปัะฝะพะผั ะผะฐััะธะฒั $$ x_2 $$. ะะฐะฟัะธะผะตั ะดะปั $$ c_{init}=9 $$ (0b1001), $$ x_2 $$ ะธะฝะธัะธะฐะปะธะทะธััะตััั ะบะฐะบ [0, 0, ... (26 ะฝัะปะตะน), 1, 0, 0, 1].

ะะพัะปะต ะฒัะตะณะพ ััะพะณะพ ัะณะตะฝะตัะธัะพะฒะฐะฝะฝัะน Gold Sequence ะดะพะฑะฐะฒะปัะตััั ะบ ะฒัะพะดะฝะพะผั ะฝะฐะฑะพัั ะฑะธั: $$ \tilde{b}^{(q)}(i) = (b^{(q)}(i) + c^{(q)}(i)) \mod 2 $$

ะขัั ะฝะฐ ัะฐะผะพะผ ะดะตะปะต ะฝะฐะผะฝะพะณะพ ะฟัะพัะต ัะผะพััะตัั ัะถะต ะฝะฐ ะบะพะด, ะฐ ะฝะต ะฝะฐ ัะพัะผัะปั, ะฟะพััะพะผั:

```python
import math
import matplotlib.pyplot as plt

b = [0, 0, 1, 1, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 1]
RNTI = 5
q = 0
N_cell_id = 133
n_s = 0
Nc = 1600
sequence_length = len(b) 

c_init = RNTI * (2 ** 14) + q * (2 ** 13) + math.floor(n_s / 2) * (2 ** 9) + N_cell_id
c_init_binary = bin(c_init)[2:].rjust(32, "0") 

c = [0] * sequence_length
x_1 = [0] * (32 + Nc + sequence_length)
x_2 = [0] * (32 + Nc + sequence_length)

x_1[0] = 1
x_1[30] = 0

for i, bit in enumerate(c_init_binary):
    x_2[i] = int(bit)

for n in range(Nc + sequence_length):
    x_1[n + 31] = (x_1[n + 3] + x_1[n]) % 2
    x_2[n + 31] = (x_2[n + 3] + x_2[n + 2] + x_2[n + 1] + x_2[n]) % 2

for n in range(sequence_length):
    c[n] = (x_1[n + Nc] + x_2[n + Nc]) % 2

b_hat = [(b[i] + c[i]) % 2 for i in range(len(b))]
```

ะัะปะธ ะพััะธัะพะฒะฐัั ะบะฐะบ $$ c $$, $$ b $$ ะธ $$ \tilde{b} $$ ะพัะฝะพััััั ะดััะณ ะบ ะดััะณั, ัะพ ะผั ัะฒะธะดะธะผ ัะปะตะดััััั ะบะฐััะธะฝั: (PHY Scrambling Bit Diagram) https://imgur.com/a/ptgfM4Z. ะะฐ ะดะธะฐะณัะฐะผะผะต ะผะพะถะฝะพ ะทะฐะผะตัะธัั, ััะพ ะทะฝะฐัะตะฝะธะต ัะตะทัะปััะฐัะฐ ะฝะต ัะพะดะตัะถะธั ะฒ ัะตะฑะต ะฟะพะฒัะพััััะธััั ะฑะพะปััะต 3 ัะฐะท ะฑะธัะพะฒ. ะขัั ั ะฒะฐั ะฟัะธะทัะฒะฐั ะฟะพะธะณัะฐัััั ัะพ ะฒัะพะดะฝัะผะธ ะฟะฐัะฐะผะตััะฐะผะธ ะธ ะฟะพัะผะพััะตัั, ะบะฐะบ ะฑัะดะตั ะธะทะผะตะฝััััั ัะตะทัะปััะฐั. ะั ัะฒะธะดะธัะต, ััะพ ะฒ ะฝะตะผ ะฝะธะบะพะณะดะฐ ะฝะต ะฑัะดะตั ะฑะพะปััะพะณะพ ะบะพะปะธัะตััะฒะฐ ะฟะพะฒัะพัะตะฝะธะน ะฝัะปะตะน ะธะปะธ ะตะดะตะฝะธั. ะญัะพ ะฝัะถะฝะพ ะดะปั ะธะทะฑะตะถะฐะฝะธั ะฟัะพะฑะปะตะผ ะธะท-ะทะฐ ะพัััััะฒะธั ะฟะตัะตัะพะดะฐ ัะพััะพัะฝะธะน, ะฝะฐะฟัะธะผะตั ะฟะพัะตัะธ ัะธะฝััะพะฝะธะทะฐัะธะธ ะธะปะธ ะฟะพัะฒะปะตะฝะธั DC Offset ะฒ ะฟะตัะตะดะฐััะธะบะต.

ะขะฐะบะถะต scrambling ะฟะพะทะฒะพะปัะตั ัะผะตะฝััะธัั ะธะฝัะตััะตัะตะฝัะธั, ะดะพะฑะฐะฒะปัั ะฑะพะปััะต ัะฐะทะฝะธัั ะฒ ัะธะณะฝะฐะปะฐั ะผะตะถะดั ัะฐะทะฝัะผะธ ะฟะพะปัะทะพะฒะฐัะตะปัะผะธ. ะะปั ะดััะณะธั ะฟะพะปัะทะพะฒะฐัะตะปะตะน ัะธะณะฝะฐะป ะดััะณ ะดััะณะฐ ะฑัะดะตั ัะฒะปััััั ัะฐะฝะดะพะผะฝัะผ ััะผะพะผ, ะพะฝ ะฑัะดะตั ัะตะดะบะพ ัะพะฒะฟะฐะดะฐัั, ัะพะพัะฒะตััะฒะตะฝะฝะพ ะฝะต ะฒัะทัะฒะฐั ะบะพััะตะปััะธั ะธ ะธะฝัะตััะตัะตะฝัะธั.

##### 1.1.5.2. Modulation Mapper

ะญัะฐะฟ ะผะพะดัะปััะธะธ. ะขัั ะฒ ัะฟะตัะธัะธะบะฐัะธะธ ะพะฟัะตะดะตะปะตะฝะพ ะฝะตัะบะพะปัะบะพ ะดะพัััะฟะฝัั ะฒะธะดะพะฒ ะผะพะดัะปััะธะธ: QPSK (ะธะปะธ 4QAM), 16QAM, 64QAM ะธ 256QAM.

QAM ะผั ัะถะต ัะฐะทะฑะธัะฐะปะธ ะฒ ะฟัะตะดัะดััะตะผ ัะฐะทะดะตะปะต, ัะผะพััะธัะต Modulation.

##### 1.1.5.3. Layer Mapper

ะญัะฐะฟ ะฟัะตะพะฑัะฐะทะพะฒะฐะฝะธั ะบะพะผะฟะปะตะบัะฝัั ัะผะพะดัะปะธัะพะฒะฐะฝะฝัั ัะธะผะฒะพะปะพะฒ $$ d^{(q)}(0),\dots,d^{(q)}(M^{(q)}_{symb} - 1) $$ ะฒ ะฝะฐะฑะพั ะพัะดะตะปัะฝัั ะฟะพัะพะบะพะฒ, ััะพะฒะฝะตะน (ะธะปะธ, ะบะฐะบ ะฒ ะดะพะบัะผะตะฝัะฐัะธะธ, Layer'ะพะฒ): 
$$
x(i) = \begin{vmatrix} 
  x^{(0)}(i) \\ 
  \vdots \\
  x^{(v-1)}(i)
\end{vmatrix}, \

i = 0,1,\dots,M^{layer}_{symb}-1
$$

ะณะดะต $$ M^{layer}_{symb} $$ - ะบะพะปะธัะตััะฒะพ ัะผะพะดัะปะธัะพะฒะฐะฝะฝัั ัะธะผะฒะพะปะพะฒ ะดะปั ะบะฐะถะดะพะณะพ ััะพะฒะฝั, ะฐ $$ v $$ - ะบะพะป-ะฒะพ ััะพะฒะฝะตะน.

###### 1.1.5.3.1. Layer Mapping ะดะปั ะฟะตัะตะดะฐัะธ ะฝะฐ ะพะดะฝะพะน ะฐะฝัะตะฝะฝะต

ะะฝ ะดะพะฒะพะปัะฝะพ ะฟัะพัั: $$ x^{(0)}(i) = d^{(0)}(i) $$, ะฟัะธ ััะพะผ $$ M^{layer}_{symb} = M^{(0)}_{symb}` (ััั `M^{(0)}_{symb} $$ - ะบะพะปะธัะตััะฒะพ ัะธะผะฒะพะปะพะฒ ะฝะฐ ะฟะตัะฒะพะผ ะฟะพัะพะบะต (codeword'ะต)).

ะะธะดะฝะพ, ััะพ ะดะปั ะพะดะฝะพะน ะฐะฝัะตะฝะฝั ัะผะพะดัะปะธัะพะฒะฐะฝะฝัะต ะทะฝะฐัะตะฝะธั ะฒะพะพะฑัะต ะฝะต ะฟัะพัะพะดัั ะฝะธะบะฐะบะพะณะพ ะฟัะตะพะฑัะฐะทะพะฒะฐะฝะธั ะธ ะฟะตัะตะดะฐัััั ะฝะฐ ัะปะตะดัััะธะน ััะฐะฟ ะฝะฐะฟััะผัั.

###### 1.1.5.3.2. Layer Mapping ะดะปั MIMO

ะขัั ะฝัะถะฝะพ ะฟะพัะผะพััะตัั ะฝะฐ ัะฐะฑะปะธัั 36.211 6.3.3.2-1, Codeword-to-layer mapping for spatial multiplexing. ะ ะฝะตะน ัะบะฐะทะฐะฝั ัะฐะทะปะธัะฝัะต ะฒะพะทะผะพะถะฝัะต ะบะพะฝัะธะณััะฐัะธะธ ะพัะฟัะฐะฒะบะธ, ะฐ ะธะผะตะฝะฝะพ: ะบะพะปะธัะตััะฒะพ ััะพะฒะฝะตะน (v) ะธ ะบะพะปะธัะตััะฒะพ ะฒัะพะดะฝัั ะฟะพัะพะบะพะฒ ัะผะพะดัะปะธัะพะฒะฐะฝะฝัั ัะธะผะฒะพะปะพะฒ (codeword'ะพะฒ). 

ะ ัะปััะฐะต MIMO ะธัะฟะพะปัะทัะตััั ะฝะตัะบะพะปัะบะพ ะฐะฝัะตะฝะฝ, ะฟะพััะพะผั ะตััั ะธ ะพะณัะฐะฝะธัะตะฝะธะต ะฝะฐ ะบะพะปะธัะตััะฒะพ ััะพะฒะฝะตะน: ะพะฝะพ ะดะพะปะถะฝะพ ะฑััั ะผะตะฝััะต ะธะปะธ ัะฐะฒะฝะพ ะบะพะปะธัะตััะฒั ะฐะฝัะตะฝะฝ P. 

ะะฐัะผะผะพััะธะผ ะฝะตัะบะพะปัะบะพ ัะปััะฐะตะฒ Layer Mapping ะดะปั MIMO:

 1. $$ v=4 $$ (ะบะพะป-ะฒะพ ััะพะฒะฝะตะน), $$ q=2 $$ (ะบะพะป-ะฒะพ codeword'ะพะฒ): 
$$
\begin{align*}
  & x^{(0)}(i) = d^{(0)}(2i) \\
  & x^{(1)}(i) = d^{(0)}(2i + 1) \\ 
  & x^{(2)}(i) = d^{(1)}(2i) \\ 
  & x^{(3)}(i) = d^{(1)}(2i+1)
\end{align*}, \ M^{layer}_{symb} = M^{(0)}_{symb} / 2 = M^{(1)}_{symb}/2
$$
 ะ ัะตะผ ะณะพะฒะพัะธั ััะฐ ัะพัะผัะปะฐ: ะฝะฐ ััะพะฒะตะฝั 0 ัะฐัะฟัะตะดะตะปััััั ะฒัะต ัะธะผะฒะพะปั ั ัััะฝัะผะธ ะฝะพะผะตัะฐะผะธ ะธะท ะฒัะพะดะฝะพะณะพ codeword'ะฐ 0; ะฝะฐ ััะพะฒะตะฝั 1 ัะฐัะฟัะตะดะตะปััััั ะฒัะต ัะธะผะฒะพะปั ั ะฝะตัััะฝัะผะธ ะฝะพะผะตัะฐะผะธ ะธะท ะฒัะพะดะฝะพะณะพ codeword'ะฐ 0, ะธ ัะฐะบ ะดะฐะปะตะต. ะขะพ ะตััั ะทะดะตัั ะธะดัั ะฟัะพััะพะต ัะฐะฝะฒะพะผะตัะฝะพะต ัะฐัะฟัะตะดะตะปะตะฝะธะต ัะปะตะผะตะฝัะพะฒ ะฒัะพะดะฝะพะณะพ ะฟะพัะพะบะฐ ะฝะฐ ะฝะตัะบะพะปัะบะพ ะพัะดะตะปัะฝัั ะฟะพัะพะบะพะฒ.

 2. ะขะฐะบะพะต ะฟัะพััะพะต ัะฐัะฟัะตะดะตะปะตะฝะธะต ัะฟัะฐะฒะตะดะปะธะฒะพ ะธ ะดะปั ะดััะณะธั ะบะพะฝัะธะณััะฐัะธะน, ะฝะฐะฟัะธะผะตั ะฒะพะทัะผะตะผ $$ v=8 $$, $$ q=2 $$:
$$
\begin{align*}
  & x^{(0)}(i) = d^{(0)}(4i) \\
  & x^{(1)}(i) = d^{(0)}(4i + 1) \\ 
  & x^{(2)}(i) = d^{(0)}(4i + 2) \\ 
  & x^{(3)}(i) = d^{(0)}(4i+3) \\
                \\
  & x^{(4)}(i) = d^{(1)}(4i) \\
  & x^{(5)}(i) = d^{(2)}(4i + 1) \\ 
  & x^{(6)}(i) = d^{(3)}(4i + 2) \\ 
  & x^{(7)}(i) = d^{(4)}(4i+3) \\
\end{align*} \ M^{layer}_{symb} = M^{(0)}_{symb} / 4 = M^{(1)}_{symb} / 4
$$

 ะขัั ัะถะต ัะธะผะฒะพะปั ัะฐัะฟัะตะดะตะปััััั ะผะตะถะดั ะฒะพัะตะผัั ััะพะฒะฝัะผะธ, ะดะตะนััะฒัะตั ัะฐะบะฐั ะถะต ะปะพะณะธะบะฐ, ะบะฐะบ ะธ ะฒ ะฟะตัะฒะพะผ ัะปััะฐะต: ะฝะฐ ััะพะฒะตะฝั 0 ัะฐัะฟัะตะดะตะปััััั ะฒัะต ัะธะผะฒะพะปั ั ะฝะพะผะตัะฐะผะธ, ะบัะฐัะฝัะผะธ 4 ะธะท ะฒัะพะดะฝะพะณะพ codeword'ะฐ 0; ะฝะฐ ััะพะฒะตะฝั 1 ัะฐัะฟัะตะดะตะปััััั ะฒัะต ัะต ัะธะผะฒะพะปั, ะบะพัะพััะต ัะปะตะดััั ะทะฐ ัะธะผะฒะพะปะฐะผะธ ั ะฝะพะผะตัะฐะผะธ, ะบัะฐัะฝัะผะธ 4 ะธะท ะฒัะพะดะฝะพะณะพ codeword'ะฐ 0, ะธ ัะฐะบ ะดะฐะปะตะต.

###### 1.1.5.3.3. Layer Mapping ะดะปั Diversity

ะก Diversity ะผั ัะฐะทะฑะธัะฐะปะธัั ัะฐะฝะตะต. ะัะพ ะฝะต ะฟะพะผะฝะธั, ััะพ ะบะพะณะดะฐ ะฝะตัะบะพะปัะบะพ ะฐะฝัะตะฝะฝ ะฒะตัะฐัั ะพะดะธะฝ ะธ ัะพั ะถะต ัะธะณะฝะฐะป (ะพะฝ ัะฐะบะถะต ะผะพะถะตั ะฑััั ัะผะตััะฝ, ะฟะพะผะฝะธะผ Large Delay CDD).

ะะดะตัั ัะฐะฑะพัะฐะตั ัะฐะบะฐั ะถะต ะปะพะณะธะบะฐ, ะบะฐะบ ะธ ะดะปั Layer Mapping ะดะปั MIMO. ะะดะฝะฐะบะพ ะดะตะนััะฒัะตั ะดััะณะฐั ัะฐะฑะปะธัะฐ: 6.3.3.3-1 ะธ ะดััะณะพะต ะพะณัะฐะฝะธัะตะฝะธะต ะฝะฐ ะบะพะปะธัะตััะฒะพ ััะพะฒะฝะตะน: ะพะฝะพ ะดะพะปะถะฝะพ ะฑััั ัััะพะณะพ ัะฐะฒะฝะพ ะบะพะป-ะฒั ะฐะฝัะตะฝะฝ P.

ะะฝัะตัะตั ะฒัะทัะฒะฐะตั ัะปััะฐะน $$ v=4 $$, $$ q=1 $$:
$$
\begin{align}
  & x^{(0)}(i) = d^{(0)}(4i) \\
  & x^{(1)}(i) = d^{(0)}(4i + 1) \\ 
  & x^{(2)}(i) = d^{(0)}(4i + 2) \\ 
  & x^{(3)}(i) = d^{(0)}(4i+3) \\
\end{align} \\
M^{layer}_{symb} = \begin{cases} 
  M^{(0)}_{symb} / 4 \text{ if } M^{(0)}_{symb} \mod 4 = 0 \\
  (M^{(0)}_{symb} + 2) / 4 \text{ if } M^{(0)}_{symb} \mod 4 \neq 0
\end{cases}
$$

ะัะปะธ ะฒ MIMO ะฟะพะดัะฐะทัะผะตะฒะฐะปะพัั, ััะพ ะบะพะปะธัะตััะฒะพ ัะธะผะฒะพะปะพะฒ ะฒ codeword ะฒัะตะณะดะฐ ัะพะฒะฟะฐะดะฐะตั ั ัะตะผ, ััะพ ะพะถะธะดะฐะตั Layer Mapper (ั.ะต ะฝะฐะฟัะธะผะตั ะดะปั $$ v=8 $$, $$ q=2 $$ ะพะฝะพ ะดะพะปะถะฝะพ ะฑััั ะบัะฐัะฝะพ 4, ััะพ ััะปะพะฒะธะต ะธััะพะดะธั ะธะท ะฒัะพัะพะน ัะฐััะธ ะฒััะฐะถะตะฝะธั, ะณะดะต ะพะฟัะตะดะตะปัะฝ $$ M^{layer}_{symb} $$), ัะพ ััั ัะฐะบะพะณะพ ะฝะตั ะธ ะฟะพะดัะฐะทัะผะตะฒะฐะตััั, ััะพ ะบะพะปะธัะตััะฒะพ ัะธะผะฒะพะปะพะฒ ะฒ codeword'ะต ะฑัะดะตั ะฟัะพััะพ ัััะฝะพ. 
ะขะฐะบ ะฒะพั, ะตัะปะธ ะบะพะปะธัะตััะฒะพ ัะธะผะฒะพะปะพะฒ ะฝะต ะบัะฐัะฝะพ 4, ัะพ ะฒะพ ะฒัะพะดะฝะพะน ะฟะพัะพะบ $$ d $$ ะดะพะฑะฐะฒะปัะตััั 2 ะฝัะปะตะฒัั ัะธะผะฒะพะปะฐ ะธ ะดะตะนััะฒัะตั ะฒัะพัะฐั ัะฐััั ะฒััะฐะถะตะฝะธั ะพะฟัะตะดะตะปะตะฝะธั $$ M^{layer}_{symb} $$).

ะขัั ั ัะพะถะต ะฝะฐะฟะธัะฐะป ััะพะฑั ะฑัะปะพ ะฟัะพัะต ะฟะพะฝะธะผะฐัั ะบะฐะบ ัะฐะฑะพัะฐะตั ััะพั ััะฐะฟ:

```python
import numpy as np
import modulation

symbols = modulation.modulate_bits([0, 1, 1, 1, 0, 0, 1, 0, 1, 0, 0, 1])
d = np.array([ symbols ])

def mapping_dimension(v, q):
    return ((v // q), v - (v // q))

def layer_mapper(d, v):
    dimension = mapping_dimension(v, len(d))
    M_layer_symb = len(d[0]) // dimension[0]
    x = [
        [0] * M_layer_symb
        for _ in range(v)
    ]

    for layer in range(v):
        current_codeword = 0 if layer < dimension[0] else 1
        current_mod = dimension[0] if layer < dimension[0] else dimension[1]
        for i in range(M_layer_symb):
            x[layer][i] = d[current_codeword][current_mod * i + layer]
            print(current_mod)

    return x

print(layer_mapper(d, 3))
```

ะ ัะฐะบะถะต ัะดะตะปะฐะป ัะฐะบัั ะธะปะปััััะฐัะธั, ะณะดะต ัะพะฑัะฐะป ะฒะผะตััะต ะฒัะต ัะฐะฑะปะธัั. ะ ะฝะตะน ะผะพะถะฝะพ ะพะฑัะฐัะฐัััั ััะพะฑั ัะดะพะฑะฝะพ ะฒะธะดะตัั ะฒัั ะธะฝัะพัะผะฐัะธั ะฟัะพ Layer Mapping: (PHY Layer Mapping) https://imgur.com/a/ptgfM4Z.

##### 1.1.5.4. Precoding

ะก ััะธะผ ััะฐะฟะพะผ ะผั ัะถะต ัะฐะทะฑะธัะฐะปะธัั ัะฐะฝะตะต, ััะพ ะบะฐะบ ัะฐะท ัะพั ััะฐะฟ ะฟัะตะพะฑัะฐะทะพะฒะฐะฝะธั ัะธะณะฝะฐะปะฐ ะธัะฟะพะปัะทัั codebook.

##### 1.1.5.5. Mapping to resource elements

ะะฐะทะผะตัะตะฝะธะต ะบะฐะถะดะพะณะพ ัะธะผะฒะพะปะฐ ะฒ ัะฒะพะธ ัะพะพัะฒะตััะฒัััะธะต ะผะตััะฐ ะฒ Resouse Grid. ะข.ะต ัะฐัะฟัะตะดะตะปะตะฝะธะต ัะธะผะฒะพะปะพะฒ ะฟะพ ะฒัะตะผะตะฝะธ ะธ ัะฐััะพัะต. ะะฐะถะดัะน ะบะฐะฝะฐะป ะทะฐะฝะธะผะฐะตั ัะฒะพั ะผะตััะพ ะฒ Resource Grid, ะทะดะตัั ะพะฝะธ ะพัะผะตัะตะฝั ัะฒะตัะฐะผะธ: (Resource Grid) https://imgur.com/a/4FquDey.

##### 1.1.5.6. Physical Downlink Shared Channel (36.211 6.4)

PDSCH ััะพ ัะธะทะธัะตัะบะธะน ะบะฐะฝะฐะป, ะฟัะตะดะฝะฐะทะฝะฐัะตะฝะฝัะน ะดะปั ะฟะตัะตะดะฐัะธ ะฟะพะปัะทะพะฒะฐัะตะปััะบะธั ะดะฐะฝะฝัั. ะะปั ััะพะณะพ ะบะฐะฝะฐะปะฐ ะดะตะนััะฒัะตั ััะฐะฝะดะฐััะฝะฐั ะฟัะพัะตะดััะฐ ะณะตะฝะตัะฐัะธะธ ัะธะณะฝะฐะปะฐ, ะพะฟะธัะฐะฝะฝะฐั ะฒััะต. ะะดะฝะฐะบะพ ะตััั ะธ ะฝะตะบะพัะพััะต ะดะตัะฐะปะธ, ัะฝะธะบะฐะปัะฝัะต ะดะปั ััะพะณะพ ะบะฐะฝะฐะปะฐ:

 1. ะ Resource Block'ะฐั, ะฒ ะบะพัะพััั ะพัะฟัะฐะฒะปัะตััั UE-Specific Reference Signal, PDSCH ะดะพะปะถะตะฝ ะฑััั ะพัะฟัะฐะฒะปะตะฝ ะธัะฟะพะปัะทัั ะฐะฝัะตะฝะฝั {5}, {7}, {8}, {11}, {13}, {11,13}, ะธะปะธ {7, 8, ..., v+6}, ะณะดะต $$ v $$ - ะบะพะป-ะฒะพ ััะพะฒะฝะตะน ะดะปั PDSCH.
 2. ะ Resourse Block'ะฐั, ะฒ ะบะพัะพััั UE-Specific Reference Signal ะฝะต ะพัะฟัะฐะฒะปัะตััั, PDSCH ะดะพะปะถะตะฝ ะฑััั ะพัะฟัะฐะฒะปะตะฝ ะธัะฟะพะปัะทัั ะฐะฝัะตะฝะฝั {0}, ะปะธะฑะพ {0,1}, ะปะธะฑะพ {0, 1, 2, 3}. 

    ะะฐะผะตัะบะฐ: ะฟัะพ UE-Specific Reference Signal ะฑัะดะตะผ ะณะพะฒะพัะธัั ะฟะพะทะถะต, ะฒ ัะฐะทะดะตะปะต ะฟัะพ ัะธะณะฝะฐะปั.
 3. PDSCH ะฝะต ะดะพะปะถะตะฝ ะฑััั ะฝะฐะทะฝะฐัะตะฝ ะปัะฑัะผ ะฟะฐัะฐะผ PRB ะฒ ะบะพัะพััั ะฟะตัะตะดะฐัััั EPDCCH (ะฟัะพ PDCCH ะธ EPDCCH ะฟะพะทะถะต).
 4. ะะปั Frame Structure type 1 (FDD), PDSCH ะฝะฐ 5 ะฐะฝัะตะฝะฝะต ะฝะต ะดะพะปะถะตะฝ ะทะฐะฝะธะผะฐัั PRB ะฒ ะบะพัะพััั ะฝะฐัะพะดะธััั PBCH ะธะปะธ PSS/SSS.

##### 1.1.5.7. Physical Multicast Channel (36.211 6.5)

PMCH - ะบะฐะฝะฐะป ะธัะฟะพะปัะทัััะธะนัั ะดะปั ะฟะตัะตะดะฐัะธ ะดะฐะฝะฝัั ััะฐะทั ะฝะตัะบะพะปัะบะธะผ ะฒัะฑัะฐะฝะฝัะผ ะฟะพะปัะทะพะฒะฐัะตะปัะผ. ะะปั ะฝะตะณะพ ะดะตะนััะฒัะตั ััะฐะฝะดะฐััะฝะฐั ะฟัะพัะตะดััะฐ, ะพะฟะธัะฐะฝะฝะฐั ัะฐะฝะตะต ัะพ ัะปะตะดััะธะผะธ ะธัะบะปััะตะฝะธัะผะธ:

 1. Transmit Diversity ะฝะต ะดะพะปะถะตะฝ ะฑััั ะธัะฟะพะปัะทะพะฒะฐะฝ ะฟัะธ ะฟะตัะตะดะฐัะต ะดะฐะฝะฝัั ะฟะพ ััะพะผั ะบะฐะฝะฐะปั
 2. Layer Mapping ะธ Precoding ะดะพะปะถะฝั ะฑััั ะพัััะตััะฒะปะตะฝั ัะพะปัะบะพ ะฟัะตะดะฟะพะปะฐะณะฐั, ััะพ ะดะปั ะฟะตัะตะดะฐัะธ ะดะฐะฝะฝัั ะฑัะดะตั ะธัะฟะพะปัะทะพะฒะฐัััั ะพะดะฝะฐ ะฐะฝัะตะฝะฝะฐ. 
 3. ะะปั ะฟะตัะตะดะฐัะธ ััะพะณะพ ะบะฐะฝะฐะปะฐ ะดะพะปะถะฝะฐ ะฑััั ะธัะฟะพะปัะทะพะฒะฐะฝะฐ ะฐะฝัะตะฝะฝะฐ 4.
 4. ะะตัะตะดะฐัะฐ ััะพะณะพ ะบะฐะฝะฐะปะฐ ะดะพะปะถะฝะฐ ะพัััะตััะฒะปััััั ัะพะปัะบะพ ะฒ ัะฟะตัะธะฐะปัะฝัั MBSFN subframe'ะฐั. ะัะธ ััะพะผ ะฝะพะผะตั RE ะฒ ะฟะตัะฒะพะผ ัะปะพัะต $$ l $$ ะดะพะปะถะตะฝ ะฑััั ะฑะพะปััะต ะธะปะธ ัะฐะฒะฝะพ, ัะตะผ $$ l_{PMCHStart} $$, ะณะดะต $$ l_{PMCHStart} $$ ัะบะฐะทัะฒะฐะตััั ะฟะฐัะฐะผะตััะพะผ non-MBSFNregionLength, ะบะพัะพััะน ะพัะฟัะฐะฒะปัะตััั ะฒ SIB13 (ะฟัะพ SIB ะฟะพะทะถะต)
 5. PMCH ะดะพะปะถะตะฝ ะฒัะตะณะดะฐ ะธัะฟะพะปัะทะพะฒะฐัั Extended Cyclic Prefix
 
##### 1.1.5.8. Physical Broadcast Channel (36.211 6.6)

PBCH - ะบะฐะฝะฐะป, ะธัะฟะพะปัะทัััะธะนัั ะดะปั ะพัะฟัะฐะฒะบะธ MIB (Main Information Block). ะะปั ะฝะตะณะพ ะดะตะนััะฒัะตั ะฝะตะผะฝะพะณะพ ะดััะณะฐั ะฟัะพัะตะดััะฐ ะณะตะฝะตัะฐัะธะธ ัะธะณะฝะฐะปะฐ.

 1. Scrambling. ะะปั scrambling ะธัะฟะพะปัะทัะตััั ััะฐะฝะดะฐััะฝะฐั ัะพัะผัะปะฐ ะฟะพะปััะตะฝะธั b_hat, ะพะดะฝะฐะบะพ ะพัะปะธัะฐะตััั $$ c_{init} $$. ะ ัะปััะฐะต PBCH, $$ c_{init} = N^{cell}_{ID}`, ะณะดะต `N^{cell}_{ID} $$ - ัะธะทะธัะตัะบะธะน ID ะฒััะบะธ. 
 ะขะฐะบะถะต ััะพะธั ัะฟะพะผัะฝััั, ััะพ ะบะพะปะธัะตััะฒะพ ะฑะธั ะฒะพ ะฒัะพะดะฝะพะผ ะผะฐััะธะฒะต ะฑัะดะตั ัะฐะฒะฝะพ 1920 ะดะปั Normal Cyclic Prefix ะธ 1728 ะดะปั Extended Cyclic Prefix. 
 2. Modulation - PBCH ะธัะฟะพะปัะทัะตั ัะพะปัะบะพ QPSK (4QAM), ั.ะต ะดะฒะฐ ะฑะธัะฐ ะฝะฐ ะบะฐะถะดัะน RE.
 3. Layer Mapping ะธ Precoding - ะพัััะตััะฒะปัะตััั ัะพะปัะบะพ ะดะปั ะพะดะฝะพะน ะฐะฝัะตะฝะฝั, ะปะธะฑะพ Transmission Diversity. MIMO ะดะปั ััะพะณะพ ะบะฐะฝะฐะปะฐ ะฝะธะบะพะณะดะฐ ะฝะต ะธัะฟะพะปัะทัะตััั. ะัะธ ััะพะผ ะดะปั Precoding ะบะพะป-ะฒะพ ะฐะฝัะตะฝะฝ P ะผะพะถะตั ะฑััั ัะฐะฒะฝะพ ัะพะปัะบะพ 1, 2 ะธะปะธ 4.
 4. Mapping to resource elements - PBCH ะฒัะตะณะดะฐ ะพัะฟัะฐะฒะปัะตััั ะฒ slot 1 ะฒ subframe 0. ะัะธ ััะพะผ: (PHY PBCH Resource Grid Mapping Formula) https://imgur.com/a/ptgfM4Z: 
$$
k = \frac{N^{DL}_{RB} N^{RB}_{sc}}{2} - 36+k', \ k' = 0,1,\dots,71 \\
l = 0,1,\dots,3
$$
 ะข.ะต PBCH ะฑัะดะตั ะฟะพัะฒะปััััั ะฒ ะบะฐะถะดะพะผ slot 1, subframe 0 ะธ ะฑัะดะตั ะทะฐะฝะธะผะฐัั ะฒ ะฝะตะผ ะฟะตัะฒัะต 4 RE, ะทะฐ ะธัะบะปััะตะฝะธะตะผ Reference Signal ะธ ะทะฐัะตะทะตัะฒะธัะพะฒะฐะฝะฝัั RE, ะทะฐ ััะพ ะพัะฒะตัะฐะตั $$ l $$. $$ k $$ ะพัะฒะตัะฐะตั ะทะฐ ัะพ, ััะพ ะบะฐะฝะฐะป ะฑัะดะตั ะฟะตัะตะดะฐะฒะฐัััั ัะพะฒะฝะพ ะฝะฐ 72 subcarrier'ะฐั ะฟะพ ัะตะฝััั Resource Grid. ะงัะพะฑั ััะพ ะปัััะต ะฟะพะฝััั, ะผะพะถะฝะพ ะฟะพะดััะฐะฒะธัั ะทะฝะฐัะตะฝะธั: $$ N^{DL}_{RB} $$ - ััะพ ะบะพะปะธัะตััะฒะพ PRB, ะบะพัะพัะพะต ะทะฐะฒะธัะธั ะพั Bandwith, $$ N^{RB}_{sc} $$ - ััะพ ะบะพะปะธัะตััะฒะพ subcarrier ะฒ ะพะดะฝะพะผ PRB (ัะฐัะต ะฒัะตะณะพ 12). ะขะฐะบะธะผ ะพะฑัะฐะทะพะผ, ะฝะฐะฟัะธะผะตั, ะฟัะธ BW=3, $$ N^{DL}_{RB}=15 $$, $$ N^{RB}_{sc}=12 $$, PBCH ะฑัะดะตั ะฟะตัะตะดะฐะฝ ะฝะฐัะธะฝะฐั ั Subcarrier 54 ะดะพ subcarrier `54+71=125`. ะะธะทัะฐะปัะฝะพ ััะพ ะผะพะถะฝะพ ะฟัะตะดััะฐะฒะธัั ัะฐะบ: (PHY PBCH Resource Grid Mapping) https://imgur.com/a/ptgfM4Z. 

##### 1.1.5.9. Physical Control Frame Indicator Channel (36.211 6.7)

PCFICH - ะบะฐะฝะฐะป, ะฟัะตะดะฝะฐะทะฐัะตะฝะฝัะน ะดะปั ะพัะฟัะฐะฒะบะธ ะดะฐะฝะฝัั ะพ ััััะบัััะต ัะฟัะฐะฒะปัััะธั ะบะฐะฝะฐะปะพะฒ, ะฝะฐะฟัะธะผะตั PDCCH. ะะพ ะฝะตะผั ะพัะฟัะฐะฒะปัะตััั ะธะผะตะฝะฝะพ ะบะพะป-ะฒะพ OFDM ัะธะผะฒะพะปะพะฒ ะฒ ะฝะธั.

 1. Scrambling - ะัะฟะพะปัะทัะตััั ััะฐะฝะดะฐััะฝะฐั ัะพัะผัะปะฐ ะฟะพะปััะตะฝะธั b_hat, ะพะดะฝะฐะบะพ $$ c_{init} $$ ะพัะปะธัะฐะตััั. ะะฝ ะพะฟัะตะดะตะปัะตััั ัะฐะบ: $$ c_{init} = (\lfloor n_s/2 \rfloor + 1) \cdot (2N^{cell}_{ID} + 1) \cdot 2^9 + N^{cell}_{ID} $$: (PHY PCFICH Scrambling c_init) https://imgur.com/a/ptgfM4Z. ะะพะป-ะฒะพ ะฑะธั ะทะดะตัั ะฑัะดะตั ัะฐะฒะฝะพ 31.
 2. Modulation - PCFICH ะธัะฟะพะปัะทัะตั ัะพะปัะบะพ QPSK
 3. Layer Mapping ะธ Precoding - ะพัััะตััะฒะปัะตััั ัะฐะบะถะต, ะบะฐะบ ะธ ะฒ PBCH
 4. Mapping to resource elements - PCFICH ะพัะฟัะฐะฒะปัะตััั ะณััะฟะฟะฐะผะธ ะฟะพ 4 RE. ะะฐะถะดัะน ะธะท 4 ัะธะผะฒะพะปะพะฒ ะทะฐะฝะธะผะฐะตั ัะฒะพั ะผะตััะพ ะฒ Resource Grid. ะัะธ ััะพะผ ะผะตะฝัะตััั ั ะฝะธั ัะพะปัะบะพ ะฟะพะปะพะถะตะฝะธะต ะฟะพ ัะฐััะพัะต, ะฟะพ ะฒัะตะผะตะฝะธ PCFICH ะฒัะตะณะดะฐ ะฝะฐัะพะดะธััั ะฒ ะฟะตัะฒะพะผ OFDM ัะธะผะฒะพะปะต subframe'ะฐ. ะะฐััะผะพััะธะผ ะฟัะพัะตัั ัะฐัะฟัะตะดะตะปะตะฝะธั ัะธะผะฒะพะปะพะฒ ะฟะพ RG:
:::margin{ml=28}
  4.1. ะะฐ ะฒัะพะด ะฟะพะดะฐัััั 4 QPSK ัะธะผะฒะพะปะฐ, ะพะฑะพะทะฝะฐัะธะผ ะธั ัะฐะบ: $$ \zeta^{(p)}(i) = \langle y^{(p)}(4i),y^{(p)}(4i+1),y^{(p)}(4i+2),y^{(p)}(4i+3) \rangle $$

  4.2. ะะฐะถะดะพะผั ะธะท ะฝะธั ะฝะฐะทะฝะฐัะฐะตััั ัะฒะพั ะทะฝะฐัะตะฝะธะต $$ k $$, ะบะพัะพัะพะต ัะฒะปัะตััั ะฝะพะผะตัะพะผ subcarrier ะฒ ะบะฐะดัะต:
$$
\zeta^{(p)}(0) \rightarrow k = \bar{k} \\
\zeta^{(p)}(1) \rightarrow k = \bar{k} + \lfloor N^{DL}_{RB}/2 \rfloor \cdot N^{RB}_{sc} /2 \\
\zeta^{(p)}(2) \rightarrow k = \bar{k} + \lfloor 2N^{DL}_{RB}/2 \rfloor \cdot N^{RB}_{sc} /2 \\
\zeta^{(p)}(3) \rightarrow k = \bar{k} + \lfloor 3N^{DL}_{RB}/2 \rfloor \cdot N^{RB}_{sc} /2 
$$
  ะะดะตัั ััะพะธั ะทะฐะผะตัะธัั, ััะพ ะพะฟะตัะฐัะธั ัะปะพะถะตะฝะธั ะฒัะฟะพะปะฝัะตััั ั modulo $$ N^{DL}_{RB} N^{RB}_{sc} $$, ั ะฝะต ััะฐะป ะดะพะฑะฐะฒะปััั ััะพ ะฒ ัะพัะผัะปั ัะฐะบ ะบะฐะบ ะพะฝะฐ ะฑัะปะฐ ะฑั ัะปะธัะบะพะผ ะณัะพะผะพะทะดะบะพะน.

  4.3. ะะฐัะฐะผะตัั $$ \bar{k} $$ ะณะตะฝะตัะธััะตััั ัะฐะบ: $$ \bar{k} = \frac{1}{2} N^{RB}_{sc} \cdot (N^{cell}_{ID} \mod 2N^{DL}_{RB}) $$
:::

 ะะพะปะฝัั ััะตะผั ััะพะณะพ ััะฐะฟะฐ ั ะธะทะพะฑัะฐะทะธะป ััั: (PHY PCFICH Resource Element Mapping) https://imgur.com/a/ptgfM4Z.
 ะ ัะฐะบะถะต ะผะพะถะฝะพ ะฟะพัะผะพััะตัั ะบะฐะบ ััะพ ะฑัะดะตั ะฒัะณะปัะดะตัั ะฒ ะดะตะนััะฒะธะธ, ััั ะทะตะปัะฝัะผ ะพะฑะพะทะฝะฐัะตะฝ ะบะฐะบ ัะฐะท PCFICH: (PHY PCFICH Resource Element Mapping Example) https://imgur.com/a/ptgfM4Z.

##### 1.1.5.10. Physical Downlink Control Channel (36.211 6.8)

PDCCH - ะพะดะธะฝ ะธะท ัะฐะผัั ะฒะฐะถะฝัั ะบะฐะฝะฐะปะพะฒ. ะะพ ะฝะตะผั ะธะดัั ะดะฐะฝะฝัะต DCI (Downlink Control Information), ะบะพัะพััะต ะฟะพะทะฒะพะปััั ะพัััะตััะฒะปััั ะฒัะดะตะปะตะฝะธะต ัะตััััะพะฒ, ะฐ ัะฐะบะถะต ะดััะณะธะต ะบะพะฝััะพะปะปะธััััะธะต ะดะตะนััะฒะธั. ะ ะฟัะพัะตะดััะต PDCCH ะผั ะตัั ะฒะตัะฝะตะผัั, ัะตะนัะฐั ะฟะพะบะฐ ััะพ ัะฐััะผะฐััะธะฒะฐะตะผ ัะพะปัะบะพ ัะธะทะธัะตัะบะธะน ััะพะฒะตะฝั.

ะะฐะฝะฝัะต, ะฟะตัะตะดะฐััะธะตัั ะฟะพ PDCCH ะพัะณะฐะฝะธะทะพะฒะฐะฝั ะฒ CCE - Control Channel Elements, ะบะพัะพััะน ัะพะดะตัะถะธั ะฒ ัะตะฑะต 9 Resource Element Group. ะัะณะฐะฝะธะทะฐัะธั CCE ะธ REG ะผั ัะฐััะผะฐััะธะฒะฐะปะธ ะดะพ ััะพะณะพ, ะฒ ัะฐะทะดะตะปะต ะฟัะพ Resourse Grid. 

ะกััะตััะฒัะตั ะฝะตัะบะพะปัะบะพ ัะพัะผะฐัะพะฒ PDCCH, ะพะฝะธ ะฟัะตะดััะฐะฒะปะตะฝั ะฒ ัะฐะฑะปะธัะต 36.211 6.8.1-1:
```
โโโโโโโโโโฆโโโโโโโฆโโโโโโโโโโโโโฆโโโโโโโโโโโโโโโ
โ Format โ CCEs โ RE Groups  โ PDCCH Bits   โ
โโโโโโโโโโฌโโโโโโโฌโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโฃ
โ   0    โ  1   โ     9      โ     72       โ
โ   1    โ  2   โ    18      โ    144       โ
โ   2    โ  4   โ    36      โ    288       โ
โ   3    โ  8   โ    72      โ    576       โ
โโโโโโโโโโฉโโโโโโโฉโโโโโโโโโโโโโฉโโโโโโโโโโโโโโโ
```

ะขัั ะฒะธะดะฝะพ, ััะพ ะบะฐะถะดัะน ัะพัะผะฐั ะผะพะถะตั ะฝะตััะธ ะฒ ัะตะฑะต ัะฐะทะปะธัะฝะพะต ัะธัะปะพ ะฑะธั. ะขะฐะบะพะต ัะฐะทะดะตะปะตะฝะธะต ะฝะฐ ัะพัะผะฐัั ะฝะตะพะฑัะพะดะธะผะพ ะดะปั ะพะฑะตัะฟะตัะตะฝะธั ััะฐะฑะธะปัะฝะพััะธ ะบะฐะฝะฐะปะฐ. ะะพะณะดะฐ ะฝะตะพะฑัะพะดะธะผะพ ะพัะฟัะฐะฒะธัั ะผะฐะปะพะต ะบะพะปะธัะตััะฒะพ ะดะฐะฝะฝัั, ะฒััะบะฐ ะฑัะดะตั ะธัะฟะพะปัะทะพะฒะฐัั ัะพัะผะฐั 0, ะบะพะณะดะฐ ะฝะตะพะฑัะพะดะธะผะพ ะฑัะดะตั ะพัะฟัะฐะฒะธัั ะฑะพะปััะพะต ะบะพะป-ะฒะพ ะดะฐะฝะฝัั, ะฑัะดะตั ะธัะฟะพะปัะทะพะฒะฐัััั ัะพัะผะฐั 1,2 ะธะปะธ 3. ะงะตะผ ะผะตะฝััะต ะดะฐะฝะฝัั ะพัะฟัะฐะฒะปัะตััั ะฟะพ ะบะฐะฝะฐะปั, ะธ, ัะพะพัะฒะตััะฒะตะฝะฝะพ, ััะธััะฒะฐะตััั ะฝะฐ UE, ัะตะผ ะผะตะฝััะต ะผะพะถะตั ะฒะพะทะฝะธะบะฝััั ะพัะธะฑะพะบ ะฒ ะดะตะบะพะดะธัะพะฒะฐะฝะธะธ ัะธะณะฝะฐะปะฐ. ะ ัะฐะบ ะบะฐะบ PDCCH - ะพัะตะฝั ะฒะฐะถะฝัะน ะบะฐะฝะฐะป, ะบะพัะพััะน ะฒัะฟะพะปะฝัะตั ะบะปััะตะฒัั ััะฝะบัะธั LTE - ะฟัะพััะพ ะฝะตะพะฑัะพะดะธะผะพ ะพะฑะตัะฟะตัะธัั ะตะผั ะดะพััะฐัะพัะฝัั ะณะธะฑะบะพััั, ััะพะฑั ะดะฐะถะต ะฒ ะฟะปะพัะธั ััะปะพะฒะธัั ะบะพะผะผัะฝะธะบะฐัะธะธ ะผะพะถะฝะพ ะฑัะปะพ ะฟะพ ััะพะผั ะบะฐะฝะฐะปั ะดะพััะฐะฒะปััั ะดะฐะฝะฝัะต.

ะขะตะฟะตัั ัะฐะทะฑะตัะตะผัั ั ััะฐะฟะฐะผะธ ะณะตะฝะตัะฐัะธะธ ัะธะณะฝะฐะปะฐ:

 1. Scrambling - ััะพั ััะฐะฟ ะดะปั PDCCH ะธะผะตะตั ะดะพััะฐัะพัะฝะพ ะธะฝัะตัะตัะฝัะน ะฟัะพัะตัั: ะฟะตัะตะด ัะฐะผะธะผ ะฝะตะฟะพััะตะดััะฒะตะฝะฝะพ Scrambling'ะพะผ, ะฑะธัั ัะพ ะฒัะตั ะฟะพัะพะบะพะฒ ัะพะฑะธัะฐัััั (ะผัะปััะธะฟะปะตะบัะธัััััั (ะธัะฟะพะปัะทัั ะพัะธัะธะฐะปัะฝัั ัะตัะผะธะฝะพะปะพะณะธั)) ะฒ ะพะดะธะฝ ะฑะพะปััะพะน ะฟะพัะพะบ ะฑะธั, ั.ะต: ะผั ะฟะพะปััะฐะตะผ ะฝะฐ ะฒัะพะด $$ i $$ ะฟะพัะพะบะพะฒ ะฒ ะฒะธะดะต: $$ b^{(i)}(0),\dots,b^{(i)}(M^{(i)}_{bit} - 1) $$, ะณะดะต $$ M^{(i)}_{bit} $$ - ะบะพะป-ะฒะพ ะฑะธั ะฒ ัะตะบััะตะผ subframe, ะบะพัะพััะต ะฑัะดัั ะฟะตัะตะดะฐะฒะฐัััั ะฟะพ PDCCH ะบะฐะฝะฐะปั ั ะฝะพะผะตัะพะผ $$ i $$. ะะฐ ะฒััะพะดะต ั ะผัะปััะธะฟะปะตะบัะธัะพะฒะฐะฝะธั ะผั ะฑัะดะตะผ ะธะผะตัั ะฝะฐะฑะพั ะฑะธั $$ b^{(0)}(0),\dots,b^{(0)}(M^{(0)}_{bit} - 1),b^{(1)}(0),\dots,b^{(1)}(M^{(1)}_{bit} -1),\dots,b^{(n_{PDCCH} -1)}(0),\dots,^{(n_{PDCCH} -1)}(M^{(n_{PDCCH}-1)}_{bit} -1) $$.
 ะะฐัะตะผ ะบ ััะพะผั ะฝะฐะฑะพัั ะฑะธั ะฑัะดะตั ะฟัะธะผะตะฝะตะฝะฐ ััะฐะฝะดะฐััะฝะฐั ัะพัะผัะปะฐ scrambling, ะพะดะฝะฐะบะพ ั ะธะทะผะตะฝัะฝะฝัะผ $$ c_{init} $$: $$ c_{init} = \lfloor n_s / 2 \rfloor \cdot 2^9 + N^{cell}_{ID} $$
 ะัะธ ััะพะผ ััะพะธั ะทะฐะผะตัะธัั, ััะพ ะดะพ scrambling'ะฐ ะดะพ 9 ะฝัะปะตะฒัั ัะปะตะผะตัะพะฒ ะผะพะณัั ะฑััั ะดะพะฑะฐะฒะปะตะฝั ะบ ะฑะปะพะบั ััะพะฑั PDCCH ะฝะฐัะธะฝะฐะปัั ั ะฝัะถะฝะพะน CCE, ะฝะพ ะพะฑ ััะพะผ ะฟะพะทะถะต, ััะพ ัะถะต ัะฐััั ะฟัะพัะตะดััั PDCCH.
 2. Modulation - ะดะปั PDCCH ะธัะฟะพะปัะทัะตััั ัะพะปัะบะพ QPSK
 3. Layer Mapping ะธ Precoding - ะพัััะตััะฒะปัะตััั ัะฐะบะถะต, ะบะฐะบ ะธ PBCH

 4. Mapping to resource elements - ะะฐัะฟัะตะดะตะปะตะฝะธะต ัะธะผะฒะพะปะพะฒ ะดะปั PDCCH ัะฐะบะถะต ะพัััะตััะฒะปัะตััั ะฟะพ ะณััะฟะฟะฐะผ ะฒ 4 ัะธะผะฒะพะปะฐ. ะะฐะทะฑะตัะตะผ ััะพั ะฟัะพัะตัั ะฟะพััะฐะฟะฝะพ, ัะฐะบ ะบะฐะบ ะพะฝ ะดะพััะฐัะพัะฝะพ ัะปะพะถะฝัะน:
:::margin{ml=28}
  4.1. ะะปั ะฝะฐัะฐะปะฐ ะฒัะต ัะธะผะฒะพะปั ะฟะพัะปะต precoding ัะฐะทะฑะธะฒะฐัััั ะฝะฐ ะณััะฟะฟั ะฟะพ 4: $$ \zeta^{(p)}(i) = \langle y^{(p)}(4i),y^{(p)}(4i+1),y^{(p)}(4i+2),y^{(p)}(4i+3) \rangle $$

  4.2. ะะฐัะตะผ, ัะปะตะดัั ัะฟะตัะธัะธะบะฐัะธะธ, ะผะฐััะธะฒ ะณััะฟะฟ ัะตัััะตั ัะปะตะผะตะฝัะพะฒ ะฟัะตะพะฑัะฐะทัะตััั  ัะพะณะปะฐัะฝะพ 36.121 5.1.4.2.1, Sub-block interleaver. ะะฐะทะฑะตัะตะผ ััะพั ะฟัะพัะตัั:
:::margin{ml=56}
   4.2.1. ะะฐ ะฒัะพะด sub-block interleaver ะฟะพะดะฐัััั ะผะฐััะธะฒ ัะปะตะผะตะฝัะพะฒ: $$ d^{(i)}_0, d^{(i)}_2, \dots, d^{(i)}_{D-1} $$, ะณะดะต $$ D $$ - ะบะพะป-ะฒะพ ัะปะตะผะตะฝัะพะฒ

   4.2.2. ะัะธ ััะพะผ, ะตัะปะธ ะบะพะปะธัะตััะฒะพ ัะปะตะผะตะฝัะพะฒ ะฝะต ะบัะฐัะฝะพ 32, ัะพ ะฒ ะฝะฐัะฐะปะพ ะผะฐััะธะฒะฐ ะดะพะฑะฐะฒะปัะตััั $$ R^{CC}_{subblock} * C^{CC}_{subblock} - D $$ ัะปะตะผะตะฝัะพะฒ NULL, ะบะพัะพััะต ะฟะพ ัะฟะตัะธัะธะบะฐัะธะธ ัะฐะฒะฝั -1.

   4.2.3. ะกะพััะฐะฒะปัะตััั ะผะฐััะธัะฐ ั ะบะพะปะธัะตััะฒะพะผ ััะพะปะฑัะพะฒ $$ C^{CC}_{subblock} = 32 $$ ะธ ะบะพะปะธัะตััะฒะพะผ ัััะพะบ $$ R^{CC}_{subblock} = \lceil D / C^{CC}_{subblock} \rceil $$ ะธ ะฒ ะฝะตั ะทะฐะฟะธััะฒะฐัััั ะทะฝะฐัะตะฝะธั ะธะท ะฟะพะปััะตะฝะฝะพะณะพ ะผะฐััะธะฒะฐ, ะทะฐะฟะพะปะฝะตะฝะธะต ะฝะฐัะธะฝะฐะตััั ัะพ ัััะพะบ. ะข.ะต ะฒ ัะตะทัะปััะฐัะต ะฟัะตะดัะดััะธั ััะฐะฟะพะฒ ั ะฝะฐั ะตััั ะผะฐััะธะฒ $$ y $$, ะบะพะป-ะฒะพ ัะปะตะผะตะฝัะพะฒ ะบะพัะพัะพะณะพ ะบัะฐัะฝะพ 32 ะธ ะตะณะพ ัะตะฟะตัั ะผั ะฟัะตะพะฑัะฐะทะพะฒัะฒะฐะตะผ ะฒ ะผะฐััะธัั ัะพ ััะพัะพะฝะฐะผะธ $$ R^{CC}_{subblock} $$ ะธ $$ C^{CC}_{subblock} $$

   4.2.4. ะะฐัะตะผ ะฟัะพะธะทะฒะพะดะธััั ะพะฟะตัะฐัะธั ะธะทะผะตะฝะตะฝะธั ะฟะพััะดะบะฐ ััะพะปะฑัะพะฒ ะฒ ัะพะพัะฒะตััะฒะธะธ ัะพ ัะปะตะดัััะธะผ ะฟะฐััะตัะฝะพะผ: `1, 17, 9, 25, 5, 21, 13, 29, 3, 19, 11, 27, 7, 23, 15, 31,
0, 16, 8, 24, 4, 20, 12, 28, 2, 18, 10, 26, 6, 22, 14, 30` (ัะฐะฑะปะธัะฐ 36.212 5.1.4-2). ะญัะพ ะทะฝะฐัะธั, ััะพ ะฒ 0-ะผ ััะพะปะฑัะต ะฑัะดะตั ะฝะฐัะพะดะธััั 1-ะน ััะพะปะฑะตั, ะฒ 1-ะผ - 17-ะน, ะฒะพ 2-ะผ - 9-ะน, ะธ ั.ะด.

   4.2.5. ะะพัะปะต ะธะทะผะตะฝะตะฝะธั ะฟะพััะดะบะฐ ะฒัะต ัะปะตะผะตะฝัั ะผะฐััะธัั ัะพะฑะธัะฐัััั ะฒ ะพะดะฝะพะผะตัะฝัะน ะผะฐััะธะฒ ะฟะพ ััะพะปะฑัะฐะผ (ั.ะต ัะฝะฐัะฐะปะฐ ัะปะตะผะตะฝั 0 ััะดะฐ 0 ััะพะปะฑัะฐ, ะฟะพัะพะผ 1 ััะดะฐ 0 ััะพะปะฑัะฐ, ะฟะพัะพะผ 2 ััะดะฐ 0 ััะพะปะฑัะฐ ะธ ัะฐะบ ะดะพ $$ R^{cc}_{subblock} $$ ััะดะฐ 0 ััะพะปะฑัะฐ, ะธ ั.ะด)

   ะะฟะธัะฐะฝะธะต ัะตะบััะพะผ ะดะพะฒะพะปัะฝะพ ัะปะพะถะฝะพ ะฟะพะฝััั, ะฟะพััะพะผั ั ะฝะฐะฟะธัะฐะป ัะตะฐะปะธะทะฐัะธั ะฒ ะบะพะดะต:
```python
import numpy as np

PERMUTATION_PATTERN = [1, 17, 9, 25, 5, 21, 13, 29, 3, 19, 11, 27, 7, 23, 15, 31,
                       0, 16, 8, 24, 4, 20, 12, 28, 2, 18, 10, 26, 6, 22, 14, 30]

def interleave(elements: list):
    D = len(elements)
    C_cc_subblock = 32
    R_cc_subblock = (D // C_cc_subblock) + 1
    dummy_bits = R_cc_subblock * C_cc_subblock - D

    y = [-1] * dummy_bits + elements
    y = np.array(y).reshape(R_cc_subblock, C_cc_subblock)

    result = np.zeros((R_cc_subblock, C_cc_subblock), dtype=int)
    
    for row in range(R_cc_subblock):
        for col in range(C_cc_subblock):
            result[row, col] = y[row, PERMUTATION_PATTERN[col]]

    return result.flatten(order="F").tolist()

if __name__ == "__main__":
    print(interleave([1, 2, 3, 4, 5, 6, 7, 8, 9] * 9))
```
  4.3. ะะฐัะตะผ ะฒัะต ัะปะตะผะตะฝัั NULL ัะดะฐะปััััั ะธะท ะฟะพะปััะตะฝะฝะพะณะพ ะฟะพัะปะต sub-block interleaver ะผะฐััะธะฒะฐ
  4.4. ะะพัะปะต ััะพะณะพ ะบะฐะถะดัะน ัะปะตะผะตะฝั ะผะฐััะธะฒะฐ ัะธะบะปะธัะตัะบะธ ัะดะฒะธะณะฐะตััั ะฝะฐ $$ N^{cell}_{ID} $$ ัะปะตะผะตะฝัะพะฒ:
```python
def cyclic_shift(elements: list, cell_id: int):
    result = [0] * len(elements)
    for i in range(len(elements)):
        result[i] = elements[(i + cell_id) % len(elements)]
    return result
```
:::

  ะะฐัะตะผะฐัะธัะตัะบะธ ััั ะพะฟะตัะฐัะธั ะผะพะถะฝะพ ะฒััะฐะทะธัั ัะฐะบ: $$ \bar{w}^{(p)}(i) = w^{(p)}((i + N^{cell}_{ID}) \mod M_{quad}) $$, ะณะดะต $$ w $$ - ัะตะทัะปััะฐั sub-block interleaver.

:::margin{ml=28}
  4.5. ะะฐัะตะผ ะผะฐััะธะฒ $$ \bar{w} $$ ัะฐะทะผะตัะฐะตััั ะฒ Resource Grid ะฟะพ REG ะฟะพ ัะปะตะดัััะตะผั ะฐะปะณะพัะธัะผั:
:::

:::margin{ml=30}
   4.5.1. ะะฝะธัะธะฐะปะธะทะธััะตััั m' = 0 (ะฝะพะผะตั REG), k' = 0 
:::
:::margin{ml=42}
4.5.2. ะะฝะธัะธะฐะปะธะทะธััะตััั l' = 0 
:::
:::margin{ml=54}
4.5.3. ะัะปะธ REG (k', l') ะฝะต ะฝะฐะทะฝะฐัะตะฝ PCFICH ะธะปะธ PHICH, ัะพ ะฒัะฟะพะปะฝัะตััั ัะฐะณ 4.5.4, ะธะฝะฐัะต ะฒัะฟะพะปะฝัะตััั ัะฐะณ 4.5.6
:::
:::margin{ml=66}
4.5.4. ะััะฟะฟะฐ 4-ั ัะปะตะผะตะฝัะพะฒ $$ \bar{w}^{(p)}(m') $$ ะฝะฐะทะฝะฐัะฐะตััั ะฝะฐ REG (k', l') ะดะปั ะบะฐะถะดะพะน ะฐะฝัะตะฝะฝั p (ะฒัะตั ะฐะฝัะตะฝะฝ ะฒ ัะตะทัะปััะฐัะต Precoding)

4.5.5. m' ัะฒะตะปะธัะธะฒะฐะตััั ะฝะฐ 1
:::
:::margin{ml=54}
4.5.6. l' ัะฒะตะปะธัะธะฒะฐะตััั ะฝะฐ 1

4.5.7. ะัะปะธ l' < L, ะณะดะต L - ะบะพะป-ะฒะพ OFDM ัะธะผะฒะพะปะพะฒ ะดะปั PDCCH, ั.ะต ะทะฝะฐัะตะฝะธะต CFI, ะฟะตัะตะดะฐะฝะฝะพะต ะฟะพ PCFICH, ัะพ ะฝะฐะดะพ ะฟะพะฒัะพัะธัั ะฒัะต ะดะตะนััะฒะธั, ะฝะฐัะธะฝะฐั ั ัะฐะณะฐ 4.5.3

4.5.8. k' ัะฒะตะปะธัะธะฒะฐะตััั ะฝะฐ 1

4.5.9. ะัะปะธ k' < $$ N^{DL}_{RB} \cdot N^{RB}_{sc} $$, ัะพ ะธะดัะผ ะพะฑัะฐัะฝะพ ะฝะฐ ัะฐะณ 4.5.2.
:::

ะฏ ัะตะฐะปะธะทะพะฒะฐะป ะฒัั ััั ััะตะผั ะฒ ะบะพะดะต, ะฒะพั:
```python
import numpy as np
from channel_coding.sub_block_interleaver import interleave
from channels.symbol import ReferenceSignal, PDCCH, Reserved
import modulation, scrambling

NIL = (0, 0, 0, 0)

def cyclic_shift(elements: list, cell_id: int):
    result = [0] * len(elements)
    for i in range(len(elements)):
        result[i] = elements[(i + cell_id) % len(elements)]
    return result

def is_reg_complete(resource_grid: np.ndarray, k_start: int, l: int) -> bool:
    available = 0
    k = k_start
    while k < resource_grid.shape[0] and available < 4:
        if not isinstance(resource_grid[k, l], ReferenceSignal):
            available += 1
        k += 1
    return available == 4

def map_reg(resource_grid: np.ndarray, elements: list, k_start: int, l: int):
    i = 0
    k = k_start
    while i < 4 and k < resource_grid.shape[0]:
        if not isinstance(resource_grid[k, l], ReferenceSignal):
            resource_grid[k, l] = elements[i]
            i += 1
        k += 1

def map_quadruplets(resource_grid: np.ndarray, quadruplets: list, N_DL_RB: int, N_RB_sc: int, PDCCH_OFDM_symbols: int):
    m = 0
    k = 0
    while True:
        l = 0
        while True:
            can_be_assigned = k % 4 == 0 and is_reg_complete(resource_grid, k, l)
            if can_be_assigned:
                map_reg(resource_grid, list(quadruplets[m]), k, l)
                m += 1
            l += 1
            if l >= PDCCH_OFDM_symbols:
                break
        k += 1
        if k >= N_DL_RB * N_RB_sc:
            break

if __name__ == "__main__":    
    N_DL_RB = 15
    N_RB_sc = 12
    RE_in_frame = 140
    n_s = 0
    N_cell_id = 133
    PDCCH_OFDM_symbols = 1
    resource_grid = np.zeros((N_DL_RB * N_RB_sc, RE_in_frame), dtype=object)
    bits = list(np.random.binomial(1, 0.5, size=(72)))
    c_init = int(np.floor(n_s / 2)) * (2 ** 9) + N_cell_id

    required_bits = 2 * PDCCH_OFDM_symbols * N_DL_RB * N_RB_sc
    append_bits = required_bits - len(bits)
    for _ in range(append_bits // len(NIL)):
        bits.extend(NIL)

    scrambled_bits = scrambling.scramble(bits, c_init)
    modulated_symbols = modulation.modulate_bits(scrambled_bits, mu=2)
    precoded = modulated_symbols
    quadruplets = precoded.reshape((len(precoded) // 4, 4))
    interleaved = [symb for symb in interleave(list(quadruplets)) if not (symb is None)]
    shifted = [
        [PDCCH(v) for v in q]
        for q in cyclic_shift(interleaved, N_cell_id)
    ]

    for k in range(N_DL_RB * N_RB_sc):
        prb_sc = k % N_RB_sc
        if prb_sc == 5 or prb_sc == 11:
            resource_grid[k, 0] = ReferenceSignal(0)

    map_quadruplets(resource_grid, shifted, N_DL_RB, N_RB_sc, PDCCH_OFDM_symbols)
    for row in resource_grid:
        print(row[0])

```

 ะ ะพะฟััั, ัะดะตะปะฐะป ะธะปะปััััะฐัะธั, ะณะดะต ัะพะฑัะฐะป ะฒัะต ัะพัะผัะปั ะฒะพะตะดะธะฝะพ: (PHY PDCCH) https://imgur.com/a/ptgfM4Z

##### 1.1.5.11. Physical HARQ Indicator Channel (36.211 6.9)

PHICH - ะบะฐะฝะฐะป ะฟะพ ะบะพัะพัะพะผั ะฟะตัะตะดะฐัััั hybrid-ARQ ACK/NACK. HARQ - ััะพ ะฟัะพัะตัั, ะฟัะธ ะบะพัะพัะพะผ ะฑะฐะทะพะฒะฐั ััะฐะฝัะธั ะฟัะธะฝะธะผะฐั ะดะฐะฝะฝัะต ะพัะฒะตัะฐะตั ััััะพะนััะฒั ะดะฒัะผั ะฒะพะทะผะพะถะฝัะผะธ ะพัะฒะตัะฐะผะธ: ACK ะธ NACK. ACK ะพะทะฝะฐัะฐะตั, ััะพ ะดะฐะฝะฝัะต ะฑัะปะธ ะฟัะธะฝััั ััะฟะตัะฝะพ, ะฐ NACK - ััะพ ะฝะตะพะฑัะพะดะธะผะฐ ะฟะตัะตะพัะฟัะฐะฒะบะฐ. ะะฟัะพัะตะผ ะฟัะพ LTE ะฟัะพัะตะดััั ะผั ะฑัะดะตะผ ะณะพะฒะพัะธัั ะพัะดะตะปัะฝะพ, ัะตะนัะฐั ัะพะปัะบะพ ัะธะทะธัะตัะบะฐั ัะพััะฐะฒะปัััะฐั ะบะฐะฝะฐะปะฐ.

ะฃ ััะพะณะพ ะบะฐะฝะฐะปะฐ ะตััั ัะฒะพั ะพัะพะฑะตะฝะฝะพััั. ะะตัะบะพะปัะบะธะผ ะฟะพัะพะบะฐะผ PHICH ะผะพะณัั ะฑััั ะฝะฐะทะฝะฐัะตะฝั ะพะดะธะฝะฐะบะพะฒัะต RE. ะขัั ะผะพะถะฝะพ ะทะฐะดะฐัั ะฒะพะฟัะพั: "ะฐ ะบะฐะบ ัะพะณะดะฐ ัะธะณะฝะฐะป ะฒะพะพะฑัะต ะผะพะถะฝะพ ะดะตะบะพะดะธัะพะฒะฐัั?". ะะฐ ััะพ ะตััั ะพัะฒะตั: ะบะฐะถะดะพะผั PHICH ะฝะฐะทะฝะฐัะฐะตััั ัะฒะพะน ะพััะพะณะพะฝะฐะปัะฝัะน ะบะพะด. ะัะพ ะทะฝะฐะบะพะผ ั, ะฝะฐะฟัะธะผะตั WCDMA ะธะปะธ CDMA, ัะพั ะฟะพะฝะธะผะฐะตั ะพ ัะตะผ ัะตัั. ะ ะฝะธั ัะพะถะต ะธัะฟะพะปัะทะพะฒะฐะปะธัั ะพััะพะณะพะฝะฐะปัะฝัะต ะบะพะดั ะดะปั ะฟะตัะตะดะฐัะธ ัะฐะทะฝัั ะดะฐะฝะฝัั ะฝะฐ ะพะดะธะฝะฐะบะพะฒะพะน ัะฐััะพัะต ะฒ ะพะดะฝะพ ะธ ัะพ ะถะต ะฒัะตะผั. 
ะะดะตั ะฟัะพััะฐ: ะฟัะธะดัะผะฐัั ัะฐะบะธะต ะฟะพัะปะตะดะพะฒะฐัะตะปัะฝะพััะธ ะทะฝะฐัะตะฝะธะน, ะบะพัะพััะต ะตัะปะธ ะผั ะฑัะดะตะผ ะฟัะธะผะตะฝััั ะบ ะพะดะฝะพะผั ะธ ัะพะผั ะถะต ัะธะณะฝะฐะปั, ัะพ ะฑัะดะตะผ ะฟะพะปััะฐัั ัะฐะทะฝัะต ะฒะฐะปะธะดะฝัะต ะดะฐะฝะฝัะต. ะกะตะนัะฐั ััะพ ะธ ัะฐััะผะพััะธะผ.

ะกะพะพัะฒะตััะฒะตะฝะฝะพ ะบะฐะฝะฐะป PHICH, ัะฐะบ ะบะฐะบ ะผะพะถะตั ะพัะฟัะฐะฒะปััััั ะฝะฐ ะพะดะฝะธั ะธ ัะตั ะถะต RE, ะพะฟัะตะดะตะปัะตััั ะดะฒัะผั ะฟะฐัะฐะผะตััะฐะผะธ: $$ n^{group}_{PHICH} $$ ะธ $$ n^{seq}_{PHICH} $$. ะขัั $$ n^{group}_{PHICH} $$ - ะฝะพะผะตั ะณััะฟะฟั PHICH ะธ $$ n^{seq}_{PHICH} $$ - ะฝะพะผะตั ะพััะพะณะพะฝะฐะปัะฝะพะณะพ ะบะพะดะฐ. ะััะฟะฟะฐ PHICH - ััะพ ะบะฐะบ ัะฐะท ะฝะฐะฑะพั ะฟะพัะพะบะพะฒ PHICH, ะบะพัะพััะผ ะฝะฐะทะฝะฐัะตะฝ ะพะดะธะฝ ะธ ัะพั ะถะต ะฝะฐะฑะพั RE.

UE ะทะฝะฐะตั ัะบะพะปัะบะพ ะฟะพะฟััะพะบ ะดะตะบะพะดะธัะพะฒะฐะฝะธั ะพัััะตััะฒะปััั ะฑะปะฐะณะพะดะฐัั ะฟะฐัะฐะผะตััั $$ N^{group}_{PHICH} $$, ะบะพัะพััะน ัะบะฐะทัะฒะฐะตั ะฝะฐ ะบะพะปะธัะตััะฒะพ PHICH ะณััะฟะฟ ะฒ ะบะฐะถะดะพะผ subframe. ะััะธัะปัะตััั ะพะฝ ัะฐะบ: 
$$
N^{group}_{PHICH} = \begin{cases} 
 \lceil N_g (N^{DL}_{RB} / 8) \rceil, \text{ ะดะปั Normal Cyclic Prefix} \\ 
 2 \cdot \lceil N_g (N^{DL}_{RB} / 8) \rceil, \text{ ะดะปั Extended Cyclic Prefix} \\ 
\end{cases}
$$
ะณะดะต $$ N_g $$ ะธะดัั ะธะท MIB, ะฟะพะปะต `phich-Config.phich-Resource`.

ะขะตะฟะตัั ัะฐััะผะพััะธะผ ัะฐะผั ะฟัะพัะตะดััั ะณะตะฝะตัะฐัะธะธ. ะะพะถะตัะต ััะฐะทั ัะผะพััะตัั ะฝะฐ ะธะปะปััััะฐัะธั (PHY PHICH) https://imgur.com/a/ptgfM4Z, ัะฐะผ ัะบะฐะทะฐะฝั ะฒัะต ัะพัะผัะปั ะธ ัะฐะฑะปะธัั:

 1. Modulation - ะธัะฟะพะปัะทัะตััั ัะพะปัะบะพ BPSK (ั.ะต ะพะดะธะฝ ะฑะธั ะฝะฐ ะพะดะธะฝ ัะธะผะฒะพะป, 2-QAM). ะะพัะปะต ะผะพะดัะปััะธะธ ะผั ะฟะพะปััะฐะตะผ ะฝะฐะฑะพั ัะธะผะฒะพะปะพะฒ $$ \zeta(0),\dots,\zeta(M_s - 1) $$, ะณะดะต $$ M_s = M_bit$$, ั.ะต ะบะพะป-ะฒะพ ะพัะฟัะฐะฒะปัะตะผัั ะฝะฐ PHICH ะฑะธั.
 2. Orthogonal Code Multiplexing - ะบ ะฝะฐะฑะพัั ัะผะพะดัะปะธัะพะฒะฐะฝะฝัั ัะธะผะฒะพะปะพะฒ $$ \zeta $$ ะฟัะธะผะตะฝัะตััั ะพะดะธะฝ ะธะท ะพััะพะณะพะฝะฐะปัะฝัั ะบะพะดะพะฒ ะฟะพ ัะพัะผัะปะต $$ d(i) = w(i \mod N^{PHICH}_{SF}) \cdot (1-2\times c(i)) \cdot \zeta(\lfloor i/N^{PHICH}_{SF} \rfloor)`, ะณะดะต `i = 0,\dots,M_{symb}-1 $$, $$ M_{symb} = N^{PHICH}_{SF} \cdot M_s $$, ะฐ $$ N^{PHICH}_{SF} = 4 $$ ะฟัะธ ะธัะฟะพะปัะทะพะฒะฐะฝะธะธ normal cyclic prefix ะธ $$ 2 $$ ะฟัะธ extended cyclic prefix. ะขัั $$ M_{symb} $$ - ะบะพะป-ะฒะพ ัะผะพะดัะปะธัะพะฒะฐะฝะฝัั ัะธะผะฒะพะปะพะฒ, ะฐ $$ c(i) $$ - Scrambling Sequence ัะพ ัะฒะพะธะผ ะทะฐะดะฐะฝะฝัะผ $$ c_{init} $$: $$ c_{init} = (\lfloor n_s /2 \rfloor +1) \cdot (2N^{cell}_{ID} + 1) \cdot 2^9 + N^{cell}_{ID} $$.
   ะัะธ ััะพะผ ะฒ ัะพัะผัะปะต ะผะพะถะฝะพ ะฑัะปะพ ะทะฐะผะตัะธัั ะผะฐััะธะฒ $$ w $$ - ััะพ ะบะฐะบ ัะฐะท ัะฐะบะธ ะธ ะตััั ะพััะพะณะพะฝะฐะปัะฝัะน ะบะพะด. ะะฝ ะพะฟัะตะดะตะปัะฝ ะฒ ัะฐะฑะปะธัะต 36.211 6.9.1-2. ะัะฑะพั $$ n^{sec}_{PHICH} $$ ะดะตะปะฐะตััั ัะฐะบ, ััะพะฑั ะพะฝ ะฝะต ัะพะฒะฟะฐะดะฐะป ั ัะถะต ะฒัะฑัะฐะฝะฝัะผะธ ะทะฝะฐัะตะฝะธัะผะธ ััะพะน ะฟะตัะตะผะตะฝะฝะพะน.
 3. Resource group alignment - ัะฝะธะบะฐะปัะฝัะน ะดะปั ััะพะณะพ ะบะฐะฝะฐะปะฐ ััะฐะฟ ะฟะตัะตะด layer mapping ะธ precoding. ะ ะฝะตะผ ัะปะตะผะตะฝัั ะผะฐััะธะฒะฐ "d" ะฟัะตะพะฑัะฐะทััััั ััะพะฑั ัะพะฒะฟะฐะดะฐัั ั ัะฐะทะผะตัะพะผ REG. ะัะธ ััะพะผ ะฟัะธ ะธัะฟะพะปัะทะพะฒะฐะฝะธะธ normal cyclic prefix ะผะฐััะธะฒ "d" ะพััะฐัััั ะฝะตะธะทะผะตะฝะฝัะผ, ะฐ ะฟัะธ ะธัะฟะพะปัะทะพะฒะฐะฝะธะธ extended cyclic prefix ะพะฝ ะฟะพะดะฒะตัะณะฐะตััั ะธะทะผะตะฝะตะฝะธัะผ ะฒ ัะพะพัะฒะตััะฒะธะธ ัะพ ัะปะตะดัััะตะน ัะพัะผัะปะพะน: 
$$
\begin{bmatrix} 
  d^{(0)}(4i) \\
  d^{(0)}(4i + 1) \\
  d^{(0)}(4i + 2) \\
  d^{(0)}(4i + 3) 
\end{bmatrix} = \begin{cases}
  \begin{bmatrix}
    d(2i) \\
    d(2i + 1) \\
    0 \\ 
    0
  \end{bmatrix} \text{ ะตัะปะธ } n^{group}_{PHICH} \mod 2 = 0 \\
   \begin{bmatrix}
    0 \\ 
    0 \\
    d(2i) \\
    d(2i + 1) 
  \end{bmatrix} \text{ ะตัะปะธ } n^{group}_{PHICH} \mod 2 = 1
\end{cases}
$$

  4. Layer Mapping ะธ Precoding - ะพัััะตััะฒะปัะตััั ัะฐะบะถะต, ะบะฐะบ ะธ ะฒ PBCH. ะะทะผะตะฝะตะฝะธะต ะตััั ัะพะปัะบะพ ะดะปั Diversity ะฟัะธ $$ P = 4 $$, ะฝะพ ัะฐะผ ะฟัะพััะพ ะฝะตะผะฝะพะณะพ ะธะทะผะตะฝะธะปะฐัั Precoding ะผะฐััะธัะฐ, ะฝะธัะตะณะพ ะพัะพะฑะตะฝะฝะพะณะพ.
  5. Mapping to resource elements - ะดะปั ะฝะฐัะฐะปะฐ ะฒัะต ัะธะผะฒะพะปั ั ะบะฐะถะดะพะณะพ ะฟะพัะพะบะฐ ะดะปั ะฐะฝัะตะฝะฝั ััะผะผะธัััััั. ะญัะพ ะฝัะถะฝะพ ะดะปั ะฟัะธะผะตะฝะตะฝะธั ะพััะพะณะพะฝะฐะปัะฝัั ะบะพะดะพะฒ: $$ \bar{y}^{(p)}(n) = \sum{y^{(p)}_i(n)} $$.
:::margin{ml=28}
   ะะฐัะฟัะตะดะตะปะตะฝะธะต PHICH ัะธะผะฒะพะปะพะฒ ะพัััะตััะฒะปัะตััั ะฟะพ Mapping Unit'ะฐะผ. ะะปั ะบะฐะถะดะพะน PHICH ะณััะฟะฟั ัะพะทะดะฐัััั ัะฒะพะน mapping unit. ะ ัะปััะฐะต extended CP, mapping unit ะฑัะดะตั ัะฒะปััััั ััะผะผะพะน ะดะฒัั ัะปะตะผะตะฝัะพะฒ $$ \hat{y} $$, ั.ะต ััะผะผะพะน $$ \hat{y}^{(p)}_m(n) + \hat{y}^{(p)}_{m+1}(n) $$. ะขัั ะทะฐ $$ \hat{y}^{(p)}_m(n) $$ ะพะฑะพะทะฝะฐัะตะฝะฐ PHICH ะณััะฟะฟะฐ "m" ะฝะฐ ะฐะฝัะตะฝะฝะต "p".

   ะะฐะปะตะต ะฟัะพะธััะพะดะธั ัะถะต ะธะทะฒะตััะฝะฐั ะฝะฐะผ ะฟัะพัะตะดััะฐ ัะฐะทะดะตะปะตะฝะธั ัะปะตะผะตะฝัะพะฒ ะฝะฐ ะณััะฟะฟั ะฟะพ 4: $$ \zeta^{(p)}(i) = \langle \tilde{y}^{(p)}(4i),\tilde{y}^{(p)}(4i+1),\tilde{y}^{(p)}(4i+2),\tilde{y}^{(p)}(4i+3) \rangle $$

   ะัะธ ััะพะผ ััะธ ะณััะฟะฟั 4-ั ัะปะตะผะตะฝัะพะฒ ัะฐะบะถะต ะพะฑะปะฐะดะฐัั ะตัั ะพะดะฝะธะผ ะฟะฐัะฐะผะตััะพะผ - PHICH mapping unit'ะพะผ, ั.ะต ะฝะพะผะตัะพะผ ะณััะฟะฟั.

   ะะพัะปะต ััะพะณะพ ะฒัะฟะพะปะฝัะตััั ัะปะตะดัััะธะน ะฐะปะณะพัะธัะผ:
:::

:::margin{ml=40}
5.1. ะะปั ะบะฐะถะดะพะณะพ ะทะฝะฐัะตะฝะธั l' (ััะพ ะบะพะป-ะฒะพ OFDM ัะธะผะฒะพะปะพะฒ ะฒ subframe)
:::
:::margin{ml=52}
5.2. ะัััั n_l - ะบะพะป-ะฒะพ REG, ะฝะต ะฒัะดะตะปะตะฝะฝัั ะดะปั PCFICH ะฒ OFDM ัะธะผะฒะพะปะต l'

5.3. ะัะพะฝัะผะตัะพะฒะฐัั REG, ะฝะต ะฒัะดะตะปะตะฝะฝัะต ะดะปั PCFICH ะฒ OFDM ัะธะผะฒะพะปะต l' ะพั 0 ะดะพ n_l - 1, ะฝะฐัะธะฝะฐั ะพั REG ั ะฝะฐะธะผะตะฝััะตะน ัะฐััะพัะพะน (ั.ะต ัะฝะธะทั RG)
:::
:::margin{ml=40}
5.4. m' = 0 (PHICH mapping unit)

5.5. ะะปั ะบะฐะถะดะพะณะพ ะทะฝะฐัะตะฝะธั i=0,1,2:
:::
:::margin{ml=52}
5.6. l' = 0 ะดะปั ะบะฐะถะดะพะณะพ subframe

5.7. ะะฟัะตะดะตะปะธัั ะฝะพะผะตั REG ะฟะพ ัะปะตะดัััะตะน ัะพัะผัะปะต:

$$
\bar{n}_i = \begin{cases} 
  (\lfloor N^{cell}_{ID} \cdot n_{l_i'}/n_1 \rfloor + m') \mod n_{l_i'} & i=0 \\
  (\lfloor N^{cell}_{ID} \cdot n_{l_i'}/n_1 \rfloor + m' +\lfloor n_{l_i'} /3 \rfloor) \mod n_{l_i'} & i=1 \\
  (\lfloor N^{cell}_{ID} \cdot n_{l_i'}/n_1 \rfloor + m' +\lfloor 2n_{l_i'} /3 \rfloor) \mod n_{l_i'} & i=2 \\
\end{cases}
$$

5.8. ะะพ ะฝะพะผะตัั REG ะพะฟัะตะดะตะปะธัั ัะฐััะพัั REG ะธ ะฝะฐะทะฝะฐัะธัั ะณััะฟะฟั ะธะท 4 ัะธะผะฒะพะปะพะฒ ะบ ะฝะฐะนะดะตะฝะฝะพะผั REG ั (k', l')
:::
:::margin{ml=40}
5.9. m += 1

5.10. ะะพะฒัะพัะธัั ั ััะฐะฟะฐ 5.5 ะฟะพะบะฐ ะฒัะตะผ PHICH mapping unit'ะฐะผ ะฝะต ะฑัะดัั ะฝะฐะทะฝะฐัะตะฝั REG.
:::

----------------

ะะพั ะผั ะธ ัะฐะทะพะฑัะฐะปะธัั ัะพ ะฒัะตะผะธ ัะธะทะธัะตัะบะธะผะธ ะบะฐะฝะฐะปะฐะผะธ. ะ ัะปะตะดัััะตะผ ะฟะพััั ัะพะฑะตัะตะผ ะฒัะต ััะธ ะบะฐะฝะฐะปั ะฒะพะตะดะธะฝะพ ะฒ ะบะพะดะต, ัะฐะบะถะต ัะฐััะผะพััะธะผ Uplink ะบะฐะฝะฐะปั (ัะฐะผ ะฒัั ะฝะตะผะฝะพะณะพ ะฟัะพัะต) ะธ ะทะฐัะตะผ ะฟะตัะตะนะดะตะผ ะบ ะฒะตะปะธะบะธะผ ะธ ัะถะฐัะฝัะผ ัะธะณะฝะฐะปะฐะผ (ะฝะต ะฒัะต ัะฐะผ ัะฐะบ ัะถะฐัะฝะพ, ัะพัะฝะพ ะฝะต ัะปะพะถะฝะตะต ัะตะผ ะบะฐะฝะฐะปั, ะฐ ะบะฐะฝะฐะปั ะฝะต ัะฐะบะธะต ัะถ ะธ ัะปะพะถะฝัะต ะฒ ัะตะปะพะผ)

---------------------------------------------------------------------------------
:::margin{variant=note}
ะะฐะผะตัะบะธ ะดะปั ัะตะฑั: 
  1. ะะพัะพะผ ัะฟะพะผัะฝััั ะฟัะพ MUST interference presence and power ration, 6.3.3. Layer Mapping ะฑัะดะตั ะพัััะตััะฒะปััััั ะฟะพ-ะดััะณะพะผั
  2. ะะพะณะดะฐ ะฑัะดะตะผ ะณะพะฒะพัะธัั ะฟัะพ Rate Matching PBCH, ะฝะฐะดะพ ะฑัะดะตั ะพะฑัะฐัะธัั ะฒะฝะธะผะฐะฝะธะต ะฝะฐ ะบะพะป-ะฒะพ ะฑะธั. ะะฝะพ ะฑัะดะตั ัะฐะฒะฝะพ 240. ะะดะฝะฐะบะพ ะฒ Scrambling ะพะฝะพ ัะบะฐะทะฐะฝะพ ะบะฐะบ 1920. ะญัะพ ะธะท-ะทะฐ ัะพะณะพ, ััะพ ะฒ ะทะฝะฐัะตะฝะธะต 1920 ะฒัะพะดัั ะฒัะต 4 ะฟะตัะตะดะฐัะธ (PBCH ะฟะพะฒัะพััะตััั 4 ัะฐะทะฐ, ะบะฐะถะดัะน ัะฐะท ะฟะพ 240 ะฑะธั). ะ ะธะท-ะทะฐ ัะพะณะพ, ััะพ PBCH ะธัะฟะพะปัะทัะตั QPSK, ั.ะต ะฝะฐ ะบะฐะถะดัะน RE ะฟัะธัะพะดะธััั ะดะฒะฐ ะฑะธัะฐ, ัะพ ะธ ะฟะพะปััะฐะตััั `240 * 4 * 2 = 1920`
  3. ะ ััะฐะฟะต 4.5.7. PDCCH Resource Mapping ะตััั ะธัะบะปััะตะฝะธั ะดะปั MBSFN, ัะผ. 36.211 6.8.5
  4. EPDCCH
  5. BL/CE UEs
  6. MPDCCH
  7. SPDCCH
:::
---------------------------------------------------------------------------------
---------------------------------------------------------------------------------

#### 1.1.6. Physical Uplink Channels

(ะ ะฟัะพัะปัะน ัะฐะท ะผั ัะฐะทะพะฑัะฐะปะธัั ัะพ ะฒัะตะผะธ ัะธะทะธัะตัะบะธะผะธ Downlink ะบะฐะฝะฐะปะฐะผะธ LTE. ะกะตะณะพะดะฝั ะผั ะฟัะพะดะพะปะถะฐะตะผ ะบะพะฟะฐัััั ะฒ ัะธะทะธัะตัะบะพะผ ััะพะฒะฝะต, ะฝะพ ะฝะฐ ััะพั ัะฐะท ะฑัะดะตะผ ัะถะต ัะผะพััะตัั ะฝะฐ Uplink ะบะฐะฝะฐะปั ัะฒัะทะธ, ั.ะต ะฝะฐ ัะต, ะบะพัะพััะต ะธัะฟะพะปัะทัะตั ััััะพะนััะฒะพ ะดะปั ะพัะฟัะฐะฒะบะธ ะดะฐะฝะฝัั ะฝะฐ ะฒััะบั)

ะะปั ะฝะฐัะฐะปะฐ ะดะฐะฒะฐะนัะต ัะฐะทะฑะตัะตะผัั ั ัะตะผ, ะบะฐะบ ะฒัะณะปัะดะธั Frame Structure ะดะปั Uplink. ะกะฝะฐัะฐะปะฐ ะปัััะต ะฒะทะณะปัะฝััั ะฝะฐ ะธะปะปััััะฐัะธั: (PHY Uplink Frame Structure) https://imgur.com/a/ptgfM4Z. 

ะะฐ ะฝะตะน ัะพัะพัะพ ะฒะธะดะฝะพ ัะฐะทะปะธัะธั ะผะตะถะดั Uplink Frame Structure ะธ Downlink Frame Structure: ะฒ ัะปััะฐะต downlink ะบะฐะถะดัะน ะบะฐะฝะฐะป ัะฐัััะฝัั ะฑะพะปััะต ะฟะพ ัะฐััะพัะต, ะฐ ะฒ ัะปััะฐะต uplink ะบะฐะฝะฐะปั ะฑะพะปะตะต ะปะพะบะฐะปะธะทะพะฒะฐะฝั. ะะฐะฟัะธะผะตั, PUCCH: ะพะฝ ะฝะฐัะพะดะธััั ัะพะปัะบะพ ะฒ ะฝะธะถะฝะตะผ ะธ ะฒะตััะฝะตะผ ะบะพะฝัะฐั BW.

ะะฐะบ ะธ ะฒ ัะปััะฐะต ั downlink, ััั ะดะตะนััะฒััั ัะปะตะดัััะธะต ะฟัะฐะฒะธะปะฐ Frame Structure:
 1. ะ ะบะฐะถะดะพะผ Frame ะฝะฐัะพะดะธััั 9 subframe
 2. ะะธะฝะธะผะฐะปัะฝะฐั ะตะดะตะฝะธัะฐ ะฒััะฐะฝะธั - RE
 3. 12 subcarrier x 7 symbol (6 ะฟัะธ Extended CP) ะพัะณะฐะฝะธะทััั Resource Block
 4. Slot ัะพะดะตัะถะธั 7 ัะธะผะฒะพะปะพะฒ ะฟะพ ะฒัะตะผะตะฝะธ ะธ `N^{UL}_{RB} \times N^{RB}_{sc}` subcarrier'ะพะฒ.

ะขะตะฟะตัั ะดะฐะฒะฐะนัะต ัะฐะทะฑะธัะฐัััั ั ะบะฐะถะดัะผ Uplink ะบะฐะฝะฐะปะพะผ ะฟะพ ะพัะดะตะปัะฝะพััะธ.

##### 1.1.6.1. PUSCH - Physical Uplink Shared Channel

PUSCH - ะบะฐะฝะฐะป, ะฟะพ ะบะพัะพัะพะผั ะฟะตัะตะดะฐัััั ะดะฐะฝะฝัะต ะฟะพะปัะทะพะฒะฐัะตะปั, ะฐ ัะฐะบะถะต ACK/NACK ะดะปั ะฟัะธะฝัััั ั PDSCH ะดะฐะฝะฝัั. ะะตะฝะตัะฐัะธั ัะธะณะฝะฐะปะฐ ะดะปั ััะพะณะพ ะบะฐะฝะฐะปะฐ ะฟัะพะธะทะฒะพะดะธััั ัะปะตะดัััะธะผ ะพะฑัะฐะทะพะผ: (ะฝะฐ ะดะธะฐะณัะฐะผะผะต ะธะทะพะฑัะฐะถะตะฝั ััะฐะฟั ะณะตะฝะตัะฐัะธะธ)

```
codewords                                               
    โ         User Data                                 
    โโโโโโโโโโโโโโบโb[q](0),b[q](1),...,b[q](M[q](bit)-1)
                  โผ                                     
      โโโโโโโโโโโโโโโโโโโโโโโโโโ                        
      โ       Scrambling       โ                        
      โ      36.211 5.3.1      โ                        
      โโโโโโโโโโโโโฌโโโโโโโโโโโโโ                        
                  โB[q](0),...,B[q](M[q](bit)-1)        
                  โผ                                     
      โโโโโโโโโโโโโโโโโโโโโโโโโโ                        
      โ    Modulation Mapper   โ                        
      โ      36.211 5.3.2      โ                        
      โโโโโโโโโโโโโฌโโโโโโโโโโโโโ                        
                  โd[q](0),...,d[q](M[q](symb)-1)       
                  โผ                                     
      โโโโโโโโโโโโโโโโโโโโโโโโโโ                        
      โ      Layer Mapper      โ                        
      โ     36.211 6.3.2A      โ                        
      โโโโโโโโโโโโโฌโโโโโโโโโโโโโ                        
                  โ[x[0](i),...,x[a-1](i)]^T            
                  โผ                                     
      โโโโโโโโโโโโโโโโโโโโโโโโโโ                        
      โ   Transform Precoder   โ                        
      โ      36.211 5.3.3      โ                        
      โโโโโโโโโโโโโฌโโโโโโโโโโโโโ                        
                  โ[y[0](i),...,y[v-1](i)]^T            
                  โผ                                     
      โโโโโโโโโโโโโโโโโโโโโโโโโโ                        
      โ        Precoding       โ                        
      โ     36.211 5.3.3A      โ                        
      โโโโโโโโโโโโโฌโโโโโโโโโโโโโ                        
                  โ[z[0](i),...,z[P-1](i)]^T            
                  โ                                     
                  โผ                                     
      โโโโโโโโโโโโโโโโโโโโโโโโโโ                        
      โResource Element Mapper โ                        
      โ      36.211 5.3.4      โ                        
      โโโโโโโโโโโโโฌโโโโโโโโโโโโโ                        
                  โs[p](l)(t)                           
                  โผ                                     
      โโโโโโโโโโโโโโโโโโโโโโโโโโ                        
      โ   SC-FDMA Signal Gen.  โ                        
      โ      36.211 5.6        โ                        
      โโโโโโโโโโโโโโโโโโโโโโโโโโ                        
```

###### 1.1.6.1.1. PUSCH Scrambling

Scrambling ะฟัะธะฝะธะผะฐะตั ะฝะฐะฑะพั ะฑะธั `b^{(q)}(0),\dots,b^{(q)}(M^{(q)}_{bit} - 1)` ะธ ัะตะทัะปััะฐัะพะผ ัะฒะปัะตััั ะฝะฐะฑะพั ะฑะธั `\tilde{b}^{(q)}(0),\dots,\tilde{b}^{(q)}(M^{(q)}_{bit} - 1)`, ะณะดะต `M^{(q)}_{bit}` - ะบะพะป-ะฒะพ ะฑะธั ะฒ codeword `q` ะฝะฐ PUSCH ะฒ ะพะดะฝะพะผ subframe.

Scrambling ะพัััะตััะฒะปัะตััั ะฟะพ ัะปะตะดัััะตะผั ะฐะปะณะพัะธัะผั:
1. i = 0
2. ะะพะบะฐ i < `M^{(q}}_{bit}`
 3. ะัะปะธ `b^{(q)}(i)` ะพัะฝะพัะธััั ะบ ะฑะธัะฐะผ ACK/NACK ะธะปะธ Rank Indicator (ะฟัะพ ะฝะตะณะพ ะฟะพัะพะผ) placeholder
  4. ะขะพ `\tilde{b}^{(q)}(i)` = 1
 5. ะะฝะฐัะต
  6. ะัะปะธ `b^{(q)}(i)` ะพัะฝะพัะธััั ะบ ะฑะธัะฐะผ ะฟะพะฒัะพัะฐ ACK/NACK ะธะปะธ Rank Indicator placeholder
   7. ะขะพ `\tilde{b}^{(q)}(i) = \tilde{b}^{(q)}(i-1)`
  8. ะะฝะฐัะต `\tilde{b}^{(q)}(i) = (b^{(q)}(i-1) + ั^{(q)}(i)) \mod 2`
 9. i += 1

ะัะธ ััะพะผ ััั ะตััั Pseudo-random Gold Sequence `c^{(q)}(i)` - ะดะปั ะฝะตั ะตััั ัะฒะพะน `c_{init}`. ะะฝ ะพะฟัะตะดะตะปัะตััั ัะฐะบ: `c_{init} = n_{RNTI} \cdot 2^{14} + q \cdot 2^{13} + \lfloor n_s / 2 \rfloor \cdot 2^9 + N^{cell}_{ID}`

ะัะธะฒะพะถั ัะตะฐะปะธะทะฐัะธั ะฒ ะบะพะดะต, ัะฐะบ ะฟะพะฝััั ััะพ ะฟัะพะธััะพะดะธั ะฟัะพัะต:
```
import numpy as np
import scrambling

class InputBit:
    value: int

    def __init__(self, value):
        self.value = value

    def __repr__(self):
        return f"{self.__class__.__name__}({self.value})"
    def __str__(self):
        return f"{self.__class__.__name__}({self.value})"

class PlaceholderBit(InputBit): pass
class PlaceholderRepetitionBit(InputBit): pass
class DataBit(InputBit): pass

def scramble(bits: list[InputBit], q: int, n_rnti: int, N_Cell_id: int, n_s: int):
    c_init = n_rnti * (2 ** 14) + q * (2 ** 13) + int(np.floor(n_s / 2)) * (2 ** 9) + N_Cell_id
    c = scrambling.get_scrambling_sequence(c_init, len(bits))
    b_hat = [0] * len(bits)

    for i in range(len(bits)):
        bit = bits[i]
        if isinstance(bit, PlaceholderBit):
            b_hat[i] = 1
        else:
            if isinstance(bit, PlaceholderRepetitionBit):
                b_hat[i] = b_hat[i - 1]
            else:
                b_hat[i] = (bit.value + c[i]) % 2

    return b_hat

if __name__ == "__main__":
    bits = [0, 1, 1, 1, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1]
    for i, b in enumerate(bits):
        if i < 3: bits[i] = PlaceholderBit(b)
        if 3 <= i < 6: bits[i] = PlaceholderRepetitionBit(b)
        if i >= 6: bits[i] = DataBit(b)

    q = 0
    n_rnti = 2
    N_cell_id = 133
    n_s = 0
    
    scrambled = scramble(bits, q, n_rnti, N_cell_id, n_s)
    print(scrambled)
```

###### 1.1.6.1.2. PUSCH Modulation

ะะปั PUSCH ะธัะฟะพะปัะทััััั ัะพะปัะบะพ ัะปะตะดัััะธะต ะฒะธะดั ะผะพะดัะปััะธะธ: QPSK, 16QAM, 64QAM, 256QAM, pi/2 BPSK. ะะธัะตะณะพ ะพัะพะฑะตะฝะฝะพะณะพ.

###### 1.1.6.1.3. PUSCH Layer Mapping

ะัััะตััะฒะปัะตััั ัะฐะบะถะต, ะบะฐะบ ะธ ะดะปั downlink ะบะฐะฝะฐะปะพะฒ. ะัะปะธัะธะต ะทะฐะบะปััะฐะตััั ัะพะปัะบะพ ะฒ ัะพะผ, ััะพ ะบะพะป-ะฒะพ ััะพะฒะฝะตะน `v` ะพะณัะฐะฝะธัะตะฝะพ 4-ะผ, ะฐ ัะพัะผัะปั ะดะปั ะฝะธั ัะฐะผ ัะฐะบะธะต ะถะต.

ะ ะดะฐ, ะทะดะตัั ะฝะต ะฟะพะดะดะตัะถะธะฒะฐะตััั Transmit Diversity. ะขะพะปัะบะพ ะปะธะฑะพ ะพะดะฝะฐ ะฐะฝัะตะฝะฝะฐ, ะปะธะฑะพ Spatial Multiplexing (ั.ะต MIMO)

###### 1.1.6.1.4. PUSCH Precoding

ะญัะพั ััะฐะฟ ะดะปั PUSCH ะธะผะตะตั ะดะพััะฐัะพัะฝะพ ะผะฝะพะณะพ ัะฐะทะปะธัะธะน: ะฒะพ ะฟะตัะฒัั ะพะฝ ัะฐะทะฑะธั ะฝะฐ ะดะฒะฐ ัะฐะณะฐ: Transform Precoding ะธ Precoding, ะฐ ัะฐะบะถะต ะฒ ะฝะตะผ ะธัะฟะพะปัะทััััั ะดััะณะธะต ะผะฐััะธัั ะธะท codebook, ัะตะนัะฐั ััะพ ัะฐะทะฑะตัะตะผ.

* 1.1.6.1.4.1. Transform Precoding

1. ะะฐ ะฒัะพะด ะฟะพะปััะฐะตั ะฝะฐะฑะพั ะบะพะผะฟะปะตะบัะฝัั ัะธัะตะป `x^{(\lambda)}(0),\dots,x^{(\lambda)}(M^{layer}_{symb} - 1), \lambda=0,1,\dots,v-1`, ะณะดะต `M^{layer}_{symb}` - ะบะพะป-ะฒะพ ัะธะผะฒะพะปะพะฒ ะฝะฐ ะพะดะฝะพะผ ััะพะฒะฝะต, ะฐ `v` - ะบะพะป-ะฒะพ ััะพะฒะฝะตะน. 
2. ะะปั ะบะฐะถะดะพะณะพ ััะพะฒะฝั ะฟัะพะธะทะฒะพะดะธััั ัะฐะทะฑะธะตะฝะธะต ะฝะฐ `M^{layer}_{symb}/M^{PUSCH}_{sc}` ะณััะฟะฟ, ะดััะณะธะผะธ ัะปะพะฒะฐะผะธ ะฝะฐ SC-FDMA ัะธะผะฒะพะปั (ั.ะต ะฝะฐ ะพะดะธะฝ time-domain ัะธะผะฒะพะป).
3. ะะฐัะตะผ ะฝะฐะด ัะธะผะฒะพะปะฐะผะธ ะฟัะพะธะทะฒะพะดะธััั ัะปะตะดัััะฐั ะพะฟะตัะฐัะธั:
```
y^{(\lambda)}(l \cdot M^{PUSCH}_{sc} + k) = \frac{1}{\sqrt{M^{PUSCH}_{sc}}} \sum^{M^{PUSCH}_{sc} - 1}_{i=0}{x^{(\lambda)}(l \cdot M^{PUSCH}_{sc} +i)}e^{-j\frac{2\pi \cdot ik}{M^{PUSCH}_{sc}}} \\
k = 0,\dots,M^{PUSCH}_{sc}-1 \\ 
l = 0,\dots,M^{layer}_{symb}/M^{PUSCH}_{sc}-1
```

ะะฑัััะฝัั: ะฒ ัะพัะผัะปะต ะผะพะถะฝะพ ะทะฐะผะตัะธัั ะธะฝัะตัะตัะฝัั ะธะฝะดะตะบัะฐัะธั: `l * M^{PUSCH}_{sc} + k`, ะฝะฐะฟัะธะผะตั. ะญัะพ ะธะฝะดะตะบัะฐัะธั ะฒ ะผะฐััะธัะต, ะณะดะต ะฝะพะผะตั ััะพะปะฑัะฐ - `k`, ะฐ ะฝะพะผะตั ััะดะฐ - `l`. ะะพััะพะผั ะฟะพ ัััะธ ัะพ, ะพ ัะตะผ ะณะพะฒะพัะธั ััะฐ ัะพัะผัะปะฐ - ััะพ ัะพ ััะพ ะฝะฐะดะพ ะดะปั ะบะฐะถะดะพะณะพ ััะดะฐ ัะฐะทะฑะธััั ัะฐะฝะตะต ัะปะตะผะตะฝัะพะฒ ะฟัะพะธะทะฒะตััะธ ะพะฟะตัะฐัะธั ััะผะผะธัะพะฒะฐะฝะธั ั ัะผะฝะพะถะตะฝะธะตะผ ะฝะฐ ัะบะฟะพะฝะตะฝัะธะฐะปัะฝัะน ะบะพััะธัะธะตะฝั, ะฟัะธะฒะตะดัะฝะฝัะน ะฒะพ ะฒัะพัะพะน ัะฐััะธ ัะพัะผัะปั. ะัะธ ััะพะผ ัะตะทัะปััะฐั ััะพะณะพ ััะผะผะธัะพะฒะฐะฝะธั ัะผะฝะพะถะธัั ะฝะฐ `\frac{1}{\sqrt{M^{PUSCH}_{sc}}}`. ะขะตะบััะพะผ ััะพ ัะพัะฝะพ ะฝะต ะพัะตะฝั ะฟะพะฝััะฝะพ, ะฟะพััะพะผั ะฟัะธะฒะตะดั ัะตะฐะปะธะทะฐัะธั ะฒ ะบะพะดะต:
```
def transform_precoding(x: np.ndarray, M_pusch_sc: int):
    grouped = x.reshape((len(x) // M_pusch_sc, M_pusch_sc))
    y = np.zeros_like(x, dtype=complex)

    for l in range(grouped.shape[0]):
        for k in range(grouped.shape[1]):
            group_sum = sum([grouped[l][i] * np.exp(-1j * 2 * np.pi * i * k / M_pusch_sc) for i in range(M_pusch_sc)])
            y[l * M_pusch_sc + k] = (1 / np.sqrt(M_pusch_sc)) * group_sum

    return y
```

ะัะธ ััะพะผ ะฒั ะผะพะณะปะธ ัะถะต ะบัะธัะฐัั, ััะพ ััะฐ ัะฐััั ัะพัะผัะปั ั ััะผะผะธัะพะฒะฐะฝะธะตะผ - ััะพ ะพะฑััะฝัะน FFT. ะะฐ. ะะพะด ะผะพะถะฝะพ ะพะฟัะธะผะธะทะธัะพะฒะฐัั ะธ ะธัะฟะพะปัะทะพะฒะฐัั ัะถะต ะณะพัะพะฒัั ัะพัะผัะปั FFT:
```
def transform_precoding(x: np.ndarray, M_pusch_sc: int):
    grouped = x.reshape((len(x) // M_pusch_sc, M_pusch_sc))
    y = np.zeros_like(x, dtype=complex)

    for l in range(grouped.shape[0]):
        fft = np.fft.fft(grouped[l])
        y[l * M_pusch_sc : (l + 1) * M_pusch_sc] = (1 / np.sqrt(M_pusch_sc)) * fft

    return y
```

ะญัะพั ััะฐะฟ ะฝัะถะตะฝ ะดะปั ัะพะทะดะฐะฝะธั SC-FDMA ัะธะณะฝะฐะปะฐ, ะฒะตะดั, ะบะฐะบ ั ะธ ะฟะธัะฐะป ัะฐะฝะตะต, SC-FDMA - ััะพ ะฒะตััะธั OFDMA, ะฒ ะบะพัะพััะน ะดะพะฑะฐะฒะปัะตััั ะดะพะฟะพะปะฝะธัะตะปัะฝัะน ััะฐะฟ DFT. SC-FDMA ะฑะพะปะตะต ัััะตะบัะธะฒะฝัะน ั ัะพัะบะธ ะทัะตะฝะธั ะทะฐััะฐั ัะฝะตัะณะธะธ, ัะฐะบ ะบะฐะบ ะธะผะตะตั ะฑะพะปะตะต ะฝะธะทะบะธะน PAPR (Peak To Average Power Ratio) - ั.ะต ะพัะฝะพัะตะฝะธะต ะผะฐะบัะธะผะฐะปัะฝะพะน ะผะพัะฝะพััะธ ัะธะณะฝะฐะปะฐ ะบ ััะตะดะฝะตะน. ะะฝ ะธัะฟะพะปัะทัะตััั ัะพะปัะบะพ ะฝะฐ uplink ะธะผะตะฝะฝะพ ะดะปั ัะผะตะฝััะตะฝะธั ัะฐััะพะดะฐ ะฑะฐัะฐัะตะธ. ะะฐ ะฑะฐะทะพะฒะพะน ััะฐะฝัะธะธ ัะบะพะฝะพะผะธัั ัะฝะตัะณะธั ะฝะตะทะฐัะตะผ, ะฟะพััะพะผั ัะฐะผ ะธัะฟะพะปัะทัะตััั ััะฐะฝะดะฐััะฝัะน OFDM. (ะฒ 5g NR ะบััะฐัะธ OFDMA ะผะพะถะตั ะธัะฟะพะปัะทะพะฒะฐัััั ะฒ ะฝะฐะฟัะฐะฒะปะตะฝะธะธ uplink ัะพะถะต, ะฝะพ ะพะฑ ััะพะผ ะฟะพะทะถะต)

ะ ะดะฐ, ััะพะฑั ัะพัั ะบะฐะบ-ัะพ ะธะฝััะธัะธะฒะฝะพ ะฟะพะฝััั SC-FDMA, ะฟะพะฟัะพะฑัะนัะต ะฟัะตะดััะฐะฒะธัั ะบะฐะบ ัะธะผะฒะพะปั ัะฐัะฟัะตะดะตะปััััั ะฒ OFDM: ะบะฐะถะดัะน ะพัะดะตะปัะฝัะน ัะธะผะฒะพะป ะฟะพะปััะฐะตั ัะฒะพะน ะบะพะฝะบัะตัะฝัะน subcarrier ะธ ะฟะตัะตะดะฐัััั ะฝะฐ ะฝะตะผ. ะัะปะธ ะฒ ััะพั ะฟัะพัะตัั ะดะพะฑะฐะฒะธัั DFT, ัะพ ะบะฐะถะดัะน ัะธะผะฒะพะป ะฑัะดะตั ัะฐัััะฝัั ะฟะพ ัะฐััะพัะต ะธ ะฟะตัะตะดะฐะฝ ะฟะพัะปะตะดะพะฒะฐัะตะปัะฝะพ. ะัััะดะฐ SC-FDMA ะธ ะธะผะตะตั ัะฒะพั ะฝะฐะทะฒะฐะฝะธะต: Single-Carrier, ัะฐะบ ะบะฐะบ ะพะฝ "ัะธะผัะปะธััะตั" ัะฐัะฐะบัะตัะธััะธะบะธ QAM ัะธะณะฝะฐะปะฐ ั ะพะดะฝะพะน ะฟะพะดะฝะตัััะตะน.

* 1.1.6.1.4.2. Precoding

ะะฐ ััะพะผ ััะฐะฟะต ะฝะต ะฟัะพะธััะพะดะธั ะฝะธัะตะณะพ ัะฝะธะบะฐะปัะฝะพะณะพ, ัะตะณะพ ะผั ะฑั ะฝะต ัะฐะทะฑะธัะฐะปะธ ัะฐะฝะตะต. ะัะฟะพะปัะทััััั ะปะธัั ะดััะณะธะต ะฝะฐะฑะพัั Precoding ะผะฐััะธั. ะั ะฒัะต ั ะฟัะธะฒะตะดั ะฒ ะธะปะปััััะฐัะธะธ ั ะพะฑัะตะน ะฟัะพัะตะดััะพะน ะณะตะฝะตัะฐัะธะธ ัะธะณะฝะฐะปะฐ.

###### 1.1.6.1.5. PUSCH Mapping to physical resources

PUSCH ะฝะฐะทะฝะฐัะฐะตััั ะฒัะตะผ RE ะฒ subframe ะทะฐ ะธัะบะปััะตะฝะธะตะผ:
 1. RE, ะฝะฐะทะฝะฐัะตะฝะฝัะผ RS
 2. RE ะฒ ะฟะพัะปะตะดะฝะตะผ SC-FDMA ัะธะผะฒะพะปะต ะฒ subframe, ะตัะปะธ ะพะฝ ะธัะฟะพะปัะทัะตััั ะดะปั ะฟะตัะตะดะฐัะต SRS
 3. RE ะฒ ะฟะตัะฒะพะผ SC-FDMA ัะธะผะฒะพะปะต slot'ะฐ ะตัะปะธ ะฒ DCI ะฟะพะปะต starting position ัะพะดะตัะถะธั ะทะฝะฐัะตะฝะธั 01, 10, 11 ะธ PUSCH Mode != 2
 4. RE ะฒ ะฟะพัะปะตะดะฝะตะผ SC-FDMA ัะธะผะฒะพะปะต subframe'ะฐ ะธะปะธ ะฒัะพัะพะผ slot ะตัะปะธ ะฒ DCI ะฟะพะปะต ending symbol ัะพะดะตัะถะธั 0 ะธ Mode=3

ะัะธ ััะพะผ ะฝะฐะทะฝะฐัะตะฝะธะต ะบ RE (k, l) ะฝะฐะทะฝะฐัะฐะตััั ะฒ ะฟะพััะดะบะต ัะฒะตะปะธัะตะฝะธั ัะฝะฐัะฐะปะฐ ะทะฝะฐัะตะฝะธั k (ั.ะต ัะฐััะพัั), ะฟะพัะพะผ ะทะฝะฐัะตะฝะธั l (ั.ะต ะฒัะตะผะตะฝะธ).

ะขัั ัะพะปัะบะพ ััะพะธั ะทะฐะผะตัะธัั, ััะพ ะตััั ะพะดะฝะฐ ะดะตัะฐะปั, ะบะพัะพััั ั ัะตะนัะฐั ะฝะฐะผะตัะตะฝะฝะพ ัะฟััั: Frequency Hopping. ะญัะพ ัะธัะฐ ะบะพะฝะบัะตัะฝะพ ััะพะณะพ ะบะฐะฝะฐะปะฐ, ะบะพัะพัะฐั ะฟะพะทะฒะพะปัะตั ะฒัะดะตะปะตะฝะฝัะผ ัะตััััะฐะผ ะฟะพััะพัะฝะฝะพ ะผะตะฝััั ัะฐัะฟะพะปะพะถะตะฝะธะต ะฟะพ ัะฐััะพัะต. ะญัะพ ะผะพะถะตั ะฑััั ะฟะพะปะตะทะฝะพ, ะฝะฐะฟัะธะผะตั, ะตัะปะธ ะฝะตะบะพัะพััะต ัะฐััะพัั ัะพะดะตัะถะฐั ะฒ ัะตะฑะต ะฟะพะผะตัะธ. ะัะปะธ ัะฐััะพัะฐ ะฟะพััะพัะฝะฝะพ ะผะตะฝัะตััั, ัะพ ะฒ ัะฐะบะพะผ ัะปััะฐะต ะผะพะถะฝะพ ะฑัะดะตั ะฟะตัะตะดะฐัั ัะพัั ะบะฐะบะธะต-ัะพ ะดะฐะฝะฝัะต ะฝะฐ ัะฐััะพัะฐั, ะฝะฐ ะบะพัะพััั ะฝะตั ะฟะพะผะตั. ะััะฐะปัะฝัะต ะดะฐะฝะฝัะต ะฑัะดัั ะฟะตัะตะพัะฟัะฐะฒะปะตะฝะฝั ะฑะปะฐะณะพะดะฐัั ะฟัะพัะตะดััะต HARQ.

ะขัั ั ัะดะตะปะฐะป ะธะปะปััััะฐัะธั, ะณะดะต ัะบะฐะทะฐะป ะฒัะต ัะพัะผัะปั ะธ ะผะฐััะธัั, ะธัะฟะพะปัะทัะตะผัะต ะดะปั PUSCH: (PHY PUSCH) https://imgur.com/a/ptgfM4Z.

##### 1.1.6.2. PUCCH - Physical Uplink Control Channel

PUCCH - ะบะฐะฝะฐะป, ะฟะพ ะบะพัะพัะพะผั ะฟะตัะตะดะฐัััั UCI (Uplink Control Information). UCI ะธัะฟะพะปัะทััััั ะดะปั ACK/NACK, ะฐ ัะฐะบะถะต ะทะฐะฟัะพัะพะฒ ะฝะฐ ะฒัะดะตะปะตะฝะธะต ัะตััััะพะฒ. ะกะตะนัะฐั ะผั ัะฐััะผะฐััะธะฒะฐะตะผ ัะพะปัะบะพ ัะธะทะธัะตัะบะธะน ััะพะฒะตะฝั, ะฟะพััะพะผั ะฝะต ะฑัะดะตะผ ะทะฐะพัััััั ะฝะฐ ััะพะผ ะฒะฝะธะผะฐะฝะธะต.

ะญัะพั ะบะฐะฝะฐะป ัะฝะธะบะฐะปะตะฝ ัะตะผ, ััะพ ั ะฝะตะณะพ ะตััั ะฝะตัะบะพะปัะบะพ ัะพัะผะฐัะพะฒ, ะฐ ะธะผะตะฝะฝะพ: 1, 1a, 1b, 2, 2a, 2b, 3, 4 ะธ 5. ะะฐะถะดัะน ะธะท ัะพัะผะฐัะพะฒ ะฟัะธะผะตะฝัะตััั ะดะปั ะพัะฟัะฐะฒะบะธ ัะฐะทะฝัั ะดะฐะฝะฝัั. ะกะตะนัะฐั ัะฐะบ ะบะฐะบ ะผั ัะฐััะผะฐััะธะฒะฐะตะผ ัะพะปัะบะพ ัะธะทะธัะตัะบะธะน ััะพะฒะตะฝั, ะฝะต ะฑัะดะตะผ ะทะฐััะฐะณะธะฒะฐัั ะบะฐะบะธะต ะบะพะฝะบัะตัะฝะพ ะดะฐะฝะฝัะต ะพัะฟัะฐะฒะปััััั ะฟะพ ะบะฐะบะพะผั ัะพัะผะฐัั, ัะฐััะผะพััะธะผ ัะพะปัะบะพ ะณะตะฝะตัะฐัะธั ัะธะณะฝะฐะปะฐ.

ะะปั ะบะฐะถะดะพะณะพ ัะพัะผะฐัะฐ ะพะฟัะตะดะตะปะตะฝั ะฟะฐัะฐะผะตััั ะผะพะดัะปััะธะธ ะธ ะบะพะป-ะฒะฐ ะฑะธั ะฒ subframe ะฒ ัะฐะฑะปะธัะต 36.211 5.4-1: (PHY PUCCH fortmats parameters) https://imgur.com/a/ptgfM4Z.

ะกัะฐะทั ัะพัั ะทะฐะผะตัะธัั, ััะพ ะฒ ะบะพะดะต ะฒ ะผะตััะฐั ะณะตะฝะตัะฐัะธะธ ะฟะฐัะฐะผะตััะฐ `l` ะตััั ะพะดะธะฝ ะฝัะฐะฝั: ัะตะนัะฐั ัะฐะผ ะฝะต ััะธััะฒะฐัััั ัะธะณะฝะฐะปั DMRS. ะฏ ะฝะฐะผะตัะตะฝะฝะพ ัะฑัะฐะป ะธั ััะพะฑั ะฝะต ััะปะพะถะฝััั ะบะพะด ะฝะฐ ััะพะผ ััะฐะฟะต. ะ ัะฐะทะดะตะปะต ะฟัะพ ัะธะณะฝะฐะปั ััะพ ัะฐััะผะพััะธะผ.

* 1.1.6.2.1. PUCCH Format 1, 1a, 1b

ะคะพัะผะฐัั 1, 1a ะธ 1b ะฟัะตะดะฝะฐะทะฝะฐัะตะฝั ะดะปั ะฟะตัะตะดะฐัะธ ะฒัะตะณะพ ะพะดะฝะพะณะพ ะธะปะธ ะดะฒัั ะฑะธั ะดะฐะฝะฝัั, ะฝะฐะฟัะธะผะตั ะดะปั Scheduling Request ะธะปะธ HARQ ACK/NACK.

ะะตัะตะดะฐัะฐ ะดะฐะฝะฝัั ะดะปั ัะพัะผะฐัะฐ 1 ะพัััะตััะฒะปัะตััั ะพััััััะฒะธะตะผ ะปะธะฑะพ ะฟัะธััััะฒะธะตะผ ัะธะณะฝะฐะปะฐ ะฒ RE. ะัะปะธ ะพะฝ ะตััั, ะทะฝะฐัะธั ะพะดะธะฝ ะผะพะดัะปะธัะพะฒะฐะฝะฝัะน ัะธะผะฒะพะป `d(0) = 1`.

ะะปั ัะพัะผะฐัะพะฒ 1a ะธะปะธ 1b ะผะฐััะธะฒ ะฑะธั `b(0),\dots,b(M_{bit} - 1)` ะผะพะดัะปะธััะตััั ัะพะณะปะฐัะฝะพ ัะฐะฑะปะธัะต 36.211 5.4.1-1: (PHY PUCCH Format 1a, 1b Modulation) https://imgur.com/a/ptgfM4Z. ะะฐ ะฒััะพะดะต ะผั ัะฐะบะถะต ะฑัะดะตะผ ะธะผะตัั ะปะธัั ะพะดะธะฝ ัะผะพะดัะปะธัะพะฒะฐะฝะฝัะน ัะธะผะฒะพะป `d(0)`. ะ ัะฐะฑะปะธัะต ัะบะฐะทะฐะฝ ัะพัะผะฐั ะธ ะฝะฐะฑะพั ะฑะธั ะดะปั ะผะพะดัะปััะธะธ. ะะฐะฟัะธะผะตั, ะดะปั ัะพัะผะฐัะฐ 1b ะฝะฐะฑะพั ะฑะธั 01 ะฑัะดะตั ะฟัะตะพะฑัะฐะทะพะฒะฐะฝ ะฒ ะพะดะธะฝ ัะผะพะดัะปะธัะพะฒะฐะฝะฝัะน ัะธะผะฒะพะป `d(0) = -j`.

ะะฐะปััะต ะพะดะธะฝ ัะธะผะฒะพะป `d(0)`, ะดะปั ะบะฐะถะดะพะน ะฐะฝัะตะฝะฝั P, 12 ัะผะฝะพะถะฐะตััั ะฝะฐ ะผะฐััะธะฒ `r^{(\alpha_\tilde{p},\delta)}_{u,v}(n)`. ะะฐัะตะผะฐัะธัะตัะบะธ ััะพ ะผะพะถะฝะพ ะทะฐะฟะธัะฐัั ัะปะตะดัััะธะผ ะพะฑัะฐะทะพะผ: `y^{(\tilde{p},\delta)}(n) = \frac{1}{\sqrt{P}}d(0) \cdot r^{(\alpha_\tilde{p}, \delta)}_{u, v}(n), \ n = 0,1,\dots,N^{PUCCH}_{seq} - 1, \ \delta = 0`, ะณะดะต `N^{PUCCH}_{seq} = 12` - ะดะปะธะฝะฐ ะผะฐััะธะฒะฐ `r^{(\alpha_\tilde{p},\delta)}_{u,v}(n)`.

ะะพะฟัััะธะผ ะบะพะป-ะฒะพ ะฐะฝัะตะฝะฝ `P` ั ะฝะฐั ัะฐะฒะฝะพ 1. ะคะพัะผัะปะฐ ะณะพะฒะพัะธั ะพ ัะพะผ, ััะพ ะผั ัะธะผะฒะพะป `d(0)` ัะพะฒะฝะพ 12 ัะฐะท ัะผะฝะพะถะฐะตะผ ะฝะฐ ัะปะตะดัััะธะน ัะปะตะผะตะฝั ะผะฐััะธะฒะฐ `r` ะธ ะทะฐะฟะธััะฒะฐะตะผ ััะพ ะฒัั ะฒ ัะพะพัะฒะตัััะฒัััะธะน ัะปะตะผะตะฝั ะผะฐััะธะฒะฐ `y`.

ะขัั ะผะพะถะฝะพ ัะฟัะพัะธัั: "ะฐ ััะพ ัะฐะบะพะต `r^{(\alpha_\tilde{p},\delta)}_{u,v}(n)`?". ะัะฒะตั ัะฑะธะป: ััะพ Reference Signal Sequence. ะ ัะตะนัะฐั ะผั ะะ ะฑัะดะตะผ ัะฐะทะฑะธัะฐัััั ะบะฐะบ ะพะฝ ะณะตะฝะตัะธััะตััั, ัะฐะบ ะบะฐะบ ะฑัะดะตะผ ัะณะปัะฑะปััััั ะฒ ััะพั sequence ะฒ ัะฐะทะดะตะปะต ะฟัะพ ัะธะณะฝะฐะปั. ะะพะฒะตัััะต, ัะฐะผ ะพัะตะฝั ะธะฝัะตัะตัะฝะพ. ะกะตะนัะฐั ะฟะพะบะฐ ะฟัะพััะพ ะฑัะดะตะผ ะผะฐัะตะผะฐัะธัะตัะบะธ ะธัะฟะพะปัะทะพะฒะฐัั ััะพั ะผะฐััะธะฒ, ะฝะต ะทะฝะฐั ะบะฐะบ ะพะฝ ัะฐะฑะพัะฐะตั ะฟะพะด ะบะฐะฟะพัะพะผ.

ะขะฐะบ ะฒะพั, ะดะฐะปััะต ะบ ะฟะพะปััะตะฝะฝะพะผั ะผะฐััะธะฒั ัะธะผะฒะพะปะพะฒ `y^{(\tilde{p})}(0),\dots,y^{(\tilde{p})}(N^{PUCCH}_{seq} - 1)` ะฟัะธะผะตะฝัะตััั scrambling ะธ ะพััะพะณะพะฝะฐะปัะฝัะน ะบะพะด ะฐะฝัะตะฝะฝั. ะกะฝะฐัะฐะปะฐ ะทะฐะฟะธัะตะผ ััะพ ะผะฐัะตะผะฐัะธัะตัะบะธ: `\zeta^{(\tilde{p})}(m' \cdot N^{PUCCH}_{SF} \cdot N^{PUCCH}_{seq} + m \cdot N^{PUCCH}_{seq} + n) = S(n_s) \cdot w_{n^{(\tilde{p})}_{oc}}(m) \cdot y^{(\tilde{p})}(n)`, ะณะดะต `m = 0,\dots,N^{PUCCH}_{SF} - 1`, `n = 0,\dots,N^{PUCCH}_{seq}`, `m' = 0,1`. `N^{PUCCH}_{SF}` ะผะตะฝัะตััั ะฒ ะทะฐะฒะธัะธะผะพััะธ ะพั ัะพัะผะฐัะฐ ะธ ะฝะพะผะตัะฐ ัะปะพัะฐ ะฒ ัะพะพัะฒะตััะฒะธะธ ั ัะฐะฑะปะธัะตะน 36.211 5.4.1-1a:
```
โโโโโโโโโโโโโโโโโโโโโฆโโโโโโโโโโโโโโโโฆโโโโโโโโโโโโโโโ
โ   PUCCH Format    โ SF (1st Slot) โ SF (2nd Slot)โ
โโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโฃ
โ Normal 1/1a/1b    โ       4       โ      4       โ
โ Shortened 1/1a/1b โ       4       โ      3       โ
โโโโโโโโโโโโโโโโโโโโโฉโโโโโโโโโโโโโโโโฉโโโโโโโโโโโโโโโ
```

ะขัั ะฝัะถะฝะพ ะพะฑัะฐัะธัั ะฒะฝะธะผะฐะฝะธะต ะฝะฐ `S(n_s)` ะธ `w_{n^{(\tilde{p})}_{oc}}(m)`. 

 1. `S(n_s)` - ััะพ ะผะฐััะธะฒ ะดะปั Scrambling'ะฐ. ะะฝ ะพะฟัะตะดะตะปัะตััั ัะปะตะดัััะธะผ ะพะฑัะฐะทะพะผ:
```
S(n_s) = \begin{cases} 
  1 & \text{ะตัะปะธ } n'_{\tilde{p}}(n_s) \mod 2 = 0 \\
  e^{j \pi / 2} & \text{ะธะฝะฐัะต}
\end{cases}
```
 ะะดะต `n'_{\tilde{p}}(n_s)` - ััะฝะบัะธั, ะบะพัะพััั ัะตะนัะฐั ะดะฐะปััะต ะฑัะดะตะผ ัะฐััะผะฐััะธะฒะฐัั.
 ะัะปะธ ะฒะฝะธะผะฐัะตะปัะฝะพ ะฟะพัะผะพััะตัั ะฝะฐ ัะพ, ะบะฐะบะธะต ะทะฝะฐัะตะฝะธั ะฒัะฑัะฐะฝั ะดะปั Scrambling, ัะพ ะผะพะถะฝะพ ะทะฐะผะตัะธัั, ััะพ ะฒ ะฟะตัะฒะพะผ ัะปััะฐะต ัะธะณะฝะฐะป ะพััะฐัััั ะฝะตะธะทะผะตะฝะฝัะผ, ะฐ ะฒะพ ะฒัะพัะพะผ - ะฟัะตะพะฑัะตัะฐะตั ัะผะตัะตะฝะธะต ะฟะพ ัะฐะทะต ะฝะฐ 90 ะณัะฐะดััะพะฒ. ะญัะพ ะฝะตะพะฑัะพะดะธะผะพ ะดะปั ัะพะณะพ, ััะพะฑั ััะฐะทั ะฝะตัะบะพะปัะบะพ ะฟะพะปัะทะพะฒะฐัะตะปะตะน ะผะพะณะปะธ ะฒ ะพะดะฝะพ ะธ ัะพ ะถะต ะฒัะตะผั ะฝะฐ ะพะดะฝะพะน ะธ ัะพะน ะถะต ัะฐััะพัะต ะฒะตัะฐัั ัะฐะทะฝัะต ะดะฐะฝะฝัะต. ะกะธะณะฝะฐะป ั ะดะฒัั UE ะฑัะดะตั ะพััะพะณะพะฝะฐะปะตะฝ ะดััะณ ะบ ะดััะณั ะฑะปะฐะณะพะดะฐัั ัะผะตัะตะฝะธั ะฟะพ ัะฐะทะต ะฝะฐ 90 ะณัะฐะดััะพะฒ.

 2. `w_{n^{(\tilde{p})}_{oc}}(m)` - ะพััะพะณะพะฝะฐะปัะฝัะน ะบะพะด, ะบะพัะพััะน ะทะฐะฒะธัะธั ะพั `N^{PUCCH}_{SF}` ะธ `n^{(\tilde{p})}_{oc}(n_s)`. ะะฝะฐัะตะฝะธะต ะพััะพะณะพะฝะฐะปัะฝัั ะบะพะดะพะฒ ะดะฐะฝั ะฒ ัะฐะฑะปะธัะฐั 36.211 5.4.1-2 ะธ 5.4.1-3: (PHY PUCCH Format 1 Orthogonal Sequences) https://imgur.com/a/ptgfM4Z.
 ะะฟััั ะถะต, ะทะฝะฐัะตะฝะธั ะฒ ััะธั ะฟะพัะปะตะดะพะฒะฐัะตะปัะฝะพััั ะฒัะฑัะฐะฝั ะพััะพะณะพะฝะฐะปัะฝะพ ะธ ะดะปั ัะพะน ะถะต ัะตะปะธ, ััะพ ะธ scrambling. ะะพะฟะพะปะฝะธัะตะปัะฝัะน ััะฐะฟ ะฝะตะพะฑัะพะดะธะผ ะดะปั ัะฒะตะปะธัะตะฝะธั ะบะพะป-ะฒะฐ ะฒะพะทะผะพะถะฝัั ะพัะฟัะฐะฒะพะบ ะฝะฐ ะพะดะฝะธั ะธ ัะตั ะถะต ัะตััััะฐั.

ะะฐะบ ะฒั ะผะพะณะปะธ ะทะฐะผะตัะธัั, scrambling ะทะฐะฒะธัะธั ะพั `n'_{\tilde{p}}(n_s)`, ะฟะพะปััะตะฝะธะต ะพััะพะณะพะฝะฐะปัะฝะพะณะพ ะบะพะดะฐ ะพั `n^{(\tilde{p})}_{oc}(n_s)`, ะฐ ะฟัะธะผะตะฝะตะฝะธะต reference signal sequence ะพั `\alpha_{\tilde{p}}`. ะกะตะนัะฐั ัะฐะทะฑะตัะตะผ ะณะตะฝะตัะฐัะธั ััะธั ะฟะฐัะฐะผะตััะพะฒ.

 1. `n'_{\tilde{p}}(n_s)` - ะทะฐะฟะธัั ัะฝะฐัะฐะปะฐ ะผะฐัะตะผะฐัะธัะตัะบะธ, ะฟะพัะพะผ ะพะฑัััะฝั ััะพ ััะพ ะทะฝะฐัะธั:

```
n'_{\tilde{p}}(n_s) = \begin{cases}
 \begin{cases}
  n^{(1,\tilde{p})}_{PUCCH} & \text{ะตัะปะธ } n^{(1,\tilde{p})}_{PUCCH} < c \cdot N^{(1)}_{cs}/\Delta^{PUCCH}_{shift} \\
  (n^{(1,\tilde{p})}_{PUCCH} - c \cdot N^{(1)}_{cs}/\Delta^{PUCCH}_{shift}) \mod (c \cdot N^{RB}_{sc}/\Delta^{PUCCH}_{shift}) & \text{ะธะฝะฐัะต}
 \end{cases} & \text{ะฟัะธ } n_s \mod 2 = 0 \\
 \begin{cases}
  [c(n'_{\tilde{p}}(n_s - 1) + 1)] \mod (c \cdot N^{RB}_{sc} / \Delta^{PUCCH}_{shift} + 1) - 1 & \text{ะตัะปะธ } n^{(1,\tilde{p})}_{PUCCH} \geq c \cdot N^{(1)}_{cs}/\Delta^{PUCCH}_{shift} \\
  \lfloor h_{\tilde{p}} / c \rfloor + \frac{(h_{\tilde{p}} \mod c) \cdot N'}{\Delta^{PUCCH}_{shift}} & \text{ะธะฝะฐัะต}
 \end{cases} & \text{ะฟัะธ } n_s \mod 2 = 1
\end{cases} \\
h_{\tilde{p}} = (n'_{\tilde{p}}(n_s - 1) + d) \mod (c \cdot N' / \Delta^{PUCCH}_{shift})
```
 ะณะดะต 
  - `d = 2, c = 3` ะดะปั normal CP, `d = 0, c = 2` ะดะปั extended CP 
  - `\Delta^{PUCCH}_{shift}` ะธะดัั ะธะท ะฟะฐัะฐะผะตััะฐ `deltaPUCCH-shift` ะฒ SIB2
  - `N^{(1)}_{cs}` ะธะดัั ะธะท ะฟะฐัะฐะผะตััะฐ `nCS-AN` ะฒ SIB2
  - `N^{RB}_{sc} = 12`
  - `n^{(1,\tilde{p})}_{PUCCH}` - ะฝะพะผะตั ัะตััััะฐ, ะบะพัะพััะน ะธะดัั ะธะท ะฒะตััะฝะธั ััะพะฒะฝะตะน (ะฐ ะธะผะตะฝะฝะพ ะธะท DCI, ัะพะฒะผะตััะฝะพ ั SIB2 (ะฟะพะปะต `n1PUCCH-AN`) (ัะฐะผ ะธัะฟะพะปัะทัะตััั ัะพัะผัะปะฐ, ะบะพัะพัะฐั ัะพััะพะธั ะธะท ะดะฒัั ะฟะฐัะฐะผะตััะพะฒ), ะฝะพ ะพะฑ ััะพะผ ะฒ ัะฐะทะดะตะปะต ะฟัะพ ะฟัะพัะตะดััั)

 ะขะตะฟะตัั ะดะฐะฒะฐะนัะต ัะฐะทะฑะธัะฐัััั ะฝะฐ ััะพ ััะพ ะฒะพะพะฑัะต ะฒะปะธัะตั ะธ ะฟะพัะตะผั ัะพัะผัะปะฐ ะธะผะตะฝะฝะพ ัะฐะบะฐั.
 1.1. ะกะฝะฐัะฐะปะฐ ัะฐะทะฑะตัะตะผัั ั ััะปะพะฒะธะตะผ ะฒ ัะพัะผัะปะฐั: `n^{(1,\tilde{p})}_{PUCCH} < c \cdot N^{(1)}_{cs}/\Delta^{PUCCH}_{shift}`. ะขัั `c \cdot N^{(1)}_{cs}/\Delta^{PUCCH}_{shift}` - ะพะฑัะตะต ะบะพะปะธัะตััะฒะพ ะดะพัััะฟะฝัั cyclic shift'ะพะฒ ะดะปั ัะตะบััะตะณะพ PUCCH. 
  1.1.1. c - ะบะพะป-ะฒะพ ะพััะพะณะพะฝะฐะปัะฝัั ะบะพะดะพะฒ ะฝะฐ ะพะดะธะฝ RB
  1.1.2. `N^{(1)}_{cs}` - ะบะพะป-ะฒะพ ะธัะฟะพะปัะทัะตะผัั cyclic shift'ะพะฒ ะฒ ัะตะปะพะผ
  1.1.3. `\Delta^{PUCCH}_{shift}` - ัะฐะณ ะผะตะถะดั ะผะตะถะดั cyclic shift'ะฐะผะธ.
  1.1.4. ะงัะพะฑั ะปัััะต ะฟะพะฝััั, ััะพ ััะพ ะทะฝะฐัะธั, ะพะฑัะฐัะธะผัั ะพะฟััั ะบ ะธััะพะดะฝะพะน ัะพัะผัะปะต ะณะตะฝะตัะฐัะธะธ `y`. ะ ะฝะตะน ะธัะฟะพะปัะทัะตััั ััะฝะบัะธั `r`, ะบะพัะพัะฐั ะฒัะดะฐัั ะบะฐะถะดัะน ัะฐะท ะฝะพะฒัะน ะพััะพะณะพะฝะฐะปัะฝัะน ะบะพะด. Cyclic shift - ััะพ ะบะพะณะดะฐ ะผั ะฑะตัะตะผ ััะพั ะฝะฐะฑะพั ัะธัะตะป ะธ ะดะตะปะฐะตะผ ัะฐะบ, ััะพ ัะปะตะผะตะฝั ะฟะพะด ะฝะพะผะตัะพะผ `n` ััะฐะฝะพะฒะธััั ัะปะตะผะตะฝัะพะผ ะฟะพะด ะฝะพะผะตัะพะผ `(n + m) \mod N^{PUCCH}_{seq}`, ะณะดะต m - ะบะฐะบ ัะฐะท ัะผะตัะตะฝะธะต. ะขะฐะบ ะฒะพั ะฟะพะปััะฐะตััั, ััะพ ะพะฑัะตะต ะบะพะปะธัะตััะฒะพ ะทะฝะฐัะตะฝะธะน `m` - ััะพ `N^{(1)}_{cs}`, ัะฐะณ ะผะตะถะดั ะฝะธะผะธ - ััะพ `\Delta^{PUCCH}_{shift}`, ะฐ `c` - ะพะฑัะตะต ะบะพะปะธัะตััะฒะพ ะฒะพะทะผะพะถะฝัั ะพััะพะณะพะฝะฐะปัะฝัั ะบะพะดะพะฒ ะฒ ะพะดะฝะพะผ RB. ะัััะดะฐ ะธ ะฒััะพะดะธั, ััะพ ะทะฝะฐัะตะฝะธะต `c \cdot N^{(1)}{cs}/\Delta^{PUCCH}{shift}` - ััะพ ะพะฑัะตะต ะบะพะป-ะฒะพ ะฒ ัะตะปะพะผ ะดะพัััะฟะฝัั cyclic shift'ะพะฒ ะดะปั ัะตะบััะธั ะฒัะดะตะปะตะฝะฝัั ัะตััััะพะฒ PUCCH ะดะปั ะพะดะฝะพะณะพ RB.
  1.1.5. ะ ะฟะพะปััะฐะตััั, ััะพ ัะฐะบ ะบะฐะบ ะฝะฐะผ ะดะพัััะฟะฝะพ ะฒัะตะณะพ `c \cdot N^{(1)}{cs}/\Delta^{PUCCH}{shift}` cyclic shift'ะพะฒ, ัะพ ะฒ ะพะดะธะฝ RB ะผะพะถะฝะพ ะทะฐะฟะธัะฐัั ะฒัะตะณะพ ะบะฐะบะพะต-ัะพ ะพะฟัะตะดะตะปัะฝะฝะพะต ะทะฝะฐัะตะฝะธะต ัะฐะทะปะธัะฝัั ะดะฐะฝะฝัั. ะะพััะพะผั ะตัะปะธ ะฝะพะผะตั RB `n^{(1,\tilde{p})}_{PUCCH}` ะผะตะฝััะต ัะตะผ ะพะฑัะตะต ะบะพะป-ะฒะพ cyclic shift'ะพะฒ, ะผั ะผะพะถะตะผ ะฝะฐะทะฝะฐัะฐัั ะฒ ััะพั RB ะดะฐะฝะฝัะต ะฝะฐะฟััะผัั, ะฐ ะตัะปะธ ะฑะพะปััะต (ะบะพะณะดะฐ, ะฝะฐะฟัะธะผะตั, UE ะฑะพะปััะต, ัะตะผ ะพััะพะณะพะฝะฐะปัะฝัั ัะตััััะพะฒ), ัะพ ะฝะฐะดะพ ะธะดัะธ ะพะฑัะฐัะฝะพ ะธ ะฝะฐะทะฝะฐัะฐัั ะดะฐะฝะฝัะต ะฒ ะฟัะตะดัะดััะธะต RB - ะทะฐ ััะพ ะพัะฒะตัะฐะตั `(n^{(1,\tilde{p})}_{PUCCH} - c \cdot N^{(1)}_{cs}/\Delta^{PUCCH}_{shift}) \mod (c \cdot N^{RB}_{sc}/\Delta^{PUCCH}_{shift})`
 1.2. ะขะตะฟะตัั ัะฐะทะฑะตัะตะผัั ั ะฝะฐะทะฝะฐัะตะฝะธะตะผ ะฝะพะผะตัะฐ RB ะฒ ัะปััะฐะต, ะบะพะณะดะฐ `n_s` ะฝะตัะตัะฝัะน. ะ ััะพะผ ัะปััะฐะต ะธัะฟะพะปัะทัะตััั ัะฐะบะพะต ะฒััะฐะถะตะฝะธะต:

```
\begin{cases}
  [c(n'_{\tilde{p}}(n_s - 1) + 1)] \mod (c \cdot N^{RB}_{sc} / \Delta^{PUCCH}_{shift} + 1) - 1 & \text{ะตัะปะธ } n^{(1,\tilde{p})}_{PUCCH} \geq c \cdot N^{(1)}_{cs}/\Delta^{PUCCH}_{shift} \\
  \lfloor h_{\tilde{p}} / c \rfloor + \frac{(h_{\tilde{p}} \mod c) \cdot N'}{\Delta^{PUCCH}_{shift}} & \text{ะธะฝะฐัะต}
\end{cases}
```
  1.2.1. ะขัั ัะพะถะต ัะพัะผัะปะฐ ัะฐะทะฑะธัะฐ ะฝะฐ ะดะฒะต ัะฐััะธ. ะะฐััะผะพััะธะผ ะฟะตัะฒัั. ะะฝะฐ ะฒัะฟะพะปะฝัะตััั, ะตัะปะธ ะผั ัะถะต ะฒััะปะธ ะทะฐ ัะฐะผะบะธ ะพััะพะณะพะฝะฐะปัะฝัั ัะตััััะพะฒ. ะ ัะฐะบะพะผ ัะปััะฐะต ะฑะตัะตััั ะฟัะตะดัะดััะธะน ัะปะตะผะตะฝั ะผะฐััะธะฒะฐ ะฝะพะผะตัะพะฒ RB, ะบ ะฝะตะผั ะฟัะธะฑะฐะฒะปัะตััั 1, ะทะฐัะตะผ ัะผะฝะพะถะฐะตััั ะฝะฐ `c`, ะฑะตัะตััั ะพััะฐัะพะบ ะพั ะดะตะปะตะฝะธั ะฝะฐ ะพะฑัะตะต ัะธัะปะพ cyclic shift'ะพะฒ ะธ ะพั ััะพะณะพ ะพัะฝะธะผะฐะตััั 1. ะญัะฐ ะพะฟะตัะฐัะธั ัะพะทะดะฐัั ะฑะพะปััะต ัะฐะทะฑัะพัะฐ ะฒ ะฒัะดะตะปะตะฝะธะธ ัะตััััะพะฒ ะดะปั ะฝะตัััะฝัั slot'ะพะฒ, ัะผะตะฝััะฐั ัะตะผ ัะฐะผัะผ ะธะฝัะตััะตัะตะฝัะธั.
  1.2.2. ะะฐััะผะพััะธะผ ะฒัะพััั ัะฐััั. ะะฝะฐ ะฒัะฟะพะปะฝัะตััั ะตัะปะธ ะผั ะตัั ะฝะต ะฒััะปะธ ะทะฐ ัะฐะผะบะธ ะพััะพะณะพะฝะฐะปัะฝัั ัะตััััะพะฒ.
   1.2.2.1. `\lfloor h_{\tilde{p}} / c \rfloor` ะฑะตัะตั ะธะฝะดะตะบั ะณััะฟะฟั ะพััะพะณะพะฝะฐะปัะฝัั ะบะพะดะพะฒ ะฒ ัะตะบััะตะผ RB. ะข.ะต ะตัะปะธ ั ะฝะฐั ะฝะพะผะตั ะฒัะดะตะปะตะฝะฝะพะณะพ PRB - 18, ัะพ ะฝะพะผะตั ะณััะฟะฟั ะฑัะดะตั ัะฐะฒะตะฝ 6. 
   1.2.2.2. `h_{\tilde{p}} \mod c` - ะฟะพะปััะฐะตั ะฝะพะผะตั ะพััะพะณะพะฝะฐะปัะฝะพะณะพ ะบะพะดะฐ ะฒะฝัััะธ ะณััะฟะฟั ะพััะพะณะพะฝะฐะปัะฝัั ะบะพะดะพะฒ. 
   1.2.2.3. `N'` ะฒ ััะพะผ ัะปััะฐะต ะฑัะดะตั ัะฐะฒะตะฝ `N^{(1)}_{cs}`, ั.ะต ะพะฑัะตะผั ะบะพะป-ะฒั cyclic shift'ะพะฒ.
   1.2.2.4. ะัะปะธ ะฟัะพััะผะผะธัะพะฒะฐัั ะฟะพะปััะตะฝะฝัะต ัะฐััะธ ะธ ะฟะพะดะตะปะธัั ะฒัะพััั ะฝะฐ ัะฐะณ: `lfloor h_{\tilde{p}} / c \rfloor + \frac{(h_{\tilde{p}} \mod c) \cdot N'}{\Delta^{PUCCH}_{shift}}`, ัะพ ะผั ะฟะพะปััะธะผ ะฝะพะฒัะน ัะฝะธะบะฐะปัะฝัะน ะธะฝะดะตะบั RB, ะบะพัะพััะน ะพัะปะธัะฐะตััั ะพั ัะตั, ะบะพัะพััะต ะฝะฐัะพะดัััั ะฒ ัััะฝัั ัะปะพัะฐั. ะขะฐะบะพะต ัะฐะทะดะตะปะตะฝะธะต ะฟะพะผะพะณะฐะตั ัะผะตะฝััะธัั ะบะพะปะปะธะทะธะธ ัะตััััะพะฒ ั ัะฐะทะฝัั UE, ะฐ ัะฐะบะถะต ัะฒะตะปะธัะธัั ัะฐะทะฝะธัั ะฒ ัะฐััะพัะฐั, ััะพ ะฒ ะพะฑัะตะผ ัะผะตะฝััะฐะตั ะธะฝัะตััะตัะตะฝัะธั.

 ะ ะธัะพะณะต, ััะพ ะฑะพะปััะพะต ะฒััะฐะถะตะฝะธะต ะดะปั `n'_{\tilde{p}}(n_s)` ะฟัะตะพะฑัะฐะทัะตั ะฝะพะผะตั PRB ะดะปั ะฝะพะผะตัะฐ ัะปะพัะฐ `n_s`. ะขัั ััะพะธั ะฟะพะฝะธะผะฐัั, ััะพ ะฝะตัะบะพะปัะบะพ UE ะผะพะณัั ะทะฐะฝะธะผะฐัั ะพะดะฝะธ ะธ ัะต ะถะต ัะตััััั, ะฟะพััะพะผั ะธ ัััะตััะฒัะตั ัะฐะบะฐั ัะปะพะถะฝะฐั ะฟัะพัะตะดััะฐ ะฟัะตะพะฑัะฐะทะพะฒะฐะฝะธั ะฝะพะผะตัะฐ RB. ะะฝะฐ ะฟะพะผะพะณะฐะตั ัะผะตะฝััะธัั ัะธัะบ ะบะพะปะปะธะทะธะธ (ะบะพะณะดะฐ ะฝะตัะบะพะปัะบะพ UE ะธัะฟะพะปัะทััั ะพะดะธะฝะฐะบะพะฒัะต ัะตััััั ะธ ะพะดะธะฝะฐะบะพะฒัะต ะพััะพะณะพะฝะฐะปัะฝัะต ะบะพะดั), ัะฒะตะปะธัะธัั ัะฐะทะฝะธัั ะฒ ัะฐััะพัะต ะผะตะถะดั ัะฐะทะฝัะผะธ UE, ะฐ ัะฐะบะถะต ัะผะตะฝััะธัั ะธะฝัะตััะตัะตะฝัะธั ะผะตะถะดั UE.
 ะญัะฐ ัะพัะผัะปะฐ ะธัะฟะพะปัะทัะตััั ะฒ ะดััะณะธั ัะพัะผัะปะฐั ะดะปั ะณะตะฝะตัะฐัะธะธ ัะฐัะฟัะตะดะตะปัะฝะฝัั ะธ ัะฝะธะบะฐะปัะฝัั ะฟะฐัะฐะผะตััะพะฒ ะธ ะฝะต ะธัะฟะพะปัะทัะตััั ะฝะฐะฟััะผัั ะดะปั ะฝะฐะทะฝะฐัะตะฝะธั ะดะฐะฝะฝัะผ RB.

 2. `n^{(\tilde{p})}_{oc}(n_s)` - ะพะฟััั ะถะต, ัะฝะฐัะฐะปะฐ ัะดะตะปะฐั ะผะฐัะตะผะฐัะธัะตัะบะพะต ะพะฟะธัะฐะฝะธะต ะณะตะฝะตัะฐัะธะธ ััะพะน ะฟะพัะปะตะดะพะฒะฐัะตะปัะฝะพััะธ:

```
n^{(\tilde{p})}_{oc}(n_s) = \begin{cases} 
  \lfloor n'_{\tilde{p}}(n_s) \cdot \Delta^{PUCCH}_{shift} / N' \rfloor & \text{ ยะฟัะธ ะธัะฟะพะปัะทะพะฒะฐะฝะธะธ normal CP} \\
  2 \cdot \lfloor n'_{\tilde{p}}(n_s) \cdot \Delta^{PUCCH}_{shift} / N' \rfloor & \text{ ะฟัะธ ะธัะฟะพะปัะทะพะฒะฐะฝะธะธ extended CP} \\
\end{cases}
```
 
 ะัะธ ััะพะผ `N'` ะพะฟัะตะดะตะปัะตััั ะบะฐะบ:

```
N' = \begin{cases}
  N^{(1)}_{cs} & \text{ะตัะปะธ } n^{(1, \tilde{p})}_{PUCCH} < c \cdot N^{(1)}_{cs} / \Delta^{PUCCH}_{shift} \\
  N^{RB}_{sc} & \text{ะธะฝะฐัะต}
\end{cases} 
```
 
 2.1. ะกะฝะฐัะฐะปะฐ ัะฐะทะฑะตััะผัั ั `N'`:
  2.1.1. ะัะปะธ ะผั ะตัั ะฝะต ะฒััะปะธ ะทะฐ ัะฐะผะบะธ ะพััะพะณะพะฝะฐะปัะฝัั ัะตััััะพะฒ, ัะพ ะพะฝะพ ะฑัะดะตั ัะฐะฒะฝะพ ะทะฝะฐัะตะฝะธั `N^{(1)}_{cs}`, ั.ะต ะบะพะป-ะฒั cyclic shift'ะพะฒ ะฒ ัะตะปะพะผ
  2.1.2. ะัะปะธ ะฒััะปะธ, ัะพ `N^{RB}_{sc}`, ั.ะต ะบะพะป-ะฒั subcarrier ะดะปั RB (ะพะฑััะฝะพ 12).
  2.1.3. ะขะฐะบะธะผ ะพะฑัะฐะทะพะผ, `N'` ะธัะฟะพะปัะทัะตััั ะดะปั ะฐะดะฐะฟัะฐัะธะธ ะบ ัะตะณะธะพะฝั ะฝะฐะทะฝะฐัะตะฝะธั ัะตััััะพะฒ: ะตัะปะธ ะธะฝะดะตะบั RB ะตัั ะฒ ะฟัะตะดะตะปะฐั ะพััะพะณะพะฝะฐะปัะฝัั cyclic shift'ะพะฒ, ัะพ `N' = N^{(1)}_{cs}` โ ะธัะฟะพะปัะทัะตะผ ะฒัะต ะดะพัััะฟะฝัะต cyclic shift'ั. ะัะปะธ ะธะฝะดะตะบั ะฒััะตะป ะทะฐ ะฟัะตะดะตะปั ะพััะพะณะพะฝะฐะปัะฝัั ัะตััััะพะฒ, ัะพ `N' = N^{RB}_{sc}` โ ะธัะฟะพะปัะทัะตะผ ะฒัะต ะฟะพะดะฝะตัััะธะต RB ะดะปั ัะฐัะฟัะตะดะตะปะตะฝะธั ัะตััััะพะฒ.
 2.2. ะขะตะฟะตัั ัะฐะทะฑะตัะตะผัั ั ะพัะฝะพะฒะฝัะผ ะฒััะฐะถะตะฝะธะตะผ ะดะปั `n^{(\tilde{p})}_{oc}(n_s)`. ะะพะปััะตะฝะธะต ะฝะพะผะตัะฐ ะพััะพะณะพะฝะฐะปัะฝะพะณะพ ะบะพะดะฐ ะพัััะตััะฒะปัะตััั ะฒ ะทะฐะฒะธัะธะผะพััะธ ะพั ะฝะพะผะตัะฐ PRB `n'_{\tilde{p}}(n_s)` ัะฐะบ ะบะฐะบ ะพะฝ ะฟัะตะดะพััะฐะฒะปัะตั ะดะพััะฐัะพัะฝะพ ัะพัะพัะตะต ัะฐะทะดะตะปะตะฝะธะต ะฟะพะปัะทะพะฒะฐัะตะปะตะน ะฒ ัะตะปะพะผ. ะะปั ะฟะพะปััะตะฝะธั ะฝะพะผะตัะฐ ะตัั ะฝะตะพะฑัะพะดะธะผะพ ัะผะฝะพะถะธัั ะตะณะพ ะฝะฐ `\frac{\Delta^{PUCCH}_{shift}}{N'}`. ะขัั ััะพ ะผะพะถะฝะพ ะฟัะตะดััะฐะฒะธัั ะบะฐะบ ะฝะฐะฑะพั `N'` cyclic shift'ะพะฒ, ัะฐะทะดะตะปัะฝะฝัั ะผะตะถะดั ัะพะฑะพะน ัะฐะณะพะผ `\Delta^{PUCCH}_{shift}`. ะัะธ ััะพะผ ัะฐะบ ะบะฐะบ `\Delta^{PUCCH}_{shift}` ะผะพะถะตั ะฑััั ัะฐะฒะตะฝ 1, 2, ะธะปะธ 3, ะฐ `N' \leq 12` ัะพ ะฟะพะปััะฐะตััั, ััะพ ะผั ะฒ ะปัะฑะพะผ ัะปััะฐะต ะฑัะดะตะผ ะฟะพะปััะฐัั ัะธัะปะฐ, ะผะตะฝััะธะต 3. ะะผะตะฝะฝะพ ะฟะพััะพะผั ะฟะพัะปะต ะฟัะธะผะตะฝะตะฝะธั floor, ะผั ะฟะพะปััะธะผ ะทะฝะฐัะตะฝะธั 0, 1 ะธะปะธ 2.

 ะญัะพ ะฒััะฐะถะตะฝะธะต ะพะฟัะตะดะตะปัะตั ะธะฝะดะตะบั ะพััะพะณะพะฝะฐะปัะฝะพะณะพ ะบะพะดะฐ `w_{n^{(\tilde{p})}_{oc}}(m)` ะธะท ัะตั ะดะฒัั ัะฐะฑะปะธั, ะบะพัะพััะต ั ะฟัะธะฒะพะดะธะป ัะฐะฝะตะต: (PHY PUCCH Format 1 Orthogonal Sequences) https://imgur.com/a/ptgfM4Z.

 3. ะขะตะฟะตัั ัะฐะทะฑะตัะตะผัั ั ะณะตะฝะตัะฐัะธะตะน cyclic shift ะดะปั `r`:  ัะพั ัะฐะผัะน `\alpha_{\tilde{p}}(n_s, l)`. ะกะฝะฐัะฐะปะฐ ะพะฟััั ะถะต ะทะฐะฟะธัั ััะพ ะผะฐัะตะผะฐัะธัะตัะบะธ:

```
\alpha_{\tilde{p}}(n_s, l) = 2\pi \cdot n^{(\tilde{p})}_{cs}(n_s, l) / N^{RB}_{sc} \\
n^{(\tilde{p})}_{cs}(n_s, l) = \begin{cases}
 (n^{cell}_{cs}(n_s, l) + (n'_{\tilde{p}}(n_s) \cdot \Delta^{PUCCH}_{shift} + (n^{(\tilde{p})}_{oc}(n_s) \mod \Delta^{PUCCH}_{shift})) \mod N' ) \mod N^{RB}_{sc} & \text{ะดะปั normal CP} \\
 (n^{cell}_{cs}(n_s, l) + (n'_{\tilde{p}}(n_s) \cdot \Delta^{PUCCH}_{shift} + n^{(\tilde{p})}_{oc}(n_s)/2) \mod N' ) \mod N^{RB}_{sc} & \text{ะดะปั extended CP}
\end{cases} \\
n^{cell}_{cs}(n_s, l) = \sum^{7}_{i=0}{c(8N^{UL}_{symb} \cdot n_s + 8l + i)} \cdot 2^i, \ c_{init} = n^{RS}_{ID}
```

  3.1. ะะฐััะผะพััะธะผ ัะฝะฐัะฐะปะฐ ะณะตะฝะตัะฐัะธั `\alpha`: ัะพัะผัะปะฐ ะพะฟัะตะดะตะปัะตั ัะผะตัะตะฝะธะต ะฟะพ ัะฐะทะต ะดะปั ะบะฐะถะดะพะณะพ ัะปะพัะฐ `n_s` ะธ ัะธะผะฒะพะปะฐ `l`. ะะปั ััะพะน ัะพัะผัะปั ะธัะฟะพะปัะทัะตััั ะฟะพัะปะตะดะพะฒะฐัะตะปัะฝะพััั `n^{(\tilde{p})}_{cs}(n_s, l)`.
  3.2. ะขะตะฟะตัั ัะฐััะผะพััะธะผ `n^{cell}_{cs}(n_s, l)`. ะะดะตัั, `c(k)` - ะฟัะตะฒะดะพัะฐะฝะดะพะผะฝัะน ะฝะฐะฑะพั ัะธัะตะป, ะบะพัะพััะน ะผั ัะถะต ะดะพ ััะพะณะพ ะผะฝะพะณะพ ัะฐะท ะฒะธะดะตะปะธ. `c_{init}` ะดะปั ะฝะตะณะพ ัะฐะบะถะต ัะบะฐะทะฐะฝ, ะพะฝ ัะฐะฒะตะฝ `n^{RS}_{ID}`, ะบะพัะพััะน ะฒ ัะฒะพั ะพัะตัะตะดั ัะฐะฒะตะฝ ัะถะต ะธะทะฒะตััะฝะพะผั ะฝะฐะผ ะทะฝะฐัะตะฝะธั `N^{cell}_{ID}`, ะปะธะฑะพ `N^{PUCCH}_{ID}`, ะบะพัะพััะน ะธะดัั ะธะท RRC Connection Reconfiguration, ะฟะพะปะต resourceToAddModList.pucch-ResourceId (ะพ RRC ะฟะพะทะถะต). ะญัะฐ ะฟะพัะปะตะดะพะฒะฐัะตะปัะฝะพััั ะณะฐัะฐะฝัะธััะตั, ััะพ cyclic shift'ั UE, ะฟะพะดะบะปัััะฝะฝัั ะบ ัะฐะทะฝัะผ ะฒััะบะฐะผ ะฑัะดัั ะฑะพะปะตะต ะฒะตัะพััะฝะพ ัะฐะทะฝัะผะธ, ัะฐะบ ะบะฐะบ ะพะฝะฐ ะทะฐะฒะธัะธั ะพั ัะฝะธะบะฐะปัะฝะพะณะพ ะธะดะตะฝัะธัะธะบะฐัะพัะฐ ะฒััะบะธ.
  3.3. `n^{(\tilde{p})}_{cs}(n_s, l)` ะบะพะผะฑะธะฝะธััะตั ะฒ ัะตะฑะต ะฒัะต ัะฐััะผะพััะตะฝะฝัะต ะฟัะตะถะดะต ะฟะพัะปะตะดะพะฒะฐัะตะปัะฝะพััะธ ัะธัะตะป ะธ ัะพะทะดะฐัั ัะฝะธะบะฐะปัะฝัั ะฟะพัะปะตะดะพะฒะฐัะตะปัะฝะพััั ะฟัะตะดัะบะฐะทัะตะผัั cyclic shift'ะพะฒ, ะบะพัะพัะฐั ัััะพะนัะธะฒะฐ ะบ ะธะฝัะตััะตัะตะฝัะธะธ ะบะฐะบ ะบ ััััะพะนััะฒะฐะผ, ะฟะพะดะบะปัััะฝะฝัะผ ะบ ะพะดะฝะพะน ะธ ัะพะน ะถะต ะฒััะบะต, ัะฐะบ ะธ ะบ ััััะพะนััะฒะฐะผ, ะฟะพะดะบะปัััะฝะฝัะผ ะบ ะดััะณะธะผ ะฒััะบะฐะผ.

ะะฐ ััะพะน ะธะปะปััััะฐัะธะธ ั ะพะฑัะตะดะตะฝะธะป ะฒัะต, ััะพ ะฑัะปะพ ัะพะปัะบะพ ััะพ ะพะฟะธัะฐะฝะพ. ะขัั ะฟัะตะดััะฐะฒะปะตะฝะฐ ะฟะพะปะฝะฐั ะฟัะพัะตะดััะฐ ะณะตะฝะตัะฐัะธะธ ัะธะผะฒะพะปะพะฒ `\zeta` ะดะปั PUCCH format 1, 1a, 1b: (PHY PUCCH Format 1) https://imgur.com/a/ptgfM4Z.

ะขะฐะบะถะต ั ัะดะตะปะฐะป ะบะพะด ะดะปั ะณะตะฝะตัะฐัะธะธ ัะธะณะฝะฐะปะฐ ะดะปั ััะพะณะพ ะบะฐะฝะฐะปะฐ, ัะฐะบ ะฑัะดะตั ะฒะพัะฟัะธะฝะธะผะฐัั ัะพัะผัะปั ะณะพัะฐะทะดะพ ะฟัะพัะต:

```
import numpy as np
from sequence.rs_sequence import generate_rs_sequence
from channels.pucch.common import get_n_cell_cs

N_PUCCH_seq = 12
N_RB_sc = 12
N_UL_symb = 7
N_PUCCH_SF = 4

modulation_tables = {
    "a": {
        (0): 1, (1): -1
    },
    "b": {
        (0, 0): 1, (0, 1): -1j,
        (1, 0): 1j, (1, 1): -1
    }
}

orthogonal_codes = {
    4: [
        np.array([1, 1, 1, 1]),
        np.array([1, -1, 1, -1]),
        np.array([1, -1, -1, 1]),
    ],
    3: [
        np.array([1, 1, 1]),
        np.array([1, np.exp(1j * 2 * np.pi / 3), np.exp(1j * 4 * np.pi / 3)]),
        np.array([1, np.exp(1j * 4 * np.pi / 3), np.exp(1j * 2 * np.pi / 3)]),
    ]
}


class Context:
    allocated_n_pucch: int
    N_cs: int
    delta_pucch_shift: int
    is_extended_cp: bool
    N_RS_ID: int

    def __init__(self, allocated_n_pucch, N_cs, delta_pucch_shift, is_extended_cp, N_RS_ID):
        self.allocated_n_pucch = allocated_n_pucch
        self.N_cs = N_cs
        self.delta_pucch_shift = delta_pucch_shift
        self.is_extended_cp = is_extended_cp
        self.N_RS_ID = N_RS_ID

def modulate(bits, format="a"):
    return modulation_tables[format][tuple(bits)]

def cyclic_shift(symb, alpha, antenna_ports):
    '''
     * symb specifies the modulated symbol "d(0)"
     * alpha specifies the cyclic shift for rs sequence
     * antenna_ports specifies the number of antenna ports "P"
    '''
    y = [0] * N_PUCCH_seq
    rs_sequence = generate_rs_sequence(N_PUCCH_seq, alpha, 0)

    for n in range(N_PUCCH_seq):
        y[n] = (1 / np.sqrt(antenna_ports)) * symb * rs_sequence[n]
    
    return y

def get_scrambling(n_s, context: Context):
    return 1 if get_n_p(n_s, context) % 2 == 0 else np.exp(1j * np.pi / 2)

def get_orthogonal_code(n_s, context: Context):
    return orthogonal_codes[N_PUCCH_SF][get_n_oc(n_s, context)]

def get_c(context: Context):
    return 3 if not context.is_extended_cp else 2

def get_cyclic_shift_resources(context: Context):
    total_cyclic_shifts = get_c(context) * context.N_cs / context.delta_pucch_shift
    is_in_orthogonal_resource = context.allocated_n_pucch < total_cyclic_shifts

    return (total_cyclic_shifts, is_in_orthogonal_resource)

def get_resource_N(context: Context):
    '''
     - generates N' for the current context
    '''
    _, is_in_orth_res = get_cyclic_shift_resources(context)
    return context.N_cs if is_in_orth_res else N_RB_sc

def get_n_p(n_s, context: Context):
    d = 2 if not context.is_extended_cp else 0
    c = get_c(context)
    total_cyclic_shifts, is_in_orthogonal_resource = get_cyclic_shift_resources(context)
    N = get_resource_N(context)

    if n_s % 2 == 0:
        if is_in_orthogonal_resource: return context.allocated_n_pucch
        return (context.allocated_n_pucch - total_cyclic_shifts) % total_cyclic_shifts
    
    h_p = (get_n_p(n_s - 1, context) + d) % total_cyclic_shifts
    if is_in_orthogonal_resource:
        return np.floor(h_p / c) + (N * (h_p % c) / context.delta_pucch_shift)
    
    return ((c * (get_n_p(n_s - 1, context) + 1)) % (total_cyclic_shifts + 1)) - 1

def get_n_oc(n_s, context: Context):
    multiplier = 1 if not context.is_extended_cp else 2
    return int(np.floor(get_n_p(n_s, context) * context.delta_pucch_shift / get_resource_N(context))) * multiplier

def get_n_cs(n_s, l, context: Context):
    n_cell_cs = get_n_cell_cs(n_s, l, context.N_RS_ID, N_UL_symb)
    n_p = get_n_p(n_s, context)
    n_oc = get_n_oc(n_s, context)
    N = get_resource_N(context)

    if not context.is_extended_cp:
        return (n_cell_cs + (n_p * context.delta_pucch_shift + (n_oc % context.delta_pucch_shift)) % N) % N_RB_sc

    return (n_cell_cs + (n_p * context.delta_pucch_shift + n_oc // 2) % N) % N_RB_sc

def get_alpha(n_s, l, context: Context):
    return 2 * np.pi * get_n_cs(n_s, l, context) / N_RB_sc

def modify_y(y, n_s, context: Context):
    zeta = [0] * (N_PUCCH_seq * N_PUCCH_SF * 2)
    for m_tick in range(2):
        for m in range(N_PUCCH_SF):
            for n in range(N_PUCCH_seq):
                orthogonal_code = get_orthogonal_code(n_s, context)
                value = get_scrambling(n_s, context) * orthogonal_code[m] * y[n]
                zeta[m_tick * N_PUCCH_SF * N_PUCCH_seq + m * N_PUCCH_seq + n] = value
    return zeta

if __name__ == "__main__":
    context = Context(
        allocated_n_pucch=3,
        N_cs=5,
        delta_pucch_shift=2,
        is_extended_cp=False,
        N_RS_ID=133
    )
    n_s = 0
    l = 0
    P = 1
    bits = (0, 1)

    modulated = modulate(bits, "b")
    alpha = get_alpha(n_s, l, context)
    y = cyclic_shift(modulated, alpha, 1)
    zeta = modify_y(y, n_s, context)

    print(zeta)
```

* 1.1.6.2.2. PUCCH Formats 2, 2a, 2b

ะคะพัะผะฐัั PUCCH 2, 2a ะธ 2b ะธัะฟะพะปัะทััััั ะดะปั ะฟะตัะตะดะฐัะธ ัะพะฒะฝะพ 20 ะฑะธั ะดะฐะฝะฝัั. 

ะะฐะฑะพั ะฑะธั `b(0),\dots,b(19)` ัะฝะฐัะฐะปะฐ ะฟัะพัะพะดะธั ััะฐะฟ Scrambling ัะพะณะปะฐัะฝะพ ะธะทะฒะตััะฝะพะน ะฝะฐะผ ัะพัะผัะปะต: `\tilde{b}(i) = (b(i) + c(i)) \mod 2`, ะณะดะต `c` - ะฟัะตะฒะดะพัะฐะฝะดะพะผะฝะฐั ะฟะพัะปะตะดะพะฒะฐัะตะปัะฝะพััั ัะธัะตะป, ะดะปั ะบะพัะพัะพะน `c_{init}` ะพะฟัะตะดะตะปัะตััั ัะปะตะดัััะธะผ ะพะฑัะฐะทะพะผ: `c_{init} = (\lfloor n_s / 2 \rfloor + 1) \cdot (2N^{cell}_{ID} + 1) \cdot 2^{16} + n_{RNTI}`.

ะะพัะปะต ััะพะณะพ ะฝะฐะฑะพั ะฑะธั `\tilde{b}(0),\dots,\tilde{b}(19)` ะผะพะดัะปะธััะตััั ั ะฟะพะผะพััั QPSK, ะฒ ัะตะทัะปััะฐัะต ะบะพัะพัะพะณะพ ะฟะพะปััะฐะตััั ะฝะฐะฑะพั 10 ะบะพะผะฟะปะตะบัะฝัั ัะธัะตะป `d(0),\dots,d(9)` (ะฒ QPSK - 2 ะฑะธัะฐ ะฝะฐ ะพะดะธะฝ RE, ะฟะพััะพะผั 10).

ะะพัะปะต ััะพะณะพ ะณะตะฝะตัะธััะตััั ัะตะทัะปััะฐั `\zeta` ัะพะณะปะฐัะฝะพ ัะพัะผัะปะต `\zeta^{(\tilde{p})}(N^{PUCCH}_{seq} \cdot n + i) = \frac{1}{\sqrt{P}} d(n) \cdot r^{(\alpha_{\tilde{p}},\delta)}_{u,v}(i)`, ะปะพะณะธะบะฐ ะทะดะตัั ัะพัะฝะพ ัะฐะบะฐั ะถะต, ะบะฐะบ ะธ ะดะปั ัะพัะผะฐัะพะฒ 1, 1a, 1b. ะัะธ ััะพะผ `n=0,1,\dots,9` ะธ `i = 0,1,\dots,N^{RB}_{sc} - 1`. ะะฝะฐัะตะฝะธะต `N^{PUCCH}_{seq} = 12`, ัะฐะบ ะถะต ะบะฐะบ ะธ ะฒ 1, 1a, 1b.

ะะฐะบ ะฒั ัะถะต ะผะพะณะปะธ ะทะฐะผะตัะธัั, ะทะดะตัั ะผั ะฝะต ะณะตะฝะตัะธััะตะผ ะฟัะพะผะตะถััะพัะฝัะน ะผะฐััะธะฒ `y`, ะฐ ััะฐะทั ะธะดัะผ ะฝะฐ ะณะตะฝะตัะฐัะธั ะณะพัะพะฒัั ัะธะผะฒะพะปะพะฒ `\zeta`. ะญัะพ ะธะท-ะทะฐ ัะพะณะพ, ััะพ ะฒ ัะพัะผะฐัะฐั 2, 2a ะธ 2b ะฝะตั ะพััะพะณะพะฝะฐะปัะฝัั ะบะพะดะพะฒ.

`\alpha` ะณะตะฝะตัะธััะตััั ะฒ ัะพะพัะฒะตัััะฒะธะธ ั ะณะตะฝะตัะฐัะธะตะน 1, 1a, 1b: `\alpha_{\tilde{p}}(n_s, l) = 2 \pi \cdot n^{(\tilde{p})}_{cs}(n_s, l) / N^{RB}_{sc}`.

`n^{(\tilde{p})}_{cs}(n_s, l)` ะณะตะฝะตัะธััะตััั ะธะฝะฐัะต: `n^{(\tilde{p})}_{cs}(n_s, l) = (n^{cell}_{cs}(n_s, l) + n'_{\tilde{p}}(n_s)) \mod N^{RB}_{sc}`. ะขัั ัะพัะผัะปะฐ ะฟัะพัะต: ะพะฝะฐ ัะพะดะตัะถะธั ะฒ ัะตะฑะต `n^{cell}_{cs}(n_s, l)`, ะบะพัะพััะน ะณะตะฝะตัะธััะตััั ัะฐะบะถะต, ะบะฐะบ ะธ ะดะปั ัะพัะผะฐัะพะฒ 1, 1a, 1b ะธ `n'_{\tilde{p}}(n_s)`. ะะดะตั ะฒ ะฝะตะน ัะฐะบะฐั ะถะต: ัะพะทะดะฐัั ะดะพััะฐัะพัะฝะพ ัะฝะธะบะฐะปัะฝัั ะฟะพัะปะตะดะพะฒะฐัะตะปัะฝะพััั cyclic shift'ะพะฒ, ะบะพัะพัะฐั ะฑัะดะตั ะผะธะฝะธะผะธะทะธัะพะฒะฐัั ะธะฝัะตััะตัะตะฝัะธั.

`n'_{\tilde{p}}(n_s)` ะณะตะฝะตัะธััะตััั ะฝะตะผะฝะพะณะพ ะธะฝะฐัะต ะฟะพ ััะฐะฒะฝะตะฝะธั ั ัะพัะผะฐัะฐะผะธ 1, 1a, 1b: 

```
n'_{\tilde{p}}(n_s) = \begin{cases}
 \begin{cases}
  n^{(2,\tilde{p})}_{PUCCH} \mod N^{RB}_{sc} & \text{ะตัะปะธ } n^{(2,\tilde{p})}_{PUCCH} < N^{RB}_{sc} N^{(2)}_{RB} \\
  (n^{(2,\tilde{p})}_{PUCCH} + N^{(1)}_{cs} + 1) \mod N^{RB}_{sc} & \text{ะธะฝะฐัะต} 
 \end{cases} & \text{ ะตัะปะธ } n_s \mod 2 = 0 \\
 \begin{cases}
  ( N^{RB}_{sc} \cdot (n'_{\tilde{p}}(n_s - 1) + 1)) \mod (N^{RB}_{sc} + 1) - 1 & \text{ะตัะปะธ } n^{(2,\tilde{p})}_{PUCCH} < N^{RB}_{sc} N^{(2)}_{RB} \\
  (N^{RB}_{sc} - n^{(2,\tilde{p})}_{PUCCH} - 2) \mod N^{RB}_{sc} & \text{ะธะฝะฐัะต}
 \end{cases} & \text{ ะตัะปะธ } n_s \mod 2 = 1
\end{cases}
```

ะขัั
 - `N^{(2)}_{RB}` - ะธะดัั ะธะท ะฟะพะปั `PUCCH-ConfigCommon.nRB-CQI` ะฒ SIB2.
 - `n^{(2,\tilde{p})}_{PUCCH}` - ะธะดัั ะธะท ะฟะพะปั `CQI-ReportPeriodic.setup.cqi-PUCCH-ResourceIndex` ะฒ RRC Connection Reconfiguration.
 - `N^{(1)}_{cs}` - ะธะดัั ะธะท ะฟะพะปั `PUCCH-ConfigCommon.nCS-AN` ะฒ SIB2.

ะะฐััะผะพััะธะผ ััะปะพะฒะธะต `n^{(2,\tilde{p})}_{PUCCH} < N^{RB}_{sc} N^{(2)}_{RB}`: ััั ัะฐััั `N^{RB}_{sc} N^{(2)}_{RB}` - ััะพ ะพะฑัะตะต ะบะพะป-ะฒะพ subcarrier'ะพะฒ, ะฒัะดะตะปะตะฝะฝัั ะฟะพะด PUCCH format 2. ะัะปะธ `n^{(2,\tilde{p})}_{PUCCH}` ะผะตะฝััะต, ัะพ ะพะฝ ะฝะฐัะพะดะธััั ะฒะฝัััะธ ัะตะณะธะพะฝะฐ ะฒัะดะตะปะตะฝะฝัั RB ะธ `n^{(2,\tilde{p})}_{PUCCH}` ะธัะฟะพะปัะทัะตััั ะฝะฐะฟััะผัั. ะะฝะฐัะต, ะบ ะฝะตะผั ะดะพะฑะฐะฒะปัะตััั `N^{(1)}_{cs} + 1`. ะญัะพ ะฝะฐะดะพ ะดะปั ัะพะณะพ, ััะพะฑั ะธะทะฑะตะถะฐัั ะบะพะปะปะธะทะธะน ั format 1, 1a, 1b, ะฒะตะดั `N^{(1)}_{cs}` - ะบะพะป-ะฒะพ cyclic shift'ะพะฒ, ะธัะฟะพะปัะทัััะธััั ะดะปั ะฟะตัะฒะพะณะพ ัะพัะผะฐัะฐ ะธ ะดะพะฑะฐะฒะปัั ััะพั ะฟะฐัะฐะผะตัั, ะผั ะบะฐะบ ะฑั ะฟัะพะฟััะบะฐะตะผ ะทะฝะฐัะตะฝะธั, ะฝะฐะทะฝะฐัะตะฝะฝัะต ะฟะตัะฒะพะผั ัะพัะผะฐัั.

ะะฐ ััะพะน ะธะปะปััััะฐัะธะธ ั ัะฐะบะถะต ัะพะฑัะฐะป ะฒัะต ัะพัะผัะปั ะฒ ะผะตััะต: (PHY PUCCH Format 2) https://imgur.com/a/ptgfM4Z.

ะ ัะตะฐะปะธะทะฐัะธั ะฒ ะบะพะดะต ะฑัะดะตั ะฒัะณะปัะดะตัั ัะฐะบ:

```
import numpy as np
import modulation, scrambling
from sequence.rs_sequence import generate_rs_sequence
from .common import get_n_cell_cs

N_PUCCH_seq = 12
N_RB_sc = 12
N_UL_symb = 7

class Context:
    def __init__(self, N_RS_ID: int, cqi_pucch_resourceIndex: int, nRB_CQI: int, nCS_AN: int):
        self.N_RS_ID = N_RS_ID
        self.cqi_pucch_resourceIndex = cqi_pucch_resourceIndex
        self.nRB_CQI = nRB_CQI
        self.nCS_AN = nCS_AN

def get_n_p(n_s, context: Context):
    is_in_region = context.cqi_pucch_resourceIndex < N_RB_sc * context.nRB_CQI
    if n_s % 2 == 0:
        if is_in_region: return context.cqi_pucch_resourceIndex % N_RB_sc
        return (context.cqi_pucch_resourceIndex + context.nCS_AN + 1) % N_RB_sc
    
    if is_in_region:
        return ((N_RB_sc * (get_n_p(n_s - 1, context) + 1)) % (N_RB_sc + 1)) - 1
    return (N_RB_sc - context.cqi_pucch_resourceIndex - 2) % N_RB_sc

def get_n_cs(n_s, l, context: Context):
    n_cell_cs = get_n_cell_cs(n_s, l, context.N_RS_ID)
    return (n_cell_cs + get_n_p(n_s, context)) % N_RB_sc

def get_alpha(n_s, l, context: Context):
    return 2 * np.pi * get_n_cs(n_s, l, context) / N_RB_sc

def cyclic_shift(d, n_s, l_start, antenna_ports, context: Context):
    zeta = np.zeros((10, N_RB_sc), dtype=complex)
    for n in range(10):
        for i in range(N_RB_sc):
            l = l_start + n
            rs_sequence = generate_rs_sequence(N_PUCCH_seq, get_alpha(n_s, l, context), 0)
            zeta[n, i] = (1 / np.sqrt(antenna_ports)) * d[n] * rs_sequence[i]
    return zeta

if __name__ == "__main__":
    N_cell_id = 133 
    context = Context(
        N_RS_ID=N_cell_id,
        cqi_pucch_resourceIndex=0,
        nRB_CQI=5,
        nCS_AN=6
    )
    n_s = 0
    l = 0
    n_rnti = 8

    bits = [0, 1, 1, 0, 1, 0, 1, 1, 1, 0, 0, 1, 0, 0, 0, 1, 0, 1, 1, 0]
    
    c_init = (int(np.floor(n_s / 2)) + 1) * (2 * N_cell_id + 1) * (2 ** 16) + n_rnti
    scrambled = scrambling.scramble(bits, c_init)
    modulated = modulation.modulate_bits(scrambled, mu=2)
    zeta = cyclic_shift(modulated, n_s, l, 1, context)
    print(zeta)
```

* 1.1.6.2.3. PUCCH format 3

PUCCH format 3 ะธัะฟะพะปัะทัะตััั ะดะปั ะฟะตัะตะดะฐัะธ 48 ะฑะธั. ะัะฟะพะปัะทัะตััั ะฒ ะพัะฝะพะฒะฝะพะผ ะดะปั CoMP ะธะปะธ Carrier Aggregation. ะะพ ะพะฑ ััะพะผ ะฟะพะทะถะต.

ะะฐ ะฒัะพะด ะฟะพัััะฟะฐะตั ะฝะฐะฑะพั ะฑะธั `b(0),\dots,b(M_{bit} - 1), \ M_{bit} = 48` ะธ ะฝะฐะด ะฝะธะผ ะพัััะตััะฒะปัะตััั Scrambling ะฒ ัะพะพัะฒะตััะฒะธะธ ัะพ Scrambling'ะพะผ ะดะปั ัะพัะผะฐัะพะฒ 2, 2a, 2b.

ะะพะดัะปััะธั ัะธะผะฒะพะปะพะฒ `\tilde{b}(0),\dots,\tilde{b}(M_{bit} - 1)` ัะพะถะต ะฟัะพัะพะดะธั ัะฐะบะถะต, ะบะฐะบ ะธ ะดะปั ัะพัะผะฐัะพะฒ 2, 2a, 2b.

ะญัะพั ัะพัะผะฐั ะธัะฟะพะปัะทัะตั ะพััะพะณะพะฝะฐะปัะฝัะต ะบะพะดั ะดะปั ะฟะพะปััะตะฝะธั `\zeta`, ะฟะพััะพะผั ะดะพะฑะฐะฒะปัะตััั ะตัั ะพะดะธะฝ ััะฐะฟ (ัะฐะบะพะต ะผั ัะถะต ะฒะธะดะตะปะธ ะฒ ัะพัะผะฐัะต 1, 1a, 1b). ะะฐะด ะฝะฐะฑะพัะพะผ ัะผะพะดัะปะธัะพะฒะฐะฝะฝัั ัะธะผะฒะพะปะพะฒ `d(0),\dots,d(M_{symb} - 1)` ะพัััะตััะฒะปัะตััั ัะปะตะดัััะฐั ะพะฟะตัะฐัะธั:

```
y^{(\tilde{p})}_n(i) = \begin{cases}
  w_{n^{(\tilde{p})}_{oc,0}}(\bar{n}) \cdot e^{j \pi \lfloor n^{cell}_{cs}(n_s, l) / 64 \rfloor / 2} \cdot d(i) & \text{ะฟัะธ } n < N^{PUCCH}_{SF,0} \\
  w_{n^{(\tilde{p})}_{oc,1}}(\bar{n}) \cdot e^{j \pi \lfloor n^{cell}_{cs}(n_s, l) / 64 \rfloor / 2} \cdot d(N^{RB}_{sc} + i) & \text{ะธะฝะฐัะต}
\end{cases}, \\
\bar{n} = n \mod N^{PUCCH}_{SF,0} \\
n = 0,\dots,N^{PUCCH}_{SF,0} + N^{PUCCH}_{SF,1} - 1 \\
i = 0,\dots,N^{RB}_{sc} - 1
```

ะะดะต:
 - `N^{PUCCH}_{SF,0} = N^{PUCCH}_{SF,1} = 5` ะฟัะธ ะธัะฟะพะปัะทะพะฒะฐะฝะธะธ normal PUCCH format 3
 - `N^{PUCCH}_{SF,0} = 5, N^{PUCCH}_{SF,1} = 4` ะฟัะธ ะธัะฟะพะปัะทะพะฒะฐะฝะธะธ shortened PUCCH format 3 

ะะฐะฒะฐะนัะต ัะฝะฐัะฐะปะฐ ัะฐะทะฑะตัะตะผัั ั ััะพะน ัะพัะผัะปะพะน:
 - `N^{PUCCH}_{SF,0}` ะธ `N^{PUCCH}_{SF,1}` - ะบะพะป-ะฒะพ SC-FDMA ัะธะผะฒะพะปะพะฒ, ะธัะฟะพะปัะทัััะธััั ะดะปั ะฟะตัะตะดะฐัะธ ะฟะตัะฒะพะน ะธะปะธ ะฒัะพัะพะน ะณััะฟะฟั ัะพะพัะฒะตััะฒะตะฝะฝะพ.
 - `\bar{n} = n \mod N^{PUCCH}_{SF,0}` - ะธะฝะดะตะบั ะฒะฝัััะธ ะพััะพะณะพะฝะฐะปัะฝะพะณะพ ะบะพะดะฐ ะดะปั ัะตะบััะตะณะพ ัะธะผะฒะพะปะฐ `n`. ะะฝ ะณะฐัะฐะฝัะธััะตั, ััะพ ะพััะพะณะพะฝะฐะปัะฝัะน ะบะพะด ะฟะพะฒัะพััะตััั ะบะฐะถะดัะต `N^{PUCCH}_{SF,0}` ัะธะผะฒะพะปะพะฒ.
 - ะ ะบะฐะถะดะพะผั ัะธะผะฒะพะปั ะฟัะธะผะตะฝัะตััั ัะฝะธะบะฐะปัะฝะพะต ะดะปั ัะพัั ัะผะตัะตะฝะธะต ะฟะพ ัะฐะทะต (ะพะฝะพ ัะฝะธะบะฐะปัะฝะพะต ะดะปั ัะพัั ะฑะปะฐะณะพะดะฐัั `n^{cell}_{cs}`. ะัะธ ััะพะผ ะดะตะปะตะฝะธะต ะฝะฐ 64 ะธ floor ะพะณัะฐะฝะธัะตะฒะฐะตั ะฒะพะทะผะพะถะฝะพะต ะบะพะป-ะฒะพ ัะผะตัะตะฝะธะน. ะญัะฐ ะพะฟะตัะฐัะธั ะฝัะถะฝะฐ ะดะปั (ะฟัะตะฒะดะพ)ัะฐะฝะดะพะผะธะทะฐัะธะธ ัะฐะทะพะฒัั ัะผะตัะตะฝะธะน ะดะปั ะบะฐะถะดะพะน ะฒััะบะธ, ัะผะตะฝััะฐั ัะฐะฝั ะธะฝัะตััะตัะตะฝัะธะธ UE, ะฟะพะดะบะปััะตะฝะฝัั ะบ ัะฐะทะฝัะผ ะฒััะบะฐะผ.
 - ะัะธ ััะพะผ ะผะพะดัะปะธัะพะฒะฐะฝะฝัะต ัะธะผะฒะพะปั ัะฐะทะฑะธัั ะฝะฐ ะดะฒะต ะณััะฟะฟั. ะะปั ะฟะตัะฒะพะน (`n < N^{PUCCH}_{SF,0}`) ะผั ะฑะตัะตะผ `d(i)`, ะฐ ะดะปั ะฒัะพัะพะน (`n \geq N^{PUCCH}_{SF,0}`) `d(N^{RB}_{sc} + i)`. ะะฐะทะฑะธะตะฝะธะต ะฝะฐ ะดะฒะต ะณััะฟะฟั ะฟะพะทะฒะพะปัะตั PUCCH format 3 ะพัะฟัะฐะฒะปััั ะฑะพะปััะตะต ะบะพะป-ะฒะพ ะดะฐะฝะฝัั ะฝะฐ ะดะฒัั ะณััะฟะฟะฐั ัะธะผะฒะพะปะพะฒ (ะธ ะดะฒัั ะณััะฟะฟะฐั ะพััะพะณะพะฝะฐะปัะฝัั ะบะพะดะพะฒ).

ะะพะผะตั ะฒะตะบัะพัะฐ ะดะปั ะพััะพะณะพะฝะฐะปัะฝะพะณะพ ะบะพะดะฐ `n_{oc}` ะณะตะฝะตัะธััะตััั ัะปะตะดัััะธะผ ะพะฑัะฐะทะพะผ:

```
n^{(\tilde{p})}_{oc,0} = n^{(3, \tilde{p})}_{PUCCH} \mod N^{PUCCH}_{SF,1} \\
n^{(\tilde{p})}_{oc,1} = \begin{cases} 
  (3n^{(\tilde{p})}_{oc, 0}) \mod N^{PUCCH}_{SF,1} & \text{ะฟัะธ } N^{PUCCH}_{SF,1} = 5 \\
  n^{(\tilde{p})}_{oc,0} \mod N^{PUCCH}_{SF,1} & \text{ะธะฝะฐัะต}
\end{cases}
```

ะขัั ะฒะธะดะฝะพ, ััะพ `n^{(\tilde{p})}_{oc,1}` ะทะฐะฒะธัะธั ะพั `n^{(\tilde{p})}_{oc,0}`. ะัะธ ััะพะผ ะฒ ัะปััะฐะต normal PUCCH format 3 `n^{(\tilde{p})}_{oc,1}` ะฑัะดะตั ะฒัะตะณะดะฐ ะพัะปะธัะฐัััั ะพั `n^{(\tilde{p})}_{oc,0}` ะฑะปะฐะณะพะดะฐัั ัะผะฝะพะถะตะฝะธั ะฝะฐ 3. ะญัะพ ะฝัะถะฝะพ ััะพะฑั ะณะฐัะฐะฝัะธัะพะฒะฐัั ัะฐะทะฝัะต ะพััะพะณะพะฝะฐะปัะฝัะต ะบะพะดั, ะดะฐะถะต ะฒ ัะปััะฐะต, ะตัะปะธ ะพะดะธะฝะฐะบะพะฒัะต ัะตััััั ะธัะฟะพะปัะทััััั ะดะปั ะดะฒัั ะณััะฟะฟ. ะขะฐะบะพะต ัะฐะทะดะตะปะตะฝะธะต ะฝะต ะฝัะถะฝะพ ะดะปั shortened PUCCH format 3, ัะฐะบ ะบะฐะบ ัะฐะผ ะฝะฐะฑะพั ะบะพะดะพะฒ ะดะปั ะฝะตะณะพ ะผะตะฝััะต. 

ะะฐะฑะพัั ะพััะพะณะพะฝะฐะปัะฝัั ะบะพะดะพะฒ ะทะฐะฟะธัะฐะฝั ะฒ ัะฐะฑะปะธัะต 36.211 5.4.2A-1: (PHY PUCCH format 3 orthogonal sequences) https://imgur.com/a/ptgfM4Z.

ะะพัะปะต ะฟะพะปััะตะฝะธั ะฝะฐะฑะพัะฐ ะทะฝะฐัะตะฝะธะน `y^{(\tilde{p})}_n(i)`, ะบ ะฝะตะผั ะฟัะธะผะตะฝัะตััั cyclic shift ัะปะตะดัััะธะผ ะพะฑัะฐะทะพะผ: `\tilde{y}^{(\tilde{p})}_n(i) = y^{(\tilde{p})}_n(i) \cdot ((i + n^{cell}_{cs}(n_s, l)) \mod N^{RB}_{sc})`. ะะธะดะฝะพ, ััะพ ะฝะพะผะตั cyclic shift'ะฐ ัะฐะบะถะต ะณะตะฝะตัะธััะตััั ั ะฟะพะผะพััั `n^{cell}_{cs}`, ั.ะต ะฝะฐะฑะพัะฐ ัะธัะตะป, ัะฝะธะบะฐะปัะฝะพะณะพ ะดะปั ะฒััะบะธ. ะญัะพ ะฟะพะผะพะณะฐะตั ะตัั ะฑะพะปััะต ัะผะตะฝััะธัั ะฒะตัะพััะฝะพััั ะธะฝัะตััะตัะตะฝัะธะธ ัะธะณะฝะฐะปะพะฒ, ะพัะพะฑะตะฝะฝะพ ะดะปั UE, ะฝะฐัะพะดััะธะผัั ะฒ ัะฐะทะฝัั ัะพัะฐั.

ะะฐัะตะผ ะฝะฐะฑะพั `\tilde{y}^{(\tilde{p})}_n(i)` ะฟัะพัะพะดะธั Transform Precoding: `\zeta^{(\tilde{p})}(n \cdot N^{RB}_{sc} + k) = \frac{1}{\sqrt{P \times N^{RB}_{sc}}} \sum^{N^{RB}_{sc} - 1}_{i = 0}{\tilde{y}^{(\tilde{p})}_n(i) e^{-j \frac{2 \pi ik}{N^{RB}_{sc}}}}`, ะฟัะธ `k = 0,\dots,N^{RB}_{sc} - 1`, `n = 0,\dots,N^{PUCCH}_{SF,0} + N^{PUCCH}_{SF,1} - 1`. ะขัั ะฒะธะดะฝะฐ ัะถะต ะทะฝะฐะบะพะผะฐั ะฝะฐะผ ะพะฟะตัะฐัะธั, ะบะพัะพััั ะผั ัะฐััะผะฐััะธะฒะฐะปะธ ะฒ PUSCH. ะะพะผะตะฝัะปัั ัะพะปัะบะพ ะบะพััะธัะธะตะฝั, ะทะดะตัั ะพะฝ ัะฐะฒะตะฝ ะฟัะพะธะทะฒะตะดะตะฝะธั ะบะพะป-ะฒะฐ ะฐะฝัะตะฝะฝ ะฝะฐ ะบะพะป-ะฒะพ subcarrier'ะพะฒ ะฒ RB. ะะฝ ะฟะพะทะฒะพะปัะตั ัะฐัะฟัะตะดะตะปะธัั ัะฝะตัะณะธั ะผะตะถะดั ะฒัะตะผะธ ะฐะฝัะตะฝะฝะฐะผะธ ะธ subcarrier'ะฐะผะธ (ัะฐะบ ะบะฐะบ ะดะปั ะฑะฐัะฐัะตะต ะฒัะณะพะดะฝะตะต, ััะพะฑั ััะผะผะฐ ะผะพัะฝะพััะธ ะฒัะตั ะฐะฝัะตะฝะฝ ะฑัะปะฐ ะบะพะฝััะฐะฝัะฝะพะน). ะขัั ััะพ ะธัะฟะพะปัะทัะตััั, ัะฐะบ ะบะฐะบ ะฒ ะดััะณะธั ัะปััะฐัั (ะฝะฐะฟัะธะผะตั PUSCH), ะผะพัะฝะพััั ะฐะฝัะตะฝะฝ ะบะพะฝััะพะปะปะธััะตััั ัะฝะฐัะฐะปะฐ TPC, ะฐ ะฟะพัะพะผ ัะถะต ะบะพััะธัะธะตะฝัะฐะผะธ DFT (ะธะผะตะฝะฝะพ TPC ะธะณัะฐะตั ัะตัะฐัััั ัะพะปั, ะบะพััะธัะธะตะฝั ัะฐะผ ะปะธัั ัะฐัะฟัะตะดะตะปัะตั ัะฝะตัะณะธั ะผะตะถะดั ััะพะฒะฝัะผะธ).

ะ ัะฝะพะฒะฐ, ั ัะดะตะปะฐะป ะธะปะปััััะฐัะธั, ะณะดะต ัะบะฐะทะฐะป ะฒัะต ะธัะฟะพะปัะทัััะธะตัั ัะพัะผัะปั ะดะปั ััะพะณะพ ัะพัะผะฐัะฐ: (PHY PUCCH Format 3) https://imgur.com/a/ptgfM4Z.

ะั ะธ ัะตะฐะปะธะทะฐัะธั ะฒ ะบะพะดะต:

```
import numpy as np
import scrambling, modulation
from ..common import transform_precoding
from .common import get_n_cell_cs

N_PUCCH_seq = 12
N_RB_sc = 12
N_UL_symb = 7

class Context:
    def __init__(self, N_RS_ID: int, is_shortened: bool, allocated_prb: int):
        self.N_RS_ID = N_RS_ID
        self.is_shortened = is_shortened
        self.allocated_prb = allocated_prb

        self.N_PUCCH_SF_0 = 5
        self.N_PUCCH_SF_1 = 4 if is_shortened else 5

orth_exp_code = lambda code: [np.exp(1j * 2 * c * np.pi / 5) for c in code]

orthogonal_codes = [
    {
        5: np.array([1, 1, 1, 1, 1]),
        4: np.array([1, 1, 1, 1])
    },
    {
        5: np.array(orth_exp_code([0, 1, 2, 3, 4])),
        4: np.array([1, -1, 1, -1])
    },
    {
        5: np.array(orth_exp_code([0, 2, 4, 1, 3])),
        4: np.array([1, 1, -1, -1])
    },
    {
        5: np.array(orth_exp_code([0, 3, 1, 4, 2])),
        4: np.array([1, -1, -1, 1])
    },
    {
        5: np.array(orth_exp_code([0, 4, 3, 2, 1]))
    }
]

def get_y_n(d, n_s, l_start, context: Context):
    total_rbs = context.N_PUCCH_SF_0 + context.N_PUCCH_SF_1
    y = np.zeros((total_rbs, N_RB_sc), dtype=complex)

    for i in range(N_RB_sc):
        for n in range(total_rbs):
            l = l_start + n
            n_bar = n % context.N_PUCCH_SF_0
            n_cell_cs = get_n_cell_cs(n_s, l, context.N_RS_ID, N_UL_symb)
            phase = np.exp(1j * np.pi * np.floor(n_cell_cs / 64) / 2)
            n_oc_0 = context.allocated_prb % context.N_PUCCH_SF_1
            if n < context.N_PUCCH_SF_0:
                y[n, i] = orthogonal_codes[n_oc_0][context.N_PUCCH_SF_1][n_bar] * phase * d[i]
            else:
                n_oc_1 = ((3 * n_oc_0) if context.N_PUCCH_SF_1 == 5 else n_oc_0) % context.N_PUCCH_SF_1
                y[n, i] = orthogonal_codes[n_oc_1][context.N_PUCCH_SF_1][n_bar] * phase * d[i + N_RB_sc]
    
    return y


def cyclic_shift(y: np.ndarray, n_s: int, l_start: int, context: Context):
    total_rbs = context.N_PUCCH_SF_0 + context.N_PUCCH_SF_1
    tilde_y = np.zeros_like(y)

    for i in range(N_RB_sc):
        for n in range(total_rbs):
            n_cell_cs = get_n_cell_cs(n_s, l_start + n, context.N_RS_ID, N_UL_symb)
            tilde_y[n, i] = y[n, i] * ((i + n_cell_cs) % N_RB_sc)

    return tilde_y

if __name__ == "__main__":
    def to_bits(n: int, length: int):
        binary = bin(n)[2:].rjust(length, "0")
        return [int(b) for b in binary]

    N_cell_id = 133
    n_rnti = 9
    context = Context(
        N_RS_ID=N_cell_id,
        is_shortened=False,
        allocated_prb=0
    )
    n_s = 0
    l = 0
    antenna_ports = 1
    bits = [
        *to_bits(5, 8),
        *to_bits(99, 8),
        *to_bits(72, 8),
        *to_bits(65, 8),
        *to_bits(162, 8),
        *to_bits(243, 8),
    ]

    c_init = (int(np.floor(n_s / 2)) + 1) * (2 * N_cell_id + 1) * (2 ** 16) + n_rnti

    scrambled = scrambling.scramble(bits, c_init)
    modulated = modulation.modulate_bits(bits, mu=2)
    orthogonal_spread = get_y_n(modulated, n_s, l, context)
    cyclic_shifted = cyclic_shift(orthogonal_spread, n_s, l, context)
    precoded = transform_precoding(cyclic_shifted, context.N_PUCCH_SF_0 + context.N_PUCCH_SF_1, N_RB_sc, 1 / np.sqrt(antenna_ports * N_RB_sc))

    print(precoded)
```

* 1.1.6.2.4. PUCCH Format 4

PUCCH format 4 ะธัะฟะพะปัะทัะตััั ะดะปั ะพัะฟัะฐะฒะบะธ UCI, HARQ-ACK, SR ะธ CSI Report, ะตัะปะธ ะพะฝะธ ะทะฐะฝะธะผะฐัั ะฑะพะปััะต 22 ะฑะธั. (ะฟัะพ ะฝะธั ะฟะพะทะถะต, ะณะปะฐะฒะฝะพะต, ััะพ ะฑะพะปััะต 22 ะฑะธั).

```
b(0),\dots,b(M_{bit} - 1)              
           โ                           
           โ                           
           โผ                           
 โโโโโโโโโโโโโโโโโโโโโ                 
 โ                   โ                 
 โ    Scrambling     โ                 
 โ                   โ                 
 โโโโโโโโโโโฌโโโโโโโโโโ                 
           โ \tilde{b}(i)              
           โผ                           
 โโโโโโโโโโโโโโโโโโโโโ                 
 โ                   โ                 
 โ    Modulation     โ                 
 โ                   โ                 
 โโโโโโโโโโโฌโโโโโโโโโโ                 
           โ d(0),\dots,d(M_{symb} - 1)
           โผ                           
 โโโโโโโโโโโโโโโโโโโโโ                 
 โ     Transform     โ                 
 โ     Precoding     โ                 
 โ                   โ                 
 โโโโโโโโโโโโโโโโโโโโโ                 
```

ะะปั ััะพะณะพ ัะพัะผะฐัะฐ ะฟัะพะธะทะฒะพะดัััั ะพะฟะตัะฐัะธะธ (ะฒ ะดะฐะฝะฝะพะผ ะฟะพััะดะบะต): Scrambling, Modulation, Transform Precoding. ะัะปะธัะฐะตััั ะพั Format 3 ัะพะปัะบะพ Transform Precoding. ะ ัะพ ัะพะปัะบะพ ะบะพััะธัะธะตะฝัะฐะผะธ ะธ ะฟะตัะตะผะตะฝะฝัะผะธ. ะะพััะพะผั ะฒะทะณะปัะฝะตะผ ัะพะปัะบะพ ะฝะฐ Transform Precoding:

```
\zeta^{(\tilde{p})}(l \cdot M^{PUCCH4}_{sc} + k) = \frac{1}{\sqrt{M^{PUCCH4}_{sc}}} \sum^{M^{PUCCH4}_{sc} -1}_{i=0}{d(l \cdot M^{PUCCH4}_{sc} + i)}e^{-j\frac{\pi i k}{M^{PUCCH4}_{sc}}} \\
k = 0,\dots,M^{PUCCH4}_{sc} - 1, \\
l = 0,\dots,N^{PUCCH}_{0} + N^{PUCCH}_{1} - 1
```

ะกัะพะธั ััะฐะทั ะพัะผะตัะธัั, ััะพ PUCCH format 4 ัะฐะฑะพัะฐะตั ัะพะปัะบะพ ั ะพะดะฝะพะน ะฐะฝัะตะฝะฝะพะน, ั.ะต `\tilde{p} = 0`.

ะัะธ ััะพะผ ะฟะฐัะฐะผะตััั `N^{PUCCH}_{0}, N^{PUCCH}_{1}` ะดะฐะฝั ะฒ ัะฐะฑะปะธัะต 36.211 5.4.2C-1: (PHY PUCCH Formats 4,5 N_PUCCH_m) https://imgur.com/a/ptgfM4Z. ะกัะผะผะฐ ััะธั ะฟะฐัะฐะผะตััะพะฒ - ะบะพะป-ะฒะพ ะณััะฟะฟ, ะฝะฐ ะบะพัะพััะต ะฑัะปะธ ัะฐะทะฑะธัั ัะผะพะดัะปะธัะพะฒะฐะฝะฝัะต ัะธะผะฒะพะปั d(i). ะญัะพ ัะฐะทะฑะธะตะฝะธะต ะพััะฐะถะตะฝะพ ะฒ ัะพัะผัะปะต ะบะฐะบ ะฟะพะปััะตะฝะธะต ัะปะตะผะตะฝัะฐ ะบะฐะบ ะฑัะดัะพ ะธะท ะดะฒัะผะตัะฝะพะน ะผะฐััะธัั `d` ัะพ ััะพัะพะฝะฐะผะธ `N^{PUCCH}_{0} + N^{PUCCH}_{1}` ััะดะพะฒ ะธ `M^{PUCCH4}_{sc}` ััะพะปะฑัะพะฒ: `l \cdot M^{PUCCH4}_{sc} + i`.

ะัั ะผะพะถะฝะพ ะฑัะปะพ ะทะฐะผะตัะธัั ะฟะฐัะฐะผะตัั `M^{PUCCH4}_{sc}`. ะะณะพ ะผะพะถะฝะพ ะฟะพะปััะธัั ัะปะตะดัััะธะผ ะพะฑัะฐะทะพะผ: `M^{PUCCH4}_{sc} = M^{PUCCH4}_{RB} \times N^{RB}_{sc}`. ะขัั `M^{PUCCH4}_{RB}` ัะฐะฒะตะฝ ัะธัะปั RB, ะฒัะดะตะปะตะฝะฝัั ะดะปั ัะตะบััะตะน ะฟะตัะตะดะฐัะธ PUCCH format 4. ะงัะพะฑั ะฟะพะฝััั ะพัะบัะดะฐ `M^{PUCCH4}_{RB}` ะธะดัั, ะพะฑัะฐัะธะผัั ะบ ัะฟะตัะธัะธะบะฐัะธะธ 36.213. ะ ัะตะบััะต 10.1.1 ัะบะฐะทะฐะฝะพ, ััะพ ะฝะฐะดะพ ัะผะพััะตัั ะฝะฐ ัะฐะฑะปะธัั 10.1.1-2:

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฆโโโโโโโโโโโโโโโ
โ numberOfPRB-format4          โ M PUCCH4 RB  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโฃ
โ 0                            โ      1       โ
โ 1                            โ      2       โ
โ 2                            โ      3       โ
โ 3                            โ      4       โ
โ 4                            โ      5       โ
โ 5                            โ      6       โ
โ 6                            โ      8       โ
โ 7                            โ  Reserved    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฉโโโโโโโโโโโโโโโ
```

ะะฐัะฐะผะตัั `numberOfPRB-format4` ะพะฟะธัะฐะฝ ะฝะต ะฒ ะฟะพัะปะตะดะฝะตะผ ัะตะปะธะทะต 36.331 (ะพัะบัะดะฐ ั ะฑะตัั ะพะฟะธัะฐะฝะธั SIB2). ะะฝ ะพะฟะธัะฐะฝ ะฒ ัะตะปะธะทะต 36.331 13.5.0 ะธ ะฝะฐัะพะดะธััั ะฒ ะฟะพะปะต `PUCCH-Config.PUCCH-ConfigDedicated.pucch-Format.format4.format4-resourceConfiguration.numberOfPRB-format4` ะฒ SIB2.

ะะปั ััะพะณะพ ัะพัะผะฐัะฐ ัะดะตะปะฐะป ัะพะปัะบะพ ัะตะฐะปะธะทะฐัะธั ะฒ ะบะพะดะต (ััั ะพัะตะฝั ะผะฝะพะณะพ ะฟะพะฒัะพััััะธััั ัะฐััะตะน, ะฟะพััะพะผั ะฝะตั ัะผััะปะฐ ะดะตะปะฐัั ะธะปะปััััะฐัะธั):

```
import numpy as np
import modulation, scrambling
from ..common import transform_precoding

N_PUCCH_seq = 12
N_RB_sc = 12
N_UL_symb = 7

class Context:
    def __init__(self, N_RS_ID: int, is_shortened: bool, is_extended_cp: bool, M_PUCCH4_RB: int):
        self.N_RS_ID = N_RS_ID
        self.is_shortened = is_shortened
        self.is_extended_cp = is_extended_cp
        self.M_PUCCH4_RB = M_PUCCH4_RB
        self.M_PUCCH4_SC = M_PUCCH4_RB * N_RB_sc

        if is_extended_cp and not is_shortened: self.N_PUCCH_0 = self.N_PUCCH_1 = 5
        if is_extended_cp and is_shortened: 
            self.N_PUCCH_0 = 5 
            self.N_PUCCH_1 = 4
        
        if not is_extended_cp and not is_shortened: self.N_PUCCH_0 = self.N_PUCCH_1 = 6
        if not is_extended_cp and is_shortened:
            self.N_PUCCH_0 = 0
            self.N_PUCCH_1 = 5

if __name__ == "__main__":
    N_cell_id = 133
    n_rnti = 9
    context = Context(
        N_RS_ID=N_cell_id,
        is_shortened=False,
        is_extended_cp=False,
        M_PUCCH4_RB=1
    )
    n_s = 0
    l = 0
    antenna_ports = 1
    M_bit = context.M_PUCCH4_RB * N_RB_sc * (context.N_PUCCH_0 + context.N_PUCCH_1) * 2
    bits = np.random.binomial(1, 0.5, size=(M_bit))

    c_init = (int(np.floor(n_s / 2)) + 1) * (2 * N_cell_id + 1) * (2 ** 16) + n_rnti

    scrambled = scrambling.scramble(bits, c_init)
    modulated = modulation.modulate_bits(bits, mu=2)
    precoded = transform_precoding(modulated, context.N_PUCCH_0 + context.N_PUCCH_1, context.M_PUCCH4_SC, 1 / np.sqrt(context.M_PUCCH4_SC))

    print(precoded)
```

ะัะธ ััะพะผ ั ะธัะฟะพะปัะทัั `transform_precoding` ะฒ ัะฐะบะพะผ ะฒะธะดะต:

```
import numpy as np

def transform_precoding(x: np.ndarray, rows: int, cols: int, coef: int):
    grouped = x.reshape((rows, cols))
    y = np.zeros_like(x, dtype=complex)

    for l in range(grouped.shape[0]):
        fft = np.fft.fft(grouped[l])
        y[l * cols : (l + 1) * cols] = coef * fft

    return y
```

* 1.1.6.2.5. PUCCH Format 5

PUCCH Format 5 ะธัะฟะพะปัะทัะตััั ะฒ ัะตั ะถะต ัะปััะฐัั, ััะพ ะธ format 4. ะะดะฝะฐะบะพ ั ะฝะตะณะพ ะตััั ะฟัะตะธะผััะตััะฒะพ: ะพะฝ ะฟะพะดะดะตัะถะธะฒะฐะตั ะพััะพะณะพะฝะฐะปัะฝัะต ะบะพะดั. ะข.ะต ะฟะพะทะฒะพะปัะตั ะทะฐะฟะธัะฝััั ะฑะพะปััะต ะดะฐะฝะฝัั ะฒ ะพะดะฝะพ ะธ ัะพ ะถะต ะบะพะป-ะฒะพ RE.

```
b(0),\dots,b(M_{bit} - 1)              
           โ                           
           โ                           
           โผ                           
 โโโโโโโโโโโโโโโโโโโโโ                 
 โ                   โ                 
 โ    Scrambling     โ                 
 โ                   โ                 
 โโโโโโโโโโโฌโโโโโโโโโโ                 
           โ \tilde{b}(i)              
           โผ                           
 โโโโโโโโโโโโโโโโโโโโโ                 
 โ                   โ                 
 โ    Modulation     โ                 
 โ                   โ                 
 โโโโโโโโโโโฌโโโโโโโโโโ                 
           โ d(0),\dots,d(M_{symb} - 1)
           โผ                           
 โโโโโโโโโโโโโโโโโโโโโ                 
 โ     Block-wise    โ                 
 โ     Spreading     โ                 
 โ                   โ                 
 โโโโโโโโโโโฌโโโโโโโโโโ                 
           โ y_n(i)                    
           โผ                           
 โโโโโโโโโโโโโโโโโโโโโ                 
 โ     Transform     โ                 
 โ     Precoding     โ                 
 โ                   โ                 
 โโโโโโโโโโโโโโโโโโโโโ                 
```

ะกะฝะฐัะฐะปะฐ ะฝะฐะด ะฝะฐะฑะพัะพะผ ะฒัะพะดะฝัั ะฑะธั ะฟัะพะธะทะฒะพะดัััั ัะถะต ะทะฝะฐะบะพะผัะต ะพะฟะตัะฐัะธะธ Scrambling ะธ Modulation. ะะฝะธ ะฟัะพะธะทะฒะพะดัััั ะฒ ะฟะพะปะฝะพะผ ัะพะพัะฒะตััะฒะธะธ ั format 4. ะะดะฝะฐะบะพ ะฟะพัะปะต ััะธั ััะฐะฟะพะฒ ะธ ะฟะตัะตะด Transform Precoding ะดะพะฑะฐะฒะปัะตััั ะตัั ะพะดะธะฝ ะฝะตะผะฐะปะพะฒะฐะถะฝัะน ััะฐะฟ: Block-wise Spreading.

ะกะฝะฐัะฐะปะฐ ะทะฐะฟะธัั ะตะณะพ ะผะฐัะตะผะฐัะธัะตัะบะธ:

```
y_n(i) = w_{n_{oc}}(i) \cdot d(\frac{(i \mod N^{RB}_{sc}) + n \cdot N^{RB}_{sc}}{N^{PUCCH}_{SF}}) \\
n = 0,\dots,N^{PUCCH}_{0} + N^{PUCCH}_{1} - 1 \\ 
i = 0,\dots,N^{RB}_{sc}
```

ะะดะต:
 - `N^{PUCCH}_{SF} = 2`
 - `N^{PUCCH}_{0}, N^{PUCCH}_{1}` ะฟะพะปััะฐัััั ัะฐะบะถะต, ะบะฐะบ ะธ ะดะปั format 4.
 - `n_{oc}` - ะธะฝะดะตะบั ะฒ ัะฐะฑะปะธัะต 36.211 5.4.2C-2: (PHY PUCCH Format 5 orthogonal sequences) https://imgur.com/a/ptgfM4Z. ะะปั ััะพะณะพ ะฟะฐัะฐะผะตััะฐ ะฝะตั ัะพัะผัะปั ะดะปั ะณะตะฝะตัะฐัะธะธ. ะะพะผะตั ะพััะพะณะพะฝะฐะปัะฝะพะณะพ ะบะพะดะฐ ะธะดัั ะธะท RRC Connection Reconfiguration, ะฟะพะปั `PUCCH-Config.cdm-index-format5` (ะพะฝ ัะพะถะต ะพะฟะธัะฐะฝ ะฒ 36.331 13.5.0, ั.ะต ะฝะต ะฒ ะฟะพัะปะตะดะฝะตะน ัะตะฒะธะทะธะธ). 

ะขัั ะฟะพะปััะตะฝะธะต ะธะฝะดะตะบัะฐ `\frac{(i \mod N^{RB}_{sc}) + n \cdot N^{RB}_{sc}}{N^{PUCCH}_{SF}}` - ััะพ ัะฐะบะฐั ะถะต ะพะฟะตัะฐัะธั ะธะฝะดะตะบัะฐัะธะธ ะฟะพ ะผะฐััะธัะต. ะะฝะฐ ะณะพะฒะพัะธั ะพ ัะพะผ, ััะพ ะฟะตัะตะด ััะธะผ ััะฐะฟะพะผ `d` ัะฐะทะฑะธะฒะฐะตััั ะฝะฐ `N^{PUCCH}_{0} + N^{PUCCH}_{1}` ะณััะฟะฟ. ะะฐะถะดะฐั ะณััะฟะฟะฐ ะทะฐะฝะธะผะฐะตั ัะฒะพั ะผะตััะพ ะฟะพ subcarrier'ะฐะผ, ั.ะต ะฟะพ ะพะดะฝะพะผั SC-FDMA ัะธะผะฒะพะปั. ะัะธะผะตะฝะตะฝะธะต ะพััะพะฝะณะพะฝะฐะปัะฝะพะณะพ ะบะพะดะฐ ัะฐะบะถะต ะพัััะตััะฒะปัะตััั ะฟะพ ะพะดะฝะพะผั SC-FDMA ัะธะผะฒะพะปั. ะัะธัะตะผ ะฒ ัะพัะผัะปะต, ะดะตะปะตะฝะธะต ะฝะฐ `N^{PUCCH}_{SF}` ะพะฟัะตะดะตะปัะตั ัะบะพะปัะบะพ ัะธะผะฒะพะปะพะฒ ะฑัะดัั ะฝะฐะทะฝะฐัะตะฝั ะฒ ะพะดะธะฝ ะธ ัะพั ะถะต ัะปะตะผะตะฝั. ะ ัะปััะฐะต 2, ะธั ะบะพะปะธัะตััะฒะพ ัะพะถะต ะฑัะดะตั ัะฐะฒะฝะพ ะดะฒัะผ. ะญัะพ ะฟัะพะธััะพะดะธั ะธะท-ะทะฐ ัะพะณะพ, ััะพ ะฟัะธ ะฟะตัะตะฒะพะดะต ะฒ int, ัะพะฒะฝะพ ะดะปั ะฟะพะปะพะฒะธะฝั ัะธัะตะป ะธะฝะดะตะบั ะฝะต ะฑัะดะตั ะผะตะฝััััั. 

ะะพัะปะต ััะพะณะพ ะฟะพะปััะตะฝะฝัะต ัะธะผะฒะพะปั ะฟัะพัะพะดัั ัะตัะตะท ัะถะต ะธะทะฒะตััะฝัะน ััะฐะฟ Transform Precoding, ะฒ ะบะพัะพัะพะผ ะพัะปะธัะฐะตััั ัะพะปัะบะพ ะบะพััะธัะธะตะฝั:

```
\zeta^{(\tilde{p})}(n \cdot N^{RB}_{sc} + k) = \frac{1}{\sqrt{N^{RB}_{sc}}} \sum^{N^{RB}_{sc} - 1}_{i=0}{y_n(i)e^{-j\frac{2 \pi ik}{N^{RB}_{sc}}}} \\
k = 0,\dots,N^{RB}_{sc} - 1 \\
n = 0,\dots,N^{PUCCH}_{0} + N^{PUCCH}_{1} - 1 
```

ะญัะพั ัะพัะผะฐั ัะฐะบะถะต ัะฐะฑะพัะฐะตั ัะพะปัะบะพ ั ะพะดะฝะพะน ะฐะฝัะตะฝะฝะพะน, ั.ะต `\tilde{p} = 0`.

ะะปั ััะพะณะพ ัะพัะผะฐัะฐ ั ัะถะต ัะดะตะปะฐะป ะธะปะปััััะฐัะธั: (PHY PUCCH Format 5) https://imgur.com/a/ptgfM4Z.

ะ ัะตะฐะปะธะทะฐัะธั ะฒ ะบะพะดะต:

```
import numpy as np
import modulation, scrambling
from ..common import transform_precoding
from .format_4 import Context

N_PUCCH_seq = 12
N_RB_sc = 12
N_UL_symb = 7
N_PUCCH_SF = 2

orthogonal_codes = [
    [1] * 12,
    [1] * 6 + [-1] * 6
]

def block_wise_spread(d: np.ndarray, n_oc, context: Context):
    y = np.zeros((context.N_PUCCH_0 + context.N_PUCCH_1, N_RB_sc), dtype=complex)
    for n in range(y.shape[0]):
        for i in range(N_RB_sc):
            y[n, i] = orthogonal_codes[n_oc][i] * d[int((i + n * N_RB_sc) / N_PUCCH_SF)]
    return y

if __name__ == "__main__":
    N_cell_id = 133
    n_rnti = 9
    context = Context(
        N_RS_ID=N_cell_id,
        is_shortened=False,
        is_extended_cp=False,
        M_PUCCH4_RB=1
    )
    n_s = 0
    l = 0
    n_oc = 0
    M_bit = N_RB_sc * (context.N_PUCCH_0 + context.N_PUCCH_1)
    bits = np.random.binomial(1, 0.5, size=(M_bit))

    c_init = (int(np.floor(n_s / 2)) + 1) * (2 * N_cell_id + 1) * (2 ** 16) + n_rnti

    scrambled = scrambling.scramble(bits, c_init)
    modulated = modulation.modulate_bits(bits, mu=2)
    spread = block_wise_spread(modulated, n_oc, context)
    precoded = transform_precoding(spread, context.N_PUCCH_0 + context.N_PUCCH_1, N_RB_sc, 1 / np.sqrt(context.M_PUCCH4_SC))

    print(precoded)
```

* 1.1.6.2.6. PUCCH Mapping to resource elements

Resource Element Mapper ะฑะตัะตั ะฝะฐ ะฒัะพะด ัะธะผะฒะพะปั `\zeta^{(\tilde{p})}(0),\dots,\zeta^{(\tilde{p})}(i)` ะธ ะฝะฐะทะฝะฐัะฐะตั ะบะฐะถะดัะน ะบ RE ะฒ ะฟะพะทะธัะธะธ (k, l) ะฝะฐ ะฐะฝัะตะฝะฝะต ั ะฝะพะผะตัะพะผ `p`, ะฟัะธ ััะพะผ ัะฝะฐัะฐะปะฐ ัะฒะตะปะธัะธะฒะฐะตััั `k`, ะทะฐัะตะผ `l`, ะทะฐัะตะผ slot.

ะะปั ะฝะฐะทะฝะฐัะตะฝะธั RE ะฒ PUCCH ะธัะฟะพะปัะทััััั ะฝะพะผะตัะฐ PRB ะฒะฝัััะธ ะพะดะฝะพะณะพ slot. ะะฟัะตะดะตะปัะตััั ะฝะพะผะตั ัะปะตะดัััะธะผ ะพะฑัะฐะทะพะผ:

```
n_{PRB}(n_s) = \begin{cases}
 \lfloor m/2 \rfloor & \text{ะตัะปะธ } (m + (n_s \mod 2)) \mod 2 = 0 \\
 N^{UL}_{RB} - \lfloor \frac{1}{2}m \rfloor -1 & \text{ะธะฝะฐัะต}
\end{cases}
```

ะะท ัะพัะผัะปั ะฒะธะดะฝะพ, ััะพ ะพะฝะฐ ะทะฐะฒะธัะธั ะพั ะฝะพะผะตัะฐ ัะปะพัะฐ `n_s` ะธ ะผะตะฝัะตั ัะฒะพั ะฟะพะฒะตะดะตะฝะธะต ะฒ ะทะฐะฒะธัะธะผะพััะธ ะพั ัััะฝะพััะธ ััะพะณะพ ะฟะฐัะฐะผะตััะฐ. ะ ัะฐััะฝะพััะธ, ะตัะปะธ `n_s \mod 2 = 0` (ั.ะต ัะตัะฝัะน), ัะพ ะฒะตัั PUCCH ะฑัะดะตั ะฝะฐัะพะดะธัััั ะฒะฝะธะทั RG (ั.ะต ัะฐัะฟะพะปะพะถะตะฝะธะต ะฟะพ ัะฐััะพัะต ะฑัะดะตั ะฝะธะถะต ะฒ RG). ะะฝะฐัะต, ะฒะตัั PUCCH ะฑัะดะตั ะฝะฐัะพะดะธััั ะฒะฒะตััั RG. ะญัะพ ั ะพัะพะฑัะฐะทะธะป ะฝะฐ ะดะธะฐะณัะฐะผะผะต: (PHY PUCCH Resource Element Mapping) https://imgur.com/a/ptgfM4Z.

ะขะตะฟะตัั ะฝะฐะดะพ ะฟะพะฝััั ะบะฐะบ ะณะตะฝะตัะธััะตััั `m` ะธ ะบะฐะบ ะพะฝ ะฒะปะธัะตั ะฝะฐ ะฟะพะปะพะถะตะฝะธะต PUCCH. ะะตะฝะตัะฐัะธั `m` ะทะฐะฒะธัะธั ะพั ัะพัะผะฐัะฐ PUCCH:

 1. ะะปั ัะพัะผะฐัะพะฒ 1, 1a, 1b ะธัะฟะพะปัะทัะตััั ัะปะตะดัััะฐั ัะพัะผัะปะฐ:

```
m = \begin{cases}
 N^{(2)}_{RB} & \text{ะตัะปะธ } n^{(1,\tilde{p})}_{PUCCH} < c \cdot N^{(1)}_{cs} / \Delta^{PUCCH}_{shift} \\
 \biggl\lfloor \frac{n^{(1, \tilde{p})}}{c \cdot N^{RB}_{sc} / \Delta^{PUCCH}_{shift}} - 1 \biggl\rfloor + \lceil N^{(1)}_{cs} / 8 \rceil + N^{(2)}_{RB} & \text{ะธะฝะฐัะต}
\end{cases}
```
  ะะดะต:
   - `N^{(2)}_{RB}` - ะบะพะป-ะฒะพ RB, ะฒัะดะตะปะตะฝะฝัั ะดะปั ะฟะตัะตะดะฐัะธ PUCCH format 2, 2a, 2b.
   - `c = 3` ะฟัะธ normal CP, `c = 2` ะฟัะธ extended CP.

 ะขัั ะพะฟััั ะถะต, ัะพัะผัะปะฐ ัะฐะทะฑะธัะฐ ะฝะฐ ะดะฒะต ัะฐััะธ. ะะดะฝะฐ (ะฟะตัะฒะฐั) ะฒัะฟะพะปะฝัะตััั ะตัะปะธ ะฒัะดะตะปะตะฝะฝัะต ัะตััััั (ั.ะต ะธะฝะดะตะบั ัะตััััะพะฒ PUCCH format 1) ะฝะฐัะพะดัััั ะฒ ัะฐะผะบะฐั ะพััะพะณะพะฝะฐะปัะฝัั ัะตััััะพะฒ. ะััะณะธะผะธ ัะปะพะฒะฐะผะธ, ะตัะปะธ ะฝะต ััะตะฑัะตััั ะฑะพะปััะต RE ะดะปั ะพัะฟัะฐะฒะบะธ ะดะฐะฝะฝัั, ัะพ ะผั ะฟัะพััะพ ะธัะฟะพะปัะทัะตะผ RB ะบะพะฝัะฐ PUCCH format 2 ะบะฐะบ ะฝะฐัะฐะปะพ format 1.
 ะัะปะธ ะถะต `n^{(1,\tilde{p})}_{PUCCH}` ะฒััะพะดะธั ะทะฐ ัะฐะผะบะธ ะพััะพะณะพะฝะฐะปัะฝัั ัะตััััะพะฒ, ัะพ ะฒัะฟะพะปะฝัะตััั ะฒัะพัะฐั ัะฐััั ัะพัะผัะปั:
  - `\biggl\lfloor \frac{n^{(1, \tilde{p})}}{c \cdot N^{RB}_{sc} / \Delta^{PUCCH}_{shift}} - 1 \biggl\rfloor` ะพะฟัะตะดะตะปัะตั ะบะพะป-ะฒะพ ัะตะณะธะพะฝะพะฒ ั ะดะพัััะฟะฝัะผะธ ะพััะพะณะพะฝะฐะปัะฝัะผะธ ัะตััััะฐะผะธ ะบะพัะพััะต ะผั ัะถะต ะธัะฟะพะปัะทะพะฒะฐะปะธ.
  - `\lceil N^{(1)}_{cs} / 8 \rceil` ะฝะตะพะฑัะพะดะธะผ ะดะปั ะฑะพะปััะตะณะพ ัะฐะทะดะตะปะตะฝะธั PUCCH format 1 ะพั ะดััะณะธั ะบะฐะฝะฐะปะพะฒ.

 2. ะะปั ัะพัะผะฐัะพะฒ 2, 2a, 2b ะธัะฟะพะปัะทัะตััั ะดะพะฒะพะปัะฝะพ ะฟัะพััะฐั ัะพัะผัะปะฐ: `m = \lfloor n^{(2, \tilde{p})}_{PUCCH} / N^{RB}_{sc} \rfloor`. ะะฝะฐ ะฒัะฟะพะปะฝัะตั ะฟัะพัััั ััะฝะบัะธั: ะดะฐัั ะฒะพะทะผะพะถะฝะพััั ะบ ะฟะพัะปะตะดะพะฒะฐัะตะปัะฝะพะผั ะฝะฐะทะฝะฐัะตะฝะธั PRB.
 3. ะะปั ัะพัะผะฐัะฐ 3 ะธัะฟะพะปัะทัะตััั ัะฐะบะถะต ะฟัะพััะฐั ัะพัะผัะปะฐ: `m = \lfloor n^{(3, \tilde{p})}_{PUCCH} / N^{PUCCH}_{SF,0}`. ะะพะณะธะบะฐ ัะฐะบะฐั ะถะต.
 4. ะะปั ัะพัะผะฐัะฐ 5 ะธัะฟะพะปัะทัะตััั ัะพัะผัะปะฐ ะตัั ะฟัะพัะต: `m = n^{(5)}_{PUCCH}`, ะณะดะต `n^{(5)}_{PUCCH}` - ะฒัะดะตะปะตะฝะฝัะน ะธะฝะดะตะบั PUCCH.

ะั ะผะพะณะปะธ ะทะฐะผะตัะธัั, ััะพ ะทะดะตัั ะฝะต ะฑัะปะพ ัะพัะผะฐัะฐ 4. ะะปั ะฝะตะณะพ ะดะตะนััะฒัะตั ะฝะตะผะฝะพะณะพ ะดััะณะฐั ะฟัะพัะตะดััะฐ:

```
n_{PRB}(n_s) = \begin{cases}
  m & \text{ะฟัะธ } n_s \mod 2 = 0 \\
  N^{UL}_{RB} - m - 1 & \text{ะธะฝะฐัะต}
\end{cases}
```

ะขัั `m` ะฝะฐะฟััะผัั ะณะตะฝะตัะธััะตััั ะพั `n^{(4)}_{PUCCH}`: `m = n^{(4)}_{PUCCH},\dots,n^{(4)}_{PUCCH} + M^{PUCCH4}_{RB} - 1`. ะะฝ ะผะตะฝัะตั ัะฒะพั ะทะฝะฐัะตะฝะธะต ะฒ ัะฐะผะบะฐั ะทะฐะดะฐะฝะฝะพะณะพ ัะตะณะธะพะฝะฐ ะฒ ะทะฐะฒะธัะธะผะพััะธ ะพั `n_s`. ะ ะธะผะตะฝะฝะพ ัะฒะตะปะธัะธะฒะฐะตั ัะผะตัะตะฝะธะต, ั.ะต ัะตะผ ะฑะพะปััะต `n_s`, ัะตะผ ะฑะพะปััะต `m`. ะะฐัะตะผะฐัะธัะตัะบะธ ะผะพะถะฝะพ ะทะฐะฟะธัะฐัั ััะพ ัะฐะบ: `m = n^{(4)}_{PUCCH} + n_s, m < n^{(4)}_{PUCCH} + M^{PUCCH4}_{RB}`.

ะขะฐะบะพะต ะธะทะผะตะฝะตะฝะธะต ะพั ะดะตัะพะปัะฝะพะณะพ ะผะตัะพะดะฐ ัะฒะปัะตััั ะฒะธะดะพะผ ะพะฟัะธะผะธะทะฐัะธะธ. ะะพะดัะฐะทัะผะตะฒะฐะตััั, ััะพ ะดะตะปะตะฝะธะต m ะฝะฐ ะดะฒะฐ ัะถะต ะฒะบะปััะตะฝะพ ะฒ `n^{(4)}_{PUCCH}` (ั.ะต ะฒ PRB ะฝะพะผะตั ะดะปั format 4)

ะะฐ ัะปะตะดัััะตะน ะธะปะปััััะฐัะธะธ ั ะธะทะพะฑัะฐะทะธะป ะบะฐะบ ะฑัะดะตั ะฒัะณะปัะดะตัั ัะฐัะฟัะตะดะตะปะตะฝะธะต ัะพัะผะฐัะพะฒ PUCCH ะดะปั ัะฐะผะพะน ัะฐัะฟัะพัััะพะฝัะฝะฝะพะน ะบะพะฝัะธะณััะฐัะธะธ (ััั ั ะตัั ะฟะพะดะฟะธัะฐะป ะบะฐะบะธะผ ะฟะฐัะฐะผะตััะฐะผ ัะพะพัะฒะตััะฒััั ะบะฐะบะธะต ะฟะตัะตะผะตะฝะฝัะต ะฒ ัะพัะผัะปะฐั):

```c
// -- SIB2 --

ul-Bandwidth = 50; // N^{UL}_{RB} = 50 (ะดะปั BW=10 MHz)

PUCCH-ConfigCommon = {
    deltaPUCCH-Shift = ds2; // \Delta^{PUCCH}_{shift} = 2
    nRB-CQI          = 1;  // N^{(2)}_{RB} = 1 (ะบะพะป-ะฒะพ RB, ะฒัะดะตะปะตะฝะฝัั ะดะปั format 2/2a/2b)
    nCS-AN           = 0;  // N^{(1)}_{cs} = 0 (ะบะพะป-ะฒะพ cyclic shift'ะพะฒ ะดะปั RE ัะพัะผะฐัะพะฒ 1/1a/1b)
    
    pucch-Format5-r13 = {
        format5-enabled = TRUE;
    };
}

// -- RRCConnectionReconfiguration-NB --

CQI-ReportPeriodic = {
  cqi-PUCCH-ResourceIndex = 0; // n^{(2, \tilde{p})}_{PUCCH} (resource index ะดะปั ัะพัะผะฐัะพะฒ 2/2a/2b)
}

PUCCH-Format3-Conf = {
  twoAntennaPortActivatedPUCCH-Format3-r13 = {
    n3PUCCH-AN-ListP1-r13 = {
      0, // n^{(3, \tilde{p})}_{PUCCH} = 0 (resource index ะดะปั ัะพัะผะฐัะฐ 3)
    }
  }
}

Format4-resource-r13 = {
  startingPRB-format4-r13 = 2; // n^{(4)}_{PUCCH} = 2 (resource index ะดะปั ัะพัะผะฐัะฐ 4)
  numberOfPRB-format4-r13 = 1; // M^{PUCCH4}_{RB} = 1 (ะบะพะป-ะฒะพ RB ะดะปั ัะพัะผะฐัะฐ 4)
};

Format5-resource-r13 = {
  startingPRB-format5 = 3; // n^{(5)}_{PUCCH} = 3 (resource index ะดะปั ัะพัะผะฐัะฐ 5)
  cdm-index-format5-r13 = 0; // n_{oc} (ะฝะพะผะตั ะพััะพะณะพะฝะฐะปัะฝะพะณะพ ะบะพะดะฐ ะดะปั ัะพัะผะฐัะฐ 5)
}

CP-Type       = Normal CP;
N_RB_sc       = 12;
N_UL_symb     = 7;
Antenna-Ports = 1; // ะบะพะป-ะฒะพ ะฐะฝัะตะฝะฝ = 1
```

(PHY PUCCH Resource Element Mapping Default Configuration) https://imgur.com/a/ptgfM4Z.

-------

ะะพั ะผั ะธ ัะฐะทะพะฑัะฐะปะธัั ั Uplink ะบะฐะฝะฐะปะฐะผะธ. ะะฐ ะพัะตัะตะดะธ ัะธะณะฝะฐะปั ะธ PRACH. ะกะฝะฐัะฐะปะฐ ะดัะผะฐั ัะฐะทะฑะตัะตะผัั ั ัะธะณะฝะฐะปะฐะผะธ, ะฐ PRACH ะพััะฐะฒะธะผ ะฝะฐะฟะพัะปะตะดะพะบ ะฒ ัะฐะทะฑะพัะต ัะธะทะธัะตัะบะพะณะพ ััะพะฒะฝั. ะ PRACH ะฒัะฟะพะปะฝัะตััั ะธะผะตะฝะฝะพ ะฟัะพัะตะดััะฐ ะธะฝะธัะธะฐะปะธะทะฐัะธะธ ััััะพะนััะฒะฐ, ะฟะพััะพะผั ััะพั ะบะฐะฝะฐะป ััะฐะฝะตั ัะพัะพัะตะน ััะฐััะพะฒะพะน ัะพัะบะพะน ะฒ ะฟัะพัะตะดััั ะธ ััะฐะฝัะฟะพััะฝัะน ััะพะฒะตะฝั.

---------------------------------------------------------------------------------

ะะฐะผะตัะบะธ ะดะปั ัะตะฑั:
 1. PUSCH Frequency Hopping
 2. PUCCH amplitude scaling factor `\Beta_{PUCCH}` ะดะปั ัะฟัะฐะฒะปะตะฝะธั ะผะพัะฝะพัััั (P_{PUCCH}). 36.211 5.4.3 ะธ 36.213 5.1.2.1.
 3. SPUCCH

---------------------------------------------------------------------------------
---------------------------------------------------------------------------------

#### 1.1.7. Signals

ะ LTE, ะบะฐะบ ะผั ัะถะต ะฒัััะฝะธะปะธ, ัััะตััะฒัะตั ะฝะตัะบะพะปัะบะพ ะบะฐะฝะฐะปะพะฒ: PDCCH, PDSCH, PBCH, PUSCH, PUCCH, ... . ะะฝะธ ะธัะฟะพะปัะทััััั ะดะปั ะฟะตัะตะดะฐัะธ ะฝะตะฟะพััะตะดััะฒะตะฝะฝะพ ะธะฝัะพัะผะฐัะธะธ (ั.ะต ะฝะฐะฑะพัะฐ ะฑะธั), ะบะพัะพัะฐั ะธะดัั ะธะท ะฒะตััะฝะธั ััะพะฒะฝะตะน. ะััะณะธะผะธ ัะปะพะฒะฐะผะธ, ะบ ะบะฐะถะดะพะผั ัะธะทะธัะตัะบะพะผั ะบะฐะฝะฐะปั ะฟะพะดะบะปัััะฝ ะบะฐะบะพะน-ะฝะธะฑัะดั ะบะฐะฝะฐะป ะธะท ััะฐะฝัะฟะพััะฝะพะณะพ ะธ ะปะพะณะธัะตัะบะพะณะพ ััะพะฒะฝั. ะ ััะพั ัะฐะท ะผั ะฑัะดะตะผ ัะฐะทะฑะธัะฐัััั ั ัะธะณะฝะฐะปะฐะผะธ. ะกะธะณะฝะฐะปั ะฝะต ะฟะตัะตะดะฐัั ะฝะธะบะฐะบะพะน ะบะพะฝะบัะตัะฝะพะน ะธะฝัะพัะผะฐัะธะธ ะธ ัััะตััะฒััั ัะพะปัะบะพ ะฒ ัะธะทะธัะตัะบะพะผ ััะพะฒะฝะต. ะะฝะธ ะผะพะณัั ะธัะฟะพะปัะทะพะฒะฐัััั ะดะปั ะดะตะบะพะดะธัะพะฒะฐะฝะธั ัะธะณะฝะฐะปะฐ (DMRS), ัะธะฝััะพะฝะธะทัะธะธ (PSS, SSS) ะธ ะฟะพะปััะตะฝะธั ะดะฐะฝะฝัั ะพ ะบะฐัะตััะฒะต ะบะฐะฝะฐะปะฐ ะธ ะผะพัะฝะพััะธ ะฟะตัะตะดะฐัะธ (UE Specific, Cell specific RS, SRS).

ะะฐะบ ะธ ะดะปั ะบะฐะฝะฐะปะพะฒ, ะดะปั ัะธะณะฝะฐะปะพะฒ ัะฐะบะถะต ะดะตะนััะฒัะตั ัะฐะทะดะตะปะตะฝะธะต ะฝะฐ ะฝะฐะฟัะฐะฒะปะตะฝะธั downlink ะธ uplink. ะะฐะทะฑะตัะตะผัั ั ะบะฐะถะดัะผ ะธะท ะฝะธั.

##### 1.1.7.1. Downlink Signals

ะ ะฝะฐะฟัะฐะฒะปะตะฝะธะธ downlink ัััะตััะฒัะตั ะดะตะฒััั ัะฐะทะปะธัะฝัั ัะธะณะฝะฐะปะพะฒ:
 - Reference Signals:
  * Cell-specific Reference Signal (CRS)
  * MBSFN Reference Signal
  * UE-Specific Reference Signal (PDSCH DMRS)
  * EPDCCH DMRS, MPDCCH DMRS
  * Positioning Reference Signal (PRS)
  * Channel State Information Reference Signal (CSI-RS)
 - Synchronization Signals:
  * Primary Synchronization Signal (PSS)
  * Secondary Synchronization Signal (SSS)
  * Resynchronization Signal (RSS)

###### 1.1.7.1.1. CRS

CRS - ะพัะฝะพะฒะฝะพะน ัะธะณะฝะฐะป ะฒ LTE. ะะฝ ะฟะพะทะฒะพะปัะตั UE ะพะฟัะตะดะตะปััั RSRP ะธ RSRQ (ั.ะต ะบะฐัะตััะฒะพ ะบะฐะฝะฐะปะฐ), ะฐ ัะปะตะดะพะฒะฐัะตะปัะฝะพ ะธ ะพัััะตััะฒะปััั ััะฝะบัะธะธ ะผะพะฑะธะปัะฝะพััะธ (ั.ะต ััััะพะนััะฒะพ ะธะผะตะฝะฝะพ ะฑะปะฐะณะพะดะฐัั ััะพะผั ัะธะณะฝะฐะปั ะทะฝะฐะตั ะบะพะณะดะฐ ััะพะธั ะฟะตัะตะบะปััะธัััั ะฝะฐ ัะปะตะดััััั ะฒััะบั, ะดััะณะธะผะธ ัะปะพะฒะฐะผะธ ะฟัะพะธะทะฒะตััะธ Handover). 

 * 1.1.7.1.1.1. Sequence Generation

ะะฐะฑะพั ัะธะผะฒะพะปะพะฒ ะฝะฐ ะพัะฟัะฐะฒะบั ะดะปั ััะพะณะพ ัะธะณะฝะฐะปะฐ ัะพะทะดะฐัััั ัะพะณะปะฐัะฝะพ ัะปะตะดัััะตะน ัะพัะผัะปะต (ะตั ััะพะธั ะทะฐะฟะพะผะฝะธัั, ะพะฝะฐ ะฑัะดะตั ะฟะตัะตะธัะฟะพะปัะทะพะฒะฐัััั ะดะปั ะฝะตะบะพัะพััั ะดััะณะธั ัะธะณะฝะฐะปะพะฒ, ะผะตะฝััััั ะฑัะดัั ะปะธัั ะทะฐะฒะธัะธะผะพััะธ):

```
r_{l,n_s}(m) = \frac{1}{\sqrt{2}}(1 - 2 \cdot c(2m)) + j\frac{1}{\sqrt{2}}(1 - 2 \cdot c(2m + 1)) \\
m = 0,\dots,2N^{max,DL}_{RB} - 1
```

ะะดะต:
 - `n_s` - ะฝะพะผะตั ัะปะพัะฐ ะฒ frame.
 - `l` - ะฝะพะผะตั OFDM ัะธะผะฒะพะปะฐ ะฒ slot.
 - `N^{max,DL}_{RB} = 110` - ะผะฐะบัะธะผะฐะปัะฝะพ ะฒะพะทะผะพะถะฝัะน Bandwith, ะฒััะฐะถะตะฝะฝัะน ะฒ ะบะพะป-ะฒะต RB.

ะะปั ะฟัะตะฒะดะพัะฐะฝะดะพะผะฝะพะน ะฟะพัะปะตะดะพะฒะฐัะตะปัะฝะพััะธ `c` (ะบะพัะพััั ะผั ัะฐััะผะฐััะธะฒะฐะปะธ ัะฐะฝะตะต), `c_{init}` ะณะตะฝะตัะธััะตััั ัะปะตะดัััะธะผ ะพะฑัะฐะทะพะผ: `c_{init} = 2^{10} \cdot (7 \cdot (n_s + 1) + l + 1) \cdot (2 N^{cell}_{ID} + 1) + 2 N^{cell}_{ID} + N_{cp}`. ะัะธ ััะพะผ `N_{cp} = 1` ะดะปั normal CP ะธ `N_{cp} = 0` ะดะปั extended CP.

ะขะตะฟะตัั ะดะฐะฒะฐะนัะต ัะฐะทะฑะตััะผัั ั ัะพัะผัะปะพะน `r`. ะขัั ะผะพะถะฝะพ ะทะฐะผะตัะธัั, ััะพ ะพะฝะฐ ัะพััะพะธั ะธะท ะดะฒัั ัะฐััะตะน: ะดะตะนััะฒะธัะตะปัะฝะพะน ะธ ะบะพะผะฟะปะตะบัะฝะพะน. ะขะฐะบ ะบะฐะบ `c(i)` ะผะพะถะตั ะฑััั ัะฐะฒะตะฝ ะปะธะฑะพ 0, ะปะธะฑะพ 1, ัะพ ัะฐััั `1 - 2c(2m)` ะณะตะฝะตัะธััะตั ะทะฝะฐัะตะฝะธั, ัะฐะฒะฝัะต ะปะธะฑะพ 1, ะปะธะฑะพ -1. ะขะฐะบะฐั ะฟัะพัะตะดััะฐ ะฟะพะทะฒะพะปัะตั ัะณะตะฝะตัะธัะพะฒะฐัั ะทะฝะฐัะตะฝะธั ะฒะพ ะฒัะตั ัะตัััะตั ัะตัะฒะตัััั ะบะพะผะฟะปะตะบัะฝะพะน ะฟะปะพัะบะพััะธ. ะฃะผะฝะพะถะตะฝะธะต ะฝะฐ `1/sqrt(2)` ะปะธัั ะฝะพัะผะฐะปะธะทัะตั ัะพัะบะธ ะดะปั ะณะตะฝะตัะฐัะธะธ IQ ะฟะฐัะฐะผะตััะพะฒ.

c_init ััััะพะตะฝ ัะฐะบะธะผ ะพะฑัะฐะทะพะผ, ััะพะฑั ะดะฐัั ััััะพะนััะฒั ะฒะพะทะผะพะถะฝะพััั ะดะตะบะพะดะธัะพะฒะฐัั (ะธะปะธ ัะฒะตัะธัั) CRS. ะะฝ ะธัะฟะพะปัะทัะตั ัะพะปัะบะพ ัะต ะฟะฐัะฐะผะตััั, ะบะพัะพััะต ะดะพัััะฟะฝั UE ะฝะฐ ะผะพะผะตะฝั ััะธััะฒะฐะฝะธั CRS: ID ะฒััะบะธ ะธ ัะธะฟ CP.

ะัััะต ะฟะพะฝััั ัะธะณะฝะฐะป `r` ะฟะพะผะพะถะตั ะธะปะปััััะฐัะธั: (PHY CRS Constellation) https://imgur.com/a/ptgfM4Z. ะขัั ะฒะธะดะฝะพ, ััะพ ะพะฝ ะฟัะธะฝะธะผะฐะตั ัะพะปัะบะพ 4 ะฒะพะทะผะพะถะฝัั ะทะฝะฐัะตะฝะธั ะฒ ัะพะพัะฒะตััะฒะธะธ ั ะพะฟะธัะฐะฝะธะตะผ.

 * 1.1.7.1.1.2. RE Mapping

ะะฐะถะดัะน ัะปะตะผะตะฝั ะผะฐััะธะฒะฐ `r(m)` ะฝะฐะทะฝะฐัะฐะตััั ะฒ ะพะดะธะฝ RE `\alpha` ัะปะตะดัััะธะผ ะพะฑัะฐะทะพะผ: `\alpha^{(p)}_{k,l} = r_{l,n_s}(m')`. ะญัะพ ะฒััะฐะถะตะฝะธะต ะพะทะฝะฐัะฐะตั, ััะพ ะดะปั ะบะฐะถะดะพะณะพ OFDM ัะธะผะฒะพะปะฐ ะฒ ะพะดะฝะพะผ slot, RE ั ะฝะพะผะตัะพะผ subcarrier `k` ะฟะพะปััะฐะตั ัะปะตะผะตะฝั ะผะฐััะธะฒะฐ `r` ั ะฝะพะผะตัะพะผ `m'`. ะัะธ ััะพะผ `m' = m + N^{max,DL}_{RB} - N^{DL}_{RB}`, ะฐ `m = 0,\dots,2N^{DL}_{RB} - 1`. ะขัั ะบะฐะถะดะพะต ะทะฝะฐัะตะฝะธะต `m` ะฟัะตะพะฑัะฐะทัะตััั ะฒ `m'` ััะพะฑั ัะพะพัะฒะตััะฒะพะฒะฐัั ัะฐะทะผะตัั ะผะฐััะธะฒะฐ `r`.

ะัะธ ััะพะผ ะฝะฐ `l` ะธ `k` (OFDM ัะธะผะฒะพะป ะธ subcarrier ัะพะพัะฒะตััะฒะตะฝะฝะพ) ะฝะฐะบะปะฐะดัะฒะฐัััั ัะปะตะดัััะธะต ะพะณัะฐะฝะธัะตะฝะธั:

```
l = \begin{cases}
 0,N^{DL}_{symb} - 3 & \text{ะตัะปะธ } p \in \{0,1\} \\
 1 & \text{ะตัะปะธ } p \in \{2,3\} \\
\end{cases} \\
k = 6m + (v + v_{shift}) \bmod 6,
```

ะัะธ ััะพะผ ะฟะฐัะฐะผะตััั `v` ะธ `v_{shift}` ะณะตะฝะตัะธัััััั ะฝะฐ ะพัะฝะพะฒะต ID ะฒััะบะธ, ะฝะพะผะตัะฐ ะฐะฝัะตะฝะฝั ะธ OFDM ัะธะผะฒะพะปะฐ:

```
v = \begin{cases}
 0 & \text{ะตัะปะธ } (p = 0 \text{ ะธ } l = 0) \text{ ะธะปะธ } (p = 1 \text{ ะธ } l \neq 0) \\
 3 & \text{ะตัะปะธ } (p = 0 \text{ ะธ } l \neq 0) \text{ ะธะปะธ } (p = 1 \text{ ะธ } l = 0) \\ 
 3(n_s \mod 2) & \text{ะตัะปะธ } p = 2 \\
 3 + 3(n_s \mod 2) & \text{ะตัะปะธ } p = 3 \\
\end{cases} \\ 
v_{shift} = N^{cell}_{ID} \mod 6
```

ะญัะธ ัะพัะผัะปั ะณะพะฒะพััั ะพ ัะพะผ, ััะพ (ะฟัะธ `N^{cell}_{ID} = 0`, `p = 0`):
 - ะะพ ัะฐััะพัะต CRS ะฑัะดะตั ะฟะพัะฒะปััััั ะฒ 0 ะธ 6 subcarrier ะฒ RB ะตัะปะธ `l = 0` ะธ ะฒ 3 ะธ 9 subcarrier ะฒ RB ะตัะปะธ `l != 0`.
 - CRS ะฑัะดะตั ะฟะพัะฒะปััััั ะฒ ะบะฐะถะดะพะผ 0 ะธ 4 (`N^{DL}_{symb} - 3`) OFDM ัะธะผะฒะพะปะต slot'ะฐ.
 - CRS ะฑัะดะตั ัะปะตะดะพะฒะฐัั ัะฐะบะพะผั ัะฐัะฟัะตะดะตะปะตะฝะธั ะบะฐะถะดัะน slot.
 - ะัะธ ะธะทะผะตะฝะตะฝะธะธ ID ะฒััะบะธ `N^{cell}_{ID}` ัะธะณะฝะฐะป ะฑัะดะตั ัะผะตัะฐัััั ะฒะฒะตัั ะฟะพ ัะฐััะพัะต
 - ะัะธ ะธะทะผะตะฝะตะฝะธะธ ะฝะพะผะตัะฐ ะฐะฝัะตะฝะฝั `p` ัะธะณะฝะฐะป ัะฐะบะถะต ะฑัะดะตั ะผะตะฝััั ะฟะพะปะพะถะตะฝะธะต ะฟะพ ัะฐััะพัะต. ะัะธัะตะผ ะธะทะผะตะฝะตะฝะธั, ะบะฐะบ ะผะพะถะฝะพ ะทะฐะผะตัะธัั, ะฟะพะดะพะฑัะฐะฝั ัะฐะบะธะผ ะพะฑัะฐะทะพะผ, ััะพะฑั ะฒ ะพะดะธะฝ ะผะพะผะตะฝั ะปะธัั ะพะดะฝะฐ ะฐะฝัะตะฝะฝะฐ ะฒะตัะฐะปะฐ ัะธะณะฝะฐะป ะฒ ะดะฐะฝะฝะพะผ RE. ะััะณะธะผะธ ัะปะพะฒะฐะผะธ, ะฟะฐัะฐะผะตััั (k, l) ัะฝะธะบะฐะปัะฝั ะดะปั ะบะฐะถะดะพะน ะธะท 4-ั ะฐะฝัะตะฝะฝ. 

ะกะฝะฐัะฐะปะฐ ะฟัะธะฒะตะดั ะบะพะด ะดะปั ะดะฐะฝะฝะพะณะพ ัะธะณะฝะฐะปะฐ, ะฟะพัะพะผ ัะฐััะผะพััะธะผ ะฒะธะทัะฐะปัะฝะพ ะบะฐะบ ะฒัะณะปัะดะธั ัะฐัะฟัะตะดะตะปะตะฝะธะต ะฟะพ RG:

```
import numpy as np
from context.context import Context
from context.constants import N_max_DL_RB
from channels.symbol import ReferenceSignal, Reserved
from sequence.pseudo_random import get_pseudorandom_sequence
from matplotlib import pyplot as plt

crs_sequences = {}

def get_rs_sequence(c_init, length):
    c = get_pseudorandom_sequence(c_init, 2*length)
    return [ 
        (1/np.sqrt(2)) * (1 - 2 * c[2*m]) + 1j * (1/np.sqrt(2)) * (1 - 2 * c[2*m + 1])
        for m in range(length)
    ]

def generate_crs_sequence(n_s, l, context: Context):
    N_cp = 0 if context.is_extended_cp else 1
    c_init = (2**10) * (7 * (n_s + 1) + l + 1) * (2 * context.physical_cell_id + 1) + 2 * context.physical_cell_id + N_cp 
    return get_rs_sequence(c_init, 2 * N_max_DL_RB)

def get_crs_sequence(n_s, l, context: Context):
    crs_sequence = crs_sequences.get((n_s, l), None)
    if not crs_sequence:
        crs_sequence = generate_crs_sequence(n_s, l, context)
        crs_sequences[(n_s, l)] = crs_sequence
    return crs_sequence

def get_subcarrier_shift_v(antenna_port, l, n_s):
    if (antenna_port == 0 and l == 0) or (antenna_port == 1 and l != 0): return 0
    if (antenna_port == 0 and l != 0) or (antenna_port == 1 and l == 0): return 3
    if antenna_port == 2: return 3 * (n_s % 2)
    if antenna_port == 3: return 3 + 3 * (n_s % 2)

def map_crs(antenna_port: int, context: Context):
    possible_l = [1] if antenna_port in (2, 3) else [0, context.N_DL_symb - 3]
    v_shift = context.physical_cell_id % 6
    symbols = []
    for n_s in range(context.nof_slots):
        for l in possible_l:
            for m in range(2 * context.N_DL_RB):
                crs_sequence = get_crs_sequence(n_s, l, context)
                m_tick = m + N_max_DL_RB - context.N_DL_RB
                v = get_subcarrier_shift_v(antenna_port, l, n_s)
                k = 6*m + (v + v_shift) % 6
                current_symb = crs_sequence[m_tick]
                global_l = n_s * context.N_DL_symb + l

                context.dl_resource_grid.map_re(antenna_port, k, global_l, ReferenceSignal(current_symb))
                for other_antenna_port in range(context.antenna_ports):
                    if other_antenna_port != antenna_port:
                        context.dl_resource_grid.map_re(other_antenna_port, k, global_l, Reserved(0))

                symbols.append(current_symb)
    return symbols
```

ะัะธ ะธะทะผะตะฝะตะฝะธะธ ID ะฒััะบะธ CRS ะฑัะดะตั ัะผะตัะฐัััั ะฟะพ ัะฐััะพัะต: (PHY CRS RE N_cell_id Mapping) https://imgur.com/a/ptgfM4Z.

ะ ะฝะฐ ัะฐะทะฝัั ะฐะฝัะตะฝะฝะฐั CRS ะฑัะดะตั ะฒัะตะณะดะฐ ะทะฐะฝะธะผะฐัั ัะฐะทะฝัะต RE: (PHY CRS RE antenna_port Mapping) https://imgur.com/a/ptgfM4Z.

---------------------------------------------------------------------------------

ะะฐะผะตัะบะธ ะดะปั ัะตะฑั:
 1. Discovery Signal